<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Â≠¶Ê±âÂ≠ó</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-title" content="Â≠¶Ê±âÂ≠ó">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#FFB7C5">

    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="icon.svg" />
    <link rel="apple-touch-icon" href="icon.svg" />
    
    <!-- REQUIRED SCRIPT ORDER -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Hanzi Writer -->
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    
    <!-- CnChar Core + Plugins (Order Matters) -->
    <script src="https://cdn.jsdelivr.net/npm/cnchar/cnchar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cnchar-poly/cnchar.poly.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cnchar-order/cnchar.order.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cnchar-trad/cnchar.trad.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cnchar-radical/cnchar.radical.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cnchar-words/cnchar.words.min.js"></script>

    <!-- Configure Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'qy-pink': '#FFB7C5',      
                        'qy-dark-pink': '#FF8FAB', 
                        'qy-text-pink': '#D63384',
                        'qy-purple': '#E0BBE4',
                        'qy-dark-purple': '#957DAD',
                        'qy-text-purple': '#6D28D9',
                        'qy-bg-purple': '#F3E8FF',
                    },
                    fontFamily: {
                        'rounded': ['"Varela Round"', 'sans-serif'],
                        'chinese': ['"Ma Shan Zheng"', '"KaiTi"', 'serif'],
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'pop': 'bounce-in 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)',
                        'dash': 'dash 1.5s ease-in-out forwards',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'coin-bounce': 'coin-bounce 1s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        'bounce-in': {
                            '0%': { transform: 'scale(0.3)', opacity: '0' },
                            '50%': { transform: 'scale(1.05)' },
                            '70%': { transform: 'scale(0.9)' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        },
                        'coin-bounce': {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-15px)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Varela+Round&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Varela Round', "Microsoft YaHei", sans-serif;
            transition: background-color 0.5s ease;
            overscroll-behavior-y: none;
            touch-action: pan-y; 
        }
        .stroke-scroll::-webkit-scrollbar { height: 8px; }
        .stroke-scroll::-webkit-scrollbar-track { background: transparent; }
        .stroke-scroll::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        @keyframes dog-jump { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-25px); } }
        .animate-dog-jump { animation: dog-jump 0.5s ease-in-out; }
        @keyframes dog-wiggle { 0%, 100% { transform: rotate(-10deg); } 50% { transform: rotate(10deg); } }
        .animate-dog-wiggle { animation: dog-wiggle 0.5s ease-in-out infinite; }
        @keyframes dog-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .animate-dog-spin { animation: dog-spin 0.6s linear; }
        @keyframes dog-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        .animate-dog-pulse { animation: dog-pulse 1s ease-in-out infinite; }
        @keyframes tada { 0% { transform: scale(1); } 10%, 20% { transform: scale(0.9) rotate(-3deg); } 30%, 50%, 70%, 90% { transform: scale(1.1) rotate(3deg); } 40%, 60%, 80% { transform: scale(1.1) rotate(-3deg); } 100% { transform: scale(1) rotate(0); } }
        .animate-tada { animation: tada 1s ease-in-out; }

        /* Custom Background Patterns (Subtle "Dark Flowers") */
        .bg-pattern-hanzi {
            background-color: #fff1f2; /* pink-50 base */
            background-image: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 24c6.627 0 12-5.373 12-12S18.627 0 12 0 0 5.373 0 12s5.373 12 12 12zm0-2c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z' fill='%23fecdd3' fill-opacity='0.25' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .bg-pattern-english {
            background-color: #faf5ff; /* purple-50 base */
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23e9d5ff' fill-opacity='0.4' fill-rule='evenodd'%3E%3Cpath d='M0 40L40 0H20l-20 20M40 40V20L20 40'/%3E%3C/g%3E%3C/svg%3E");
        }
    </style>
</head>
<body class="bg-pattern-hanzi">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const COMMON_CHARS = "ÁöÑ‰∏ÄÊòØÂú®‰∏ç‰∫ÜÊúâÂíå‰∫∫Ëøô‰∏≠Â§ß‰∏∫‰∏ä‰∏™ÂõΩÊàë‰ª•Ë¶Å‰ªñÊó∂Êù•Áî®‰ª¨ÁîüÂà∞‰ΩúÂú∞‰∫éÂá∫Â∞±ÂàÜÂØπÊàê‰ºöÂèØ‰∏ªÂèëÂπ¥Âä®ÂêåÂ∑•‰πüËÉΩ‰∏ãËøáÂ≠êËØ¥‰∫ßÁßçÈù¢ËÄåÊñπÂêéÂ§öÂÆöË°åÂ≠¶Ê≥ïÊâÄÊ∞ëÂæóÁªèÂçÅ‰∏â‰πãËøõÁùÄÁ≠âÈÉ®Â∫¶ÂÆ∂ÁîµÂäõÈáåÂ¶ÇÊ∞¥ÂåñÈ´òËá™‰∫åÁêÜËµ∑Â∞èÁâ©Áé∞ÂÆûÈáèÈÉΩ‰∏§‰ΩìÂà∂Êú∫ÂΩì‰ΩøÁÇπ‰ªé‰∏öÊú¨ÂéªÊääÊÄßÂ•ΩÂ∫îÂºÄÂÆÉÂêàËøòÂõ†Áî±ÂÖ∂‰∫õÁÑ∂ÂâçÂ§ñÂ§©ÊîøÂõõÊó•ÈÇ£Á§æ‰πâ‰∫ãÂπ≥ÂΩ¢Áõ∏ÂÖ®Ë°®Èó¥Ê†∑ÊÉ≥ÂêëÈÅìÂëΩÊ≠§‰ΩçÁêÜÊúõÊûúÊñôÂª∫ÊúàÂÖ¨ÊïôÁ≥ªÂπ∂Êï∞Â∏∏ÊñáÈÄöÊúü‰πàÊâãÊé•ÂëòÂè£Á´ãÊÉÖËøêÂÆâÊúÄÂÜõ‰ªäÊèêÊ∞îÈáçÂ±±ÁªìÊîæËß£ÂêÑÂ∞ëËµÑÊúüÊâìÂè∞ÂÄôÂø´ÁúºÊØî‰π¶Á¨ëËØ≠Â£∞Ë•øÂçóÁæéÁïåÂåóËæπ‰π¶ËØªÂÜôÂ≠óÊ∏ÖÊòé‰∫ÆÊòüÁÅ´Â¶àÁà∏Áà∑Â•∂Âì•ÂßêÂºüÂ¶πÊ†°Â∏àËØæÁ¨îÁ∫∏ÁêÉËçâÊ†ëËä±È∏üÈ±ºËô´ÁâõÁæäÈ©¨ÁãóÊó©ÊôöÈ•≠Ë°£ËΩ¶Èó®Á™óÂ∫äÁÅØÈíüËßâÊ¥óÊæ°Âà∑ËÑ∏ÁâôÊâãË∂≥Ë∫´Â§¥Âè£ËÄ≥ÁõÆÈºªÊâãË∂≥Â§ß‰∏≠Â∞èÂ§öÂ∞ëÊó•ÊúàÊ∞¥ÁÅ´ÂúüÊú®ÈáëÁü≥Áî∞ÂúüÂ§©È£éÈõ®Èõ™Áîµ‰∫ëÂÜ∞Ê≤ôÊµ∑Ê≤≥ÊπñÊ±üÊ¥ãÁà∏Â¶àÂì•ÂºüÂßêÂ¶πÁà∑Â•∂‰ºØÂèîÂß®ÂßëÂÆ∂Ê†°Â∏àÁîüÂêåÂ≠¶ÂèãÁà±ÁúãÂê¨ËØ¥ËØªÂÜôÁîªÂî±Ë∑≥Ë∑ëÂùêÁ´ãËµ∞È£ûÂêÉÂñùÁé©‰πêÊò•Â§èÁßãÂÜ¨Á∫¢ÈªÑËìùÁªøÁôΩÈªëÁ¥´Ê©ôÁÅ∞Ê£ï‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πùÂçÅÁôæÂçÉ‰∏á‰∏ä‰∏≠‰∏ãÂ∑¶Âè≥ÂâçÂêéÂÜÖÂ§ñÈù¢ÈáåÊñπÂúÜÈïøÁü≠È´òÁüÆÁ≤óÁªÜÂø´ÊÖ¢ÂÜ∑ÁÉ≠Âπ≤ÊπøËΩªÈáçÊòéÊöóÂºÄÂÖ≥Âá∫ÂÖ•Êù•ÂéªÂùêÂçßÁ´ãË°åÈòøÂïäÂüÉÊå®ÂìéÂîâÂìÄÁöëÁôåËîºÁüÆËâæÁ¢çÁà±ÈöòÈûçÊ∞®ÂÆâ‰ø∫ÊåâÊöóÂ≤∏ËÉ∫Ê°àËÇÆÊòÇÁõéÂáπÊïñÁÜ¨Áø±Ë¢ÑÂÇ≤Â••ÊáäÊæ≥Áà∏ÊâíËä≠Áñ§Â∑¥ÊãîË∑ãÈù∂ÊääËÄôÂùùÈú∏ÁΩ¢Áà∏ÁôΩÊüèÁôæÊëÜ‰Ω∞Ë¥•ÊãúÁ®óÊñëÁè≠Êê¨Êâ≥Ëà¨È¢ÅÊùøÁâàÊâÆÊãå‰º¥Áì£ÂçäÂäûÁªäÈÇ¶Â∏ÆÊ¢ÜÊ¶úËÜÄÁªëÊ£íÁ£ÖËöåÈïëÂÇçË∞§ËãûËÉûÂåÖË§íÂâ•ËñÑÈõπ‰øùÂ†°È•±ÂÆùÊä±Êä•Êö¥Ë±πÈ≤çÁàÜÊùØÁ¢ëÊÇ≤ÂçëÂåóËæàËÉåË¥ùÈí°ÂÄçÁãàÂ§áÊÉ´ÁÑôË¢´Â•îËãØÊú¨Á¨®Â¥©Áª∑Áî≠Ê≥µËπ¶Ëø∏ÈÄºÈºªÊØîÈÑôÁ¨îÂΩºÁ¢ßËìñËîΩÊØïÊØôÂ∏ÅÂ∫áÁóπÈó≠ÊïùÂºäÂøÖËæüÂ£ÅËáÇÈÅøÈôõÈû≠ËæπÁºñË¥¨ÊâÅ‰æøÂèòÂçûËæ®Ëæ©Ëæ´ÈÅçÊ†áÂΩ™ËÜòË°®È≥ñÊÜãÂà´Áò™ÂΩ¨ÊñåÊøíÊª®ÂÆæÂ±èÂÜ∞ÊüÑ‰∏ôÁßâÈ•ºÁÇ≥ÁóÖÂπ∂ÁéªËè†Êí≠Êã®ÈíµÊ≥¢ÂçöÂãÉÊêèÈìÇÁÆî‰ºØÂ∏õËà∂ËÑñËÜäÊ∏§Ê≥äÈ©≥ÊçïÂçúÂì∫Ë°•Âü†‰∏çÂ∏ÉÊ≠•Á∞øÈÉ®ÊÄñÊì¶ÁåúË£ÅÊùêÊâçË¥¢Áù¨Ë∏©ÈááÂΩ©ËèúËî°È§êÂèÇËöïÊÆãÊÉ≠ÊÉ®ÊÉ®ËãçËà±‰ªìÊ≤ßËóèÊìçÁ≥ôÊßΩÊõπËçâÂéïÁ≠ñ‰æßÂÜåÊµãÂ±ÇËπ≠ÊèíÂèâËå¨Ëå∂Êü•Á¢¥ÊêΩÂØüÂ≤îÂ∑ÆËØßÊãÜÊü¥Ë±∫ÊêÄÊé∫ËùâÈ¶ãË∞óÁº†Èì≤‰∫ßÈòêÈ¢§ÊòåÁåñÂú∫Â∞ùÂ∏∏ÈïøÂÅøËÇ†ÂéÇÊïûÁïÖÂî±ÂÄ°Ë∂ÖÊäÑÈíûÊúùÂò≤ÊΩÆÂ∑¢ÂêµÁÇíËΩ¶ÊâØÊí§Êé£ÂΩªÊæàË°¨Áß∞ÊíëÊæÑÂëàÊâøËØöÂüé‰πòÊÉ©Á®ãÊæÑÁß§ÂêÉÁó¥ÊåÅÂåôÊ±†ËøüÂºõÈ©∞ËÄªÈΩø‰æàÂ∞∫Ëµ§ÁøÖÊñ•ÁÇΩÂÖÖÂÜ≤Ëô´Â¥áÂÆ†ÊäΩÈÖ¨Áï¥Ë∏åÁ®†ÊÑÅÁ≠π‰ªáÁª∏ÁûÖ‰∏ëËá≠ÂàùÂá∫Ê©±Âé®Ë∫áÈîÑÈõèÂ§ÑÊè£Â∑ùÁ©øÊ§Ω‰º†ËàπÂñò‰∏≤ÁñÆÁ™óÂπ¢Â∫äÈóØÂàõÂêπÁÇäÊç∂Èî§Êò•Ê§øÈÜáÂîáÊ∑≥Á∫ØË†¢Êà≥Áª∞ÁñµËå®Á£ÅÈõåËæûÊÖàÁì∑ËØçÊ≠§Âà∫ËµêÊ¨°ËÅ™Ëë±Âõ±ÂåÜ‰ªé‰∏õÂáëÁ≤óÈÜãÁ∞á‰øÉËπøÁØ°Á™úÊëßÂ¥îÂÇ¨ËÑÜÁòÅÁ≤πÁòÅÁø†ÊùëÂ≠òÂØ∏Á£ãÊíÆÊêìÊé™Êå´ÈîôÊê≠ËææÁ≠îÁò©ÊâìÂ§ßÂëÜÊ≠πÂÇ£Êà¥Â∏¶ÊÆÜ‰ª£Ë¥∑Ë¢ãÂæÖÈÄÆÊÄ†ËÄΩÊãÖ‰∏πÂçïÈÉ∏Êé∏ËÉÜÊó¶Ê∞Æ‰ΩÜÊÉÆÊ∑°ËØûÂºπËõãÂΩìÊå°ÂÖöËç°Ê°£ÂàÄÊç£ËπàÂÄíÂ≤õÁ•∑ÂØºÂà∞Á®ªÊÇºÈÅìÁõóÂæ∑ÂæóÁöÑËπ¨ÁÅØÁôªÁ≠âÁû™Âá≥ÈÇìÂ†§‰ΩéÊª¥Ëø™ÊïåÁ¨õÁãÑÊ∂§ÁøüÂ´°ÊäµÂ∫ïÂú∞ËíÇÁ¨¨Â∏ùÂºüÈÄíÁºîÈ¢†ÊéÇÊªáÁ¢òÁÇπÂÖ∏ÈùõÂû´Áîµ‰ΩÉÁî∏Â∫óÊÉ¶Â•†Ê∑ÄÊÆøÁ¢âÂèºÈõïÂáãÂàÅÊéâÂêäÈíìË∞ÉË∑åÁàπÁ¢üËù∂Ëø≠Ë∞çÂè†‰∏ÅÁõØÂèÆÈíâÈ°∂ÈºéÈî≠ÂÆöËÆ¢‰∏¢‰∏úÂÜ¨Ëë£ÊáÇÂä®Ê†ã‰æóÊñóÊäñÈô°Ë±ÜÁù£ÊØíËØªÁã¨È°øÂ¢©ÁõæÊï¶Ëπ≤Ëπ≤Á´ØÁü≠ÊÆµÊñ≠ÁºéÂ†ÜÂÖëÈòüÂØπÂ¢©Âê®Ëπ≤Êï¶È°øÂõ§ÈíùÁõæÈÅÅÂ§öÂìÜÂ§∫Â∫¶Ê∏°ÈïÄÁ´ØÁü≠ÊÆµÊñ≠ÁºéÂ†ÜÂÖëÈòüÂØπÂ§öÂìÜÂ§∫Â∫¶Ê∏°ÈïÄÁ´ØÁü≠ÊÆµÊñ≠ÁºéÂ†ÜÂÖëÈòüÂØπÂ§öÂìÜÂ§∫Â∫¶Ê∏°ÈïÄÂ≥®‰øÑÂ®•ÈÑÇÈπÖËõæÈ¢ùÂéÑÊâºÊÅ∂È•øÊÅ©ËÄåÂÑøËÄ≥Â∞îÈ•µË¥∞ÂèëÁΩöÁ≠è‰ºê‰πèÈòÄÊ≥ïÁèêËó©Â∏ÜÁï™ÁøªÊ®äÁüæÈííÁπÅÂá°ÁÉ¶ÂèçËøîËåÉË¥©ÁäØÈ•≠Ê≥õÂùäËä≥ÊñπËÇ™ÊàøÈò≤Â¶®‰ªøËÆøÁ∫∫ÊîæËè≤ÈùûÂï°È£ûËÇ•Âå™ËØΩÂê†ËÇ∫Â∫üÊ≤∏Ë¥πËä¨ÈÖöÂê©Ê∞õÂàÜÁ∫∑ÂùüÁÑöÊ±æÁ≤âÂ•ã‰ªΩÂøøÊÑ§Á≤™‰∏∞Â∞ÅÊû´ËúÇÂ≥∞ÈîãÈ£éÁñØÁÉΩÈÄ¢ÂÜØÁºùËÆΩÂ•âÂá§‰ΩõÂê¶Â§´Êï∑ËÇ§Â≠µÊâ∂ÊãÇËæêÂπÖÊ∞üÁ¨¶‰ºè‰øòÊúçÊµÆÊ∂™Á¶èË¢±ÂºóÁî´ÊäöËæÖ‰øØÈáúÊñßËÑØËÖëÂ∫úËÖêËµ¥ÂâØË¶ÜËµãÂ§çÂÇÖ‰ªòÈòúÁà∂ËÖπË¥üÂØåËÆ£ÈôÑÂ¶áÁºöÂíêÂô∂ÂòéËØ•ÊîπÊ¶ÇÈíôÁõñÊ∫âÂπ≤ÁîòÊùÜÊüëÁ´øËÇùËµ∂ÊÑüÁßÜÊï¢Ëµ£ÂÜàÂàöÈí¢Áº∏ËÇõÁ∫≤Â≤óÊ∏ØÊù†ÁØôÁöãÈ´òËÜèÁæîÁ≥ïÊêûÈïêÁ®øÂëäÂì•Ê≠åÊêÅÊààÈ∏ΩËÉ≥ÁñôÂâ≤Èù©ËëõÊ†ºËõ§ÈòÅÈöîÈì¨‰∏™ÂêÑÁªôÊ†πË∑üËÄïÊõ¥Â∫öÁæπÂüÇËÄøÊ¢óÂ∑•ÊîªÂäüÊÅ≠Èæö‰æõË∫¨ÂÖ¨ÂÆ´ÂºìÂ∑©Ê±ûÊã±Ë¥°ÂÖ±Èí©ÂãæÊ≤üËãüÁãóÂû¢ÊûÑË¥≠Â§üËæúËèáÂíïÁÆç‰º∞Ê≤ΩÂ≠§ÂßëÈºìÂè§ËõäÈ™®Ë∞∑ËÇ°ÊïÖÈ°æÂõ∫ÈõáÂàÆÁìúÂâêÂØ°ÊåÇË§Ç‰πñÊãêÊÄ™Ê£∫ÂÖ≥ÂÆòÂÜ†ËßÇÁÆ°È¶ÜÁΩêÊÉØÁÅåË¥ØÂÖâÂπøÈÄõÁë∞ËßÑÂú≠Á°ÖÂΩíÈæüÈó∫ËΩ®È¨ºËØ°Áô∏Ê°ÇÊüúË∑™Ë¥µÂàΩËæäÊªöÊ£çÈîÖÈÉ≠ÂõΩÊûúË£πËøáÂìàÈ™∏Â≠©Êµ∑Ê∞¶‰∫•ÂÆ≥È™áÈÖ£ÊÜ®ÈÇØÈü©Âê´Ê∂µÂØíÂáΩÂñäÁΩïÁø∞ÊíºÊççÊó±ÊÜæÊÇçÁÑäÁÑäÊ±óÊ±âÂ§ØÊù≠Ëà™Â£ïÂöéË±™ÊØ´ÈÉùÂ•ΩËÄóÂè∑Êµ©ÂëµÂñùËç∑ËèèÊ†∏Á¶æÂíå‰ΩïÂêàÁõíË≤âÈòÇÊ≤≥Ê∂∏Ëµ´Ë§êÈπ§Ë¥∫ÂòøÈªëÁóïÂæàÁã†ÊÅ®Âìº‰∫®Ê®™Ë°°ÊÅíËΩ∞ÂìÑÁÉòËôπÈ∏øÊ¥™ÂÆèÂºòÁ∫¢Âñâ‰æØÁå¥ÂêºÂêéÂéöÂÄô‰πéÂëºÂøΩÂºßÁãêËÉ°Â£∂ÊπñËë´ÁëöÁ≥äËù¥ËôéÂî¨Êä§‰∫íÊ≤™Êà∑Ëä±ÂìóÂçéÁåæÊªëÁîªÂàíÂåñËØùÊßêÂæäÊÄÄÊ∑ÆÂùèÊ¨¢ÁéØÊ°ìËøòÁºìÊç¢ÊÇ£Âî§Áó™Ë±¢ÁÑïÊ∂£ÂÆ¶ÂπªËçíÊÖåÈªÑÁ£∫ËùóÁ∞ßÁöáÂá∞ÊÉ∂ÁÖåÊôÉÂπåÊÅçË∞éÁÅ∞Êå•ËæâÂæΩÊÅ¢ËõîÂõûÊØÅÊÇîÊÖßÂçâÊÉ†Êô¶Ë¥øÁßΩ‰ºöÁÉ©Ê±áËÆ≥ËØ≤ÁªòËç§ÊòèÂ©öÈ≠ÇÊµëÊ∑∑Ë±ÅÊ¥ª‰ºôÁÅ´Ëé∑ÊàñÊÉëÈúçË¥ßÁ•∏ÂáªÂúæÂü∫Êú∫Áï∏Á®ΩÁßØÁÆïËÇåÈ••ËøπÊøÄËÆ•È∏°Âß¨Áª©ÁºâÂêâÊûÅÊ£òËæëÁ±çÈõÜÂèäÊÄ•ÁñæÊ±≤Âç≥Â´âÁ∫ßÊå§Âá†ËÑäÂ∑±ËìüÊäÄÂÜÄÂ≠£‰ºéÁ•≠ÂâÇÊÇ∏ÊµéÂØÑÂØÇËÆ°ËÆ∞Êó¢ÂøåÈôÖÁªßÁ∫™ÂòâÊû∑Â§π‰Ω≥ÂÆ∂Âä†ËçöÈ¢äË¥æÁî≤ÈíæÂÅáÁ®º‰ª∑Êû∂È©æÂ´ÅÊ≠ºÁõëÂùöÂ∞ñË∑µÈó¥ÁÖéÂÖºËÇ©Ëâ∞Â•∏ÁºÑËåßÊ£ÄÊü¨Á¢±Êã£Êç°ÁÆÄ‰ø≠Ââ™ÂáèËçêÊßõÈâ¥Ë∑µË¥±ËßÅÈîÆÁÆ≠‰ª∂ÂÅ•Ëà∞ÂâëÈ•ØÊ∏êÊ∫ÖÊ∂ßÂª∫ÂÉµÂßúÂ∞ÜÊµÜÊ±üÁñÜËíãÊ°®Â•ñËÆ≤Âå†ÈÖ±ÈôçËïâÊ§íÁ§ÅÁÑ¶ËÉ∂‰∫§ÈÉäÊµáÈ™ÑÂ®áÂöºÊêÖÈì∞Áü´‰æ•ËÑöÁã°ËßíÈ•∫Áº¥ÁªûÂâøÊïôÈÖµËΩøËæÉÂè´Á™ñÊè≠Êé•ÁöÜÁß∏Ë°óÈò∂Êà™Âä´ËäÇÊ°îÊù∞Êç∑Áù´Á´≠Ê¥ÅÁªìËß£ÂßêÊàíËóâËä•ÁïåÂÄü‰ªãÁñ•ËØ´Â±äÂ∑æÁ≠ãÊñ§Èáë‰ªäÊ¥•Ë•üÁ¥ßÈî¶‰ªÖË∞®ËøõÈù≥ÊôãÁ¶ÅËøëÁÉ¨Êµ∏Â∞ΩÂä≤ËçÜÂÖ¢ËåéÁùõÊô∂È≤∏‰∫¨ÊÉäÁ≤æÁ≤≥Áªè‰∫ïË≠¶ÊôØÈ¢àÈùôÂ¢ÉÊï¨ÈïúÂæÑÁóâÈùñÁ´üÁ´ûÂáÄÁÇØÁ™òÊè™Á©∂Á∫†ÁéñÈü≠‰πÖÁÅ∏‰πùÈÖíÂé©ÊïëÊóßËáºËàÖÂíéÂ∞±ÁñöÈû†ÊãòÁãôÁñΩËèäÂ±ÄÂíÄÁü©‰∏æÊ≤ÆËÅöÊãíÊçÆÂ∑®ÂÖ∑Ë∑ùË∏ûÈîØ‰ø±Âè•ÊÉßÁÇ¨ÂâßÊçêÈπÉÂ®üÂÄ¶Áú∑Âç∑Áª¢ÊíÖÊî´ÊäâÊéòÂÄîÁàµËßâÂÜ≥ËØÄÁªùÂùáËèåÈíßÂÜõÂêõÂ≥ª‰øäÁ´£ÊµöÈÉ°È™èÂñÄÂíñÂç°ÂíØÂºÄÊè©Ê•∑Ê•∑ÂáØÊÖ®ÂàäÂ†™ÂãòÂùéÁ†çÁúãÂ∫∑ÊÖ∑Á≥†ÊâõÊäó‰∫¢ÁÇïËÄÉÊã∑ÁÉ§Èù†Âù∑ËãõÊüØÊ£µÁ£ïÈ¢óÁßëÂ£≥Âí≥ÂèØÊ∏¥ÂÖãÂàªÂÆ¢ËØæËÇØÂïÉÂû¶ÊÅ≥ÂùëÂê≠Á©∫ÊÅêÂ≠îÊéßÊä†Âè£Êâ£ÂØáÊûØÂì≠Á™üËã¶ÈÖ∑Â∫ìË£§Â§∏ÂûÆÊåéË∑®ËÉØÂùóÂø´‰æ©Á≠∑ÂÆΩÊ¨æÂå°Á≠êÁãÇÊ°ÜÁüøÁú∂Êó∑ÂÜµ‰∫èÁõîÂ≤øÁ™•ËëµÂ•éÈ≠ÅÂÇÄÈ¶àÊÑßÊ∫ÉÂù§ÊòÜÊçÜÂõ∞Êã¨Êâ©ÂªìÈòîÂûÉÂúæÊãâÂñáËú°ËÖäËæ£Âï¶Ëé±Êù•ËµñËìùÂ©™Ê†èÊã¶ÁØÆÈòëÂÖ∞ÊæúË∞∞ÊèΩËßàÊáíÁºÜÁÉÇÊª•ÁêÖÊ¶îÁãºÂªäÈÉéÊúóÊµ™ÊçûÂä≥Áâ¢ËÄÅ‰Ω¨Âß•ÈÖ™ÁÉôÊ∂ùÂãí‰πêÈõ∑Èï≠ËïæÁ£äÁ¥ØÂÑ°ÂûíÊìÇËÇãÁ±ªÊ≥™Ê£±Ê•ûÂÜ∑ÂéòÊ¢®ÁäÅÈªéÁØ±Áã∏Á¶ªÊºìÁêÜÊùéÈáåÈ≤§Á§ºËéâËçîÂêèÊ†ó‰∏ΩÂéâÂä±Á†æÂéÜÂà©ÂÇà‰æã‰øêÁó¢Á´ãÁ≤íÊ≤•Èö∂ÂäõÁíÉÂì©‰ø©ËÅîËé≤ËøûÈï∞ÂªâÊÄúÊ∂üÂ∏òÊïõËÑ∏ÈìæÊÅãÁÇºÁªÉÁ≤ÆÂáâÊ¢ÅÁ≤±ËâØ‰∏§ËæÜÈáèÊôæ‰∫ÆË∞ÖÊí©ËÅäÂÉöËæΩÊΩ¶‰∫ÜÊíÇÈï£ÂªñÊñôÂàóË£ÇÁÉàÂä£ÁåéÁê≥ÊûóÁ£∑Èúñ‰∏¥ÈÇªÈ≥ûÊ∑ãÂáõËµÅÂêùÊãéÁé≤Ëè±Èõ∂ÈæÑÈìÉ‰º∂ÁÅµÂ≤≠È¢ÜÂè¶‰ª§Ê∫úÁêâÊ¶¥Á°´È¶èÁïôÂàòÁò§ÊµÅÊü≥ÂÖ≠ÈæôËÅãÂíôÁ¨ºÁ™øÈöÜÂûÑÊã¢ÈôáÊ•ºÂ®ÑÊêÇÁØìÊºèÈôãËä¶Âç¢È¢ÖÂ∫êÁÇâÊé≥Âç§ËôèÈ≤ÅÈ∫ìÁ¢åÈú≤Ë∑ØËµÇÈπøÁ¶ÑÂΩïÈôÜÊàÆÈ©¥ÂêïÈìù‰æ£ÊóÖÂ±•Â±°ÁºïËôëÊ∞ØÂæãÁéáÊª§ÁªøÂ≥¶ÊåõÂ≠™Êª¶Âçµ‰π±Êé†Áï•Êä°ËΩÆ‰º¶‰ªëÊ≤¶Á∫∂ËÆ∫ËêùËû∫ÁΩóÈÄªÈî£ÁÆ©È™°Ë£∏ËêΩÊ¥õÈ™ÜÁªúÂ¶àÈ∫ªÁéõÁ†ÅËöÇÈ©¨È™ÇÂòõÂêóÂüã‰π∞È∫¶ÂçñËøàËÑâÁûíÈ¶íËõÆÊª°ËîìÊõºÊÖ¢Êº´ËäíËå´Áõ≤Ê∞ìÂøôËéΩÁå´ËåÖÈîöÊØõÁüõÈìÜÂçØËåÇÂÜíÂ∏ΩË≤åË¥∏‰πàÁé´ÊûöÊ¢ÖÈÖ∂ÈúâÁÖ§Ê≤°ÁúâÂ™íÈïÅÊØèÁæéÊòßÂØêÂ¶πÂ™öÈó®Èó∑‰ª¨ËêåËíôÊ™¨ÁõüÈî∞ÁåõÊ¢¶Â≠üÁúØÈÜöÈù°Á≥úËø∑Ë∞úÂº•Á±≥ÁßòËßÖÊ≥åËúúÂØÜÂπÇÊ£âÁú†ÁªµÂÜïÂÖçÂãâÂ®©ÁºÖÈù¢ËãóÊèèÁûÑËóêÁßíÊ∏∫Â∫ôÂ¶ôËîëÁÅ≠Ê∞ëÊäøÁöøÊïèÊÇØÈóΩÊòéËûüÈ∏£Èì≠ÂêçÂëΩË∞¨Êë∏ÊëπËòëÊ®°ËÜúÁ£®Êë©È≠îÊäπÊú´Ëé´Â¢®ÈªòÊ≤´Êº†ÂØûÈôåË∞ãÁâüÊüêÊãáÁâ°‰∫©ÂßÜÊØçÂ¢ìÊöÆÂπïÂãüÊÖïÊú®ÁõÆÁù¶ÁâßÁ©ÜÊãøÂì™ÂëêÈí†ÈÇ£Â®úÁ∫≥Ê∞ñ‰πÉÂ•∂ËÄêÂ•àÂçóÁî∑ÈöæÂõäÊå†ËÑëÊÅºÈóπÊ∑ñÂë¢È¶ÅÂÜÖÂ´©ËÉΩÂ¶ÆÈúìÂÄ™Ê≥•Â∞ºÊãü‰Ω†ÂåøËÖªÈÄÜÊ∫∫Ëî´ÊãàÂπ¥Á¢æÊíµÊçªÂøµÂ®òÈÖøÈ∏üÂ∞øÊçèËÅÇÂ≠ΩÂïÆÈïäÈïçÊ∂ÖÊÇ®Êü†ÁãûÂáùÂÆÅÊãßÊ≥ûÁâõÊâ≠ÈíÆÁ∫ΩËÑìÊµìÂÜúÂºÑÂ•¥Âä™ÊÄíÂ•≥ÊöñËôêÁñüÊå™Êá¶Á≥ØËØ∫Âì¶Ê¨ßÈ∏•ÊÆ¥ËóïÂëïÂÅ∂Ê≤§Âï™Ë∂¥Áà¨Â∏ïÊÄïÁê∂ÊãçÊéíÁâåÂæòÊπÉÊ¥æÊîÄÊΩòÁõòÁ£êÁõºÁïîÂà§Âèõ‰πìÂ∫ûÊóÅËÄ™ËÉñÊäõÂíÜÂà®ÁÇÆË¢çË∑ëÊ≥°Âë∏ËÉöÂüπËµîÈô™ÈÖç‰Ω©Ê≤õÂñ∑ÁõÜÁ†∞Êä®ÁÉπÊæéÂΩ≠Ëì¨Ê£öÁ°ºÁØ∑ËÜ®ÊúãÈπèÊçßÁ¢∞ÂùØÁ†íÈúπÊâπÊä´ÂäàÁêµÊØóÂï§ËÑæÁñ≤ÁöÆÂåπÁóûÂÉªÂ±ÅË≠¨ÁØáÂÅèÁâáÈ™óÈ£òÊºÇÁì¢Á•®ÊíáÁû•ÊãºÈ¢ëË¥´ÂìÅËÅò‰πíÂù™ËãπËêçÂπ≥Âá≠Áì∂ËØÑÂ±èÂù°Ê≥ºÈ¢áÂ©ÜÁ†¥È≠ÑËø´Á≤ïÂâñÊâëÈì∫‰ªÜËí≤Ëë°Ëè©Ëí≤ÂüîÊú¥ÂúÉÊôÆÊµ¶Ë∞±ÊõùÁÄëÊúüÊ¨∫Ê†ñÊàöÂ¶ª‰∏ÉÂáÑÊºÜÊüíÊ≤èÂÖ∂Ê£ãÂ•áÊ≠ßÁï¶Â¥éËÑêÈΩêÊóóÁ•àÁ•ÅÈ™ëËµ∑Â≤Ç‰πû‰ºÅÂêØÂ•ëÁ†åÂô®Ê∞îËøÑÂºÉÊ±ΩÊ≥£ËÆ´ÊéêÊ¥ΩÁâµÊâ¶ÈíéÈìÖÂçÉËøÅÁ≠æË∞¶‰πæÈªîÈí±Èí≥ÂâçÊΩúÈÅ£ÊµÖË∞¥Â†ëÂµåÊ¨†Ê≠âÊû™ÂëõËÖîÁæåÂ¢ôËî∑Âº∫Êä¢Ê©áÈîπÊï≤ÊÇÑÊ°•Áûß‰πî‰æ®Â∑ßÈûòÊí¨ÁøòÂ≥≠‰øèÁ™çÂàáËåÑ‰∏îÊÄØÁ™ÉÈí¶‰æµ‰∫≤Áß¶Áê¥Âã§ËäπÊìíÁ¶ΩÂØùÊ≤ÅÈùíËΩªÊ∞¢ÂÄæÂçøÊ∏ÖÊìéÊô¥Ê∞∞ÊÉÖÈ°∑ËØ∑Â∫ÜÁêºÁ©∑Áßã‰∏òÈÇ±ÁêÉÊ±ÇÂõöÈÖãÊ≥ÖË∂ãÂå∫ËõÜÊõ≤Ë∫ØÂ±àÈ©±Ê∏†ÂèñÂ®∂ÈæãË∂£ÂéªÂúàÈ¢ßÊùÉÈÜõÊ≥âÂÖ®ÁóäÊã≥Áä¨Âà∏ÂäùÁº∫ÁÇîÁò∏Âç¥ÈπäÊ¶∑Á°ÆÈõÄË£ôÁæ§ÁÑ∂ÁáÉÂÜâÊüìÁì§Â£§ÊîòÂö∑ËÆ©È•∂Êâ∞ÁªïÊÉπÁÉ≠Â£¨‰ªÅ‰∫∫ÂøçÈüß‰ªªËÆ§ÂàÉÂ¶äÁ∫´Êâî‰ªçÊó•ÊàéËå∏ËìâËç£ËûçÁÜîÊ∫∂ÂÆπÁªíÂÜóÊèâÊüîËÇâËåπË†ïÂÑíÂ≠∫Â¶ÇËæ±‰π≥Ê±ùÂÖ•Ë§•ËΩØÈòÆËïäÁëûÈîêÈó∞Ê∂¶Ëã•Âº±ÊííÊ¥íËê®ËÖÆÈ≥ÉÂ°ûËµõ‰∏âÂèÅ‰ºûÊï£Ê°ëÂóì‰∏ßÊêîÈ™öÊâ´Â´ÇÁëüËâ≤Ê∂©Ê£ÆÂÉßËééÁ†ÇÊùÄÂàπÊ≤ôÁ∫±ÂÇªÂï•ÁÖûÁ≠õÊôíÁèäËã´ÊùâÂ±±Âà†ÁÖΩË°´Èó™ÈôïÊìÖËµ°ËÜ≥ÂñÑÊ±ïÊâáÁºÆÂ¢í‰º§ÂïÜËµèÊôå‰∏äÂ∞öË£≥Ê¢¢ÊçéÁ®çÁÉßËäçÂã∫Èü∂Â∞ëÂì®ÈÇµÁªçÂ•¢ËµäËõáËàåËàçËµ¶ÊëÑÂ∞ÑÊÖëÊ∂âÁ§æËÆæÁ†∑Áî≥Âëª‰º∏Ë∫´Ê∑±Â®†ÁªÖÁ•ûÊ≤àÂÆ°Â©∂ËÇæÁîöÊ∏óÊÖéÂçáÁîüÂ£∞Áâ≤ËÉúÁª≥ÁúÅÂú£ÁõõÂâ©Â∞∏Â§±Â∏àËØóÊñΩÁãÆÊπøÂçÅÁü≥Êó∂ËØÜÂÆûÊãæËöÄÈ£üÂè≤Áü¢‰ΩøÂ±éÈ©∂ÂßãÂºèÁ§∫Â£´‰∏ñÊüø‰∫ãÊã≠Ë™ìÈÄùÂäøÊòØÂóúÂô¨ÈÄÇ‰ªï‰æçÈáäÈ•∞Ê∞èÂ∏ÇÊÅÉÂÆ§ËßÜËØïÊî∂ÊâãÈ¶ñÂÆàÂØøÊéàÂîÆÂèóÁò¶ÂÖΩËî¨Êû¢Ê¢≥ÊÆäÊäíËæìÂèîËàíÊ∑ëÁñè‰π¶ËµéÂ≠∞ÁÜüËñØÊöëÊõôÁΩ≤ËúÄÈªçÈº†Â±ûÊúØËø∞Ê†ëÊùüÊàçÁ´ñÂ¢ÖÂ∫∂Êï∞Êº±ÊÅïÂà∑ËÄçÊëîË°∞Áî©Â∏ÖÊ†ìÊã¥ÈúúÂèåÁàΩË∞ÅÊ∞¥Áù°Á®éÂêÆÁû¨È°∫ËàúËØ¥Á°ïÊúîÁÉÅÊñØÊíïÂò∂ÊÄùÁßÅÂè∏‰∏ùÊ≠ªËÇÜÂØ∫Âó£Âõõ‰º∫‰ººÈ•≤Â∑≥ÊùæËÄ∏ÊÄÇÈ¢ÇÈÄÅÂÆãËÆºËØµÊêúËâòÊìûÂóΩËãèÈÖ•‰øóÁ¥†ÈÄüÁ≤üÂ°ëÊ∫ØÂÆøËØâËÇÉÈÖ∏ËíúÁÆóËôΩÈöãÈöèÁª•È´ìÁ¢éÂ≤ÅÁ©óÈÅÇÈößÁ•üÂ≠ôÊçüÁ¨ãËìëÊ¢≠ÂîÜÁº©ÁêêÁ¥¢ÈîÅÊâÄÂ°å‰ªñÂÆÉÂ•πÂ°îÁç≠ÊåûËπãË∏èËÉéËãîÊä¨Âè∞Ê≥∞ÈÖûÂ§™ÊÄÅÊ±∞ÂùçÊëäË¥™Áò´Êª©ÂùõÊ™ÄÁó∞ÊΩ≠Ë∞≠Ë∞àÂù¶ÊØØË¢íÁ¢≥Êé¢ÂèπÁÇ≠Ê±§Â°òÊê™Â†ÇÊ£†ÂîêÁ≥ñËÜõÂ°òÂÄòË∫∫Ê∑åË∂üÁÉ´ÊéèÊ∂õÊªîÁª¶ËêÑÊ°ÉÈÄÉÊ∑òÈô∂ËÆ®Â•óÁâπËó§ËÖæÁñºË™äÊ¢ØÂâîË∏¢ÈîëÊèêÈ¢òËπÑÂïº‰ΩìÊõøÂöèÊÉïÊ∂ïÂâÉÂ±âÂ§©Ê∑ªÂ°´Áî∞ÁîúÊÅ¨ËàîËÖÜÊåëÊù°Ëø¢Áú∫Ë∑≥Ë¥¥ÈìÅÂ∏ñÂéÖÂê¨ÁÉÉÊ±ÄÂª∑ÂÅú‰∫≠Â∫≠Êå∫ËâáÈÄöÊ°êÈÖÆÁû≥ÂêåÈìúÂΩ§Á´•Ê°∂ÊçÖÁ≠íÁªüÁóõÂÅ∑ÊäïÂ§¥ÈÄèÂá∏ÁßÉÁ™ÅÂõæÂæíÈÄîÊ∂ÇÂ±†ÂúüÂêêÂÖîÊπçÂõ¢Êé®È¢ìËÖøËúïË§™ÈÄÄÂêûÂ±ØËáÄÊãñÊâòËÑ±È∏µÈôÄÈ©ÆÈ©ºÊ§≠Â¶•ÊãìÂîæÊåñÂìáËõôÊ¥ºÂ®ÉÁì¶Ë¢úÊ≠™Â§ñÂºØÊπæÁé©È°Ω‰∏∏ÁÉ∑ÂÆåÁ¢óÊåΩÊôöÁöñÊÉãÂÆõÂ©â‰∏áËÖïÊ±™Áéã‰∫°ÊûâÁΩëÂæÄÊó∫ÊúõÂøòÂ¶ÑÂ®ÅÂ∑çÂæÆÂç±Èü¶ËøùÊ°ÖÂõ¥ÂîØÊÉü‰∏∫ÊΩçÁª¥ËãáËêéÂßî‰ºü‰º™Â∞æÁ∫¨Êú™ËîöÂë≥ÁïèËÉÉÂñÇÈ≠è‰ΩçÊ∏≠Ë∞ìÂ∞âÊÖ∞Âç´ÁòüÊ∏©ËöäÊñáÈóªÁ∫πÂêªÁ®≥Á¥äÈóÆÂó°ÁøÅÁìÆÊåùËúóÊ∂°Á™ùÊàëÊñ°ÂçßÊè°Ê≤ÉÂ∑´ÂëúÈí®‰πåÊ±°ËØ¨Â±ãÊó†ËäúÊ¢ßÂêæÂê¥ÊØãÊ≠¶‰∫îÊçÇÂçàËàû‰ºç‰æÆÂùûÊàäÈõæÊô§Áâ©ÂãøÂä°ÊÇüËØØÊòîÁÜôÊûêË•øÁ°íÁüΩÊô∞ÂòªÂê∏Èî°Áâ∫Á®ÄÊÅØÂ∏åÊÇâËÜùÂ§ïÊÉúÁÜÑÁÉØÊ∫™Ê±êÁäÄÊ™ÑË¢≠Â∏≠‰π†Â™≥ÂñúÈì£Ê¥óÁ≥ªÈöôÊàèÁªÜÁûéËôæÂå£ÈúûËæñÊöáÂ≥°‰æ†Áã≠‰∏ãÂé¶Â§èÂêìÊéÄÈî®ÂÖà‰ªôÈ≤úÁ∫§Âí∏Ë¥§Ë°îËà∑Èó≤Ê∂éÂº¶Â´åÊòæÈô©Áé∞ÁåÆÂéøËÖ∫È¶ÖÁæ°ÂÆ™Èô∑ÈôêÁ∫øÁõ∏Âé¢Èï∂È¶ôÁÆ±Ë•ÑÊπò‰π°ÁøîÁ••ËØ¶ÊÉ≥Âìç‰∫´È°πÂ∑∑Ê©°ÂÉèÂêëË±°ËêßÁ°ùÈúÑÂâäÂìÆÂö£ÈîÄÊ∂àÂÆµÊ∑ÜÊôìÂ∞èÂ≠ùÊ†°ËÇñÂï∏Á¨ëÊïàÊ•î‰∫õÊ≠áËùéÈûãÂçèÊåüÊê∫ÈÇ™ÊñúËÉÅË∞êÂÜôÊ¢∞Âç∏ËüπÊáàÊ≥ÑÊ≥ªË∞¢Â±ëËñ™ËäØÈîåÊ¨£ËæõÊñ∞ÂøªÂøÉ‰ø°Ë°ÖÊòüËÖ•Áå©ÊÉ∫ÂÖ¥ÂàëÂûãÂΩ¢ÈÇ¢Ë°åÈÜíÂπ∏ÊùèÊÄßÂßìÂÖÑÂá∂ËÉ∏ÂåàÊ±πÈõÑÁÜä‰ºë‰øÆÁæûÊúΩÂóÖÈîàÁßÄË¢ñÁª£Â¢üÊàåÈúÄËôöÂòòÈ°ªÂæêËÆ∏ËìÑÈÖóÂèôÊó≠Â∫èÁïúÊÅ§ÁµÆÂ©øÁª™Áª≠ËΩ©ÂñßÂÆ£ÊÇ¨ÊóãÁéÑÈÄâÁô£Áú©ÁªöÈù¥ËñõÂ≠¶Á©¥Èõ™Ë°ÄÂããÁÜèÂæ™Êó¨ËØ¢ÂØªÈ©ØÂ∑°ÊÆâÊ±õËÆ≠ËÆØÈÄäËøÖÂéãÊäºÈ∏¶È∏≠ÂëÄ‰∏´ËäΩÁâôËöúÂ¥ñË°ôÊ∂ØÈõÖÂìë‰∫öËÆ∂ÁÑâÂíΩÈòâÁÉüÊ∑πÁõê‰∏•Á†îÂ≤©Âª∂Ë®ÄÈ¢úÈòéÁÇéÊ≤øÂ•ÑÊé©ÁúºË°çÊºîËâ≥Â†∞ÁáïÂéåÁ†öÈõÅÂîÅÂΩ¶ÁÑ∞ÂÆ¥Ë∞öÈ™åÊÆÉÂ§ÆÈ∏ØÁßßÊù®Êâ¨‰ΩØÁñ°ÁæäÊ¥ãÈò≥Ê∞ß‰ª∞ÁóíÂÖªÊ†∑ÊºæÈÇÄËÖ∞Â¶ñÁë∂ÊëáÂ∞ßÈÅ•Á™ëË∞£ÂßöÂí¨ËàÄËçØË¶ÅËÄÄÊ§∞ÂôéËÄ∂Áà∑ÈáéÂÜ∂‰πüÈ°µÊéñ‰∏öÂè∂Êõ≥ËÖãÂ§úÊ∂≤‰∏ÄÂ£πÂåªÊèñÈì±‰æù‰ºäË°£È¢êÂ§∑ÈÅóÁßª‰ª™ËÉ∞ÁñëÊ≤ÇÂÆúÂß®ÂΩùÊ§ÖËöÅÂÄöÂ∑≤‰πôÁü£‰ª•Ëâ∫ÊäëÊòìÈÇëÂ±π‰∫øÂΩπËáÜÈÄ∏ËÇÑÁñ´‰∫¶Ë£îÊÑèÊØÖÂøÜ‰πâÁõäÊ∫¢ËØ£ËÆÆË∞äËØëÂºÇÁøºÁøåÁªéËåµËç´Âõ†ÊÆ∑Èü≥Èò¥ÂßªÂêüÈì∂Ê∑´ÂØÖÈ•ÆÂ∞πÂºïÈöêÂç∞Ëã±Ê®±Â©¥Èπ∞Â∫îÁº®ËéπËê§Ëê•ËçßËùáËøéËµ¢ÁõàÂΩ±È¢ñÁ°¨Êò†ÂìüÊã•‰Ω£ËáÉÁóàÂ∫∏ÈõçË∏äËõπÂíèÊ≥≥Ê∂åÊ∞∏ÊÅøÂãáÁî®ÂπΩ‰ºòÊÇ†ÂøßÂ∞§Áî±ÈÇÆÈìÄÁäπÊ≤πÊ∏∏ÈÖâÊúâÂèãÂè≥‰ΩëÈáâËØ±ÂèàÂπºËøÇÊ∑§‰∫éÁõÇÊ¶ÜËôûÊÑöËàÜ‰Ωô‰øûÈÄæÈ±ºÊÑâÊ∏ùÊ∏îÈöÖ‰∫àÂ®±Èõ®‰∏éÂ±øÁ¶πÂÆáËØ≠ÁæΩÁéâÂüüËäãÈÉÅÂêÅÈÅáÂñªÂ≥™Âæ°ÊÑàÊ¨≤Áã±ËÇ≤Ë™âÊµ¥ÂØìË£ïÈ¢ÑË±´È∏≥Ê∏äÂÜ§ÂÖÉÂû£Ë¢ÅÂéüÊè¥ËæïÂõ≠ÂëòÂúÜÁåøÊ∫êÁºòËøúËãëÊÑøÊÄ®Èô¢Êõ∞Á∫¶Ë∂äË∑ÉÈí•Â≤≥Á≤§ÊúàÊÇ¶ÈòÖËØªËÄò‰∫ëÈÉßÂåÄÈô®ÂÖÅËøêËï¥ÈÖùÊôïÈüµÂ≠ïÂåùÁ†∏ÊùÇÊ†ΩÂìâÁÅæÂÆ∞ËΩΩÂÜçÂú®Âí±ÊîíÊöÇËµûËµÉËÑèËë¨ÈÅ≠Á≥üÂáøËóªÊû£Êó©Êæ°Ëö§Ë∫ÅÂô™ÈÄ†ÁöÇÁÅ∂Áá•Ë¥£Êã©ÂàôÊ≥ΩË¥ºÊÄéÂ¢ûÊÜéÊõæËµ†ÊâéÂñ≥Ê∏£Êú≠ËΩßÈì°Èó∏Áú®Ê†ÖÊ¶®Âíã‰πçÁÇ∏ËØàÊëòÊñãÂÆÖÁ™ÑÂÄ∫ÂØ®ÁûªÊØ°ÊñΩÁ≤òÊ≤æË©πÊØ°Â±ïÊàòÁ´ôÊπõÁªΩÊ®üÁ´†ÂΩ∞Êº≥Âº†ÊéåÊ∂®Êùñ‰∏àÂ∏êË¥¶‰ªóËÉÄÁò¥ÈöúÊãõÊò≠ÊâæÊ≤ºËµµÁÖßÁΩ©ÂÖÜËÇáÂè¨ÈÅÆÊäòÂì≤Ëõ∞ËæôËÄÖÈîóËîóËøôÊµôÁèçÊñüÁúüÁîÑÁ†ßËáªË¥ûÈíà‰æ¶ÊûïÁñπËØäÈúáÊåØÈïáÈòµËí∏Êå£ÁùÅÂæÅÁã∞‰∫âÊÄîÊï¥ÊãØÊ≠£ÊîøÂ∏ßÁóáÈÉëËØÅËäùÊûùÊîØÂê±ËúòÁü•ËÇ¢ËÑÇÊ±Å‰πãÁªáËÅåÁõ¥Ê§çÊÆñÊâßÂÄº‰æÑÂùÄÊåáÊ≠¢Ë∂æÂè™Êó®Á∫∏ÂøóÊåöÊé∑Ëá≥Ëá¥ÁΩÆÂ∏úÂ≥ôÂà∂Êô∫Áß©Á®öË¥®ÁÇôÁóîÊªûÊ≤ªÁ™í‰∏≠ÁõÖÂø†ÈíüË°∑ÁªàÁßçËÇøÈáç‰ª≤‰ºóËàüÂë®Â∑ûÊ¥≤ËØåÁ≤•ËΩ¥ËÇòÂ∏öÂííÁö±ÂÆôÊòºÈ™§Áè†Ê†™ËõõÊú±Áå™ËØ∏ËØõÈÄêÁ´πÁÉõÁÖÆÊãÑÁû©Âò±‰∏ªËëóÊü±Âä©ËõÄË¥ÆÈì∏Á≠ë‰ΩèÊ≥®Á•ùÈ©ªÊäìÁà™ÊãΩ‰∏ìÁ†ñËΩ¨Êí∞ËµöÁØÜÊ°©Â∫ÑË£ÖÂ¶ÜÊíûÂ£ÆÁä∂Ê§éÈî•ËøΩËµòÂù†ÁºÄË∞ÜÂáÜÊçâÊãôÂçìÊ°åÁê¢ËåÅÈÖåÂïÑÁùÄÁÅºÊµäÂÖπÂí®ËµÑÂßøÂßøÊªãÊ∑ÑÂ≠úÁ¥´‰ªîÁ±ΩÊªìÂ≠êËá™Ê∏çÂ≠óÈ¨ÉÊ£ïË∏™ÂÆóÁªºÊÄªÁ∫µÈÇπËµ∞Â•èÊèçÁßüË∂≥ÂçíÊóèÁ•ñËØÖÈòªÁªÑÈíªÁ∫ÇÂò¥ÈÜâÊúÄÁΩ™Â∞äÈÅµÊò®Â∑¶‰ΩêÊüûÂÅö‰ΩúÂùêÂ∫ßÂùêÂ∫ß";

        const PINYIN_INITIALS = ['Êó†','b','p','m','f','d','t','n','l','g','k','h','j','q','x','zh','ch','sh','r','z','c','s','y','w'];
        const PINYIN_MEDIALS = ['','i','u','v'];
        const PINYIN_FINALS = ['a','o','e','ai','ei','ao','ou','an','en','ang','eng','ong','i','ia','ie','iao','iu','ian','in','iang','ing','iong','u','ua','uo','ui','uai','uan','un','uang','v','ve','vn'];

        const SHOP_ITEMS = [
            // Pets (Skins) - Prices 200-500
            { id: 'default', category: 'skin', name: 'ÈªòËÆ§Â∞èÁãó', emoji: 'üê∂', price: 0 },
            { id: 'cat', category: 'skin', name: 'Â∞èÁå´Âí™', emoji: 'üê±', price: 200 },
            { id: 'rabbit', category: 'skin', name: 'Â∞èÁôΩÂÖî', emoji: 'üê∞', price: 250 },
            { id: 'fox', category: 'skin', name: 'Â∞èÁãêÁã∏', emoji: 'ü¶ä', price: 300 },
            { id: 'pig', category: 'skin', name: 'Â∞èÁå™Áå™', emoji: 'üê∑', price: 300 },
            { id: 'tiger', category: 'skin', name: 'Â∞èËÄÅËôé', emoji: 'üêØ', price: 400 },
            { id: 'panda', category: 'skin', name: 'Â§ßÁÜäÁå´', emoji: 'üêº', price: 450 },
            { id: 'dragon', category: 'skin', name: '‰∏≠ÂõΩÈæô', emoji: 'üê≤', price: 500 },
            
            // Accessories - Prices 50-200
            { id: 'glasses', category: 'accessory', name: 'Â¢®Èïú', emoji: 'üï∂Ô∏è', price: 50 },
            { id: 'tie', category: 'accessory', name: 'È¢ÜÁªì', emoji: 'üéÄ', price: 60 },
            { id: 'flower', category: 'accessory', name: 'Ëä±Êúµ', emoji: 'üå∏', price: 60 },
            { id: 'balloon', category: 'accessory', name: 'Ê∞îÁêÉ', emoji: 'üéà', price: 70 },
            { id: 'scarf', category: 'accessory', name: 'Âõ¥Â∑æ', emoji: 'üß£', price: 80 },
            { id: 'hat', category: 'accessory', name: 'È≠îÊúØÂ∏Ω', emoji: 'üé©', price: 100 },
            { id: 'headphones', category: 'accessory', name: 'ËÄ≥Êú∫', emoji: 'üéß', price: 120 },
            { id: 'grad_cap', category: 'accessory', name: 'ÂçöÂ£´Â∏Ω', emoji: 'üéì', price: 150 },
            { id: 'star', category: 'accessory', name: 'ÊòüÊòü', emoji: 'üåü', price: 150 },
            { id: 'crown', category: 'accessory', name: 'ÁöáÂÜ†', emoji: 'üëë', price: 200 },
            { id: 'medal', category: 'accessory', name: 'Â•ñÁâå', emoji: 'ü•á', price: 200 },
            { id: 'mask', category: 'accessory', name: 'Âè£ÁΩ©', emoji: 'üò∑', price: 50 },
        ];

        const PET_DIALOGUES = {
            default: {
                cn: [
                    "‰πî‰æùÔºå‰Ω†ÊòØ‰∏ñÁïå‰∏äÊúÄÊ£íÁöÑ‰∏ÄÂπ¥Á∫ßÂ∞èÂ≠¶ÁîüÔºÅ",
                    "Ê±™Ê±™ÔºÅ‰πî‰æùÔºåÊàë‰πüÊÉ≥Ë¶Å‰∏Ä‰ª∂Á≤âËâ≤ÁöÑÊñ∞Ë°£ÊúçÔºÅ",
                    "‰πî‰æùÔºåÂÜôÁ¥Ø‰∫ÜÂêóÔºüÊë∏Êë∏ÊàëÁöÑÂ§¥‰ºëÊÅØ‰∏Ä‰∏ãÂêß„ÄÇ",
                    "‰πî‰æùÂä†Ê≤πÔºÅÊàë‰ª¨Â±ûÁãóÁöÑÂ∞èÊúãÂèã‰∏ç‰ªÖÂèØÁà±ÔºåËøòÂæàÂä™ÂäõÔºÅ",
                    "ÂìáÔºÅ‰πî‰æùÂÜôÂ≠óË∂äÊù•Ë∂äÂ•ΩÁúã‰∫ÜÔºåÊàëË¶ÅÁªô‰Ω†ÊØî‰∏™ÂøÉÔºÅ",
                    "ÂòøÂòøÔºå‰πî‰æùÔºå‰Ω†ÁúãÊàëÁöÑÂ∞æÂ∑¥ÊëáÂæóÂø´‰∏çÂø´Ôºü",
                    "‰πî‰æùÔºåÊàëÊòØ‰Ω†ÁöÑÂÆàÊä§Â∞èÁãóÔºåÊàë‰ºöÊ∞∏Ëøú‰øùÊä§‰Ω†ÔºÅ"
                ],
                en: [
                    "Winnie, you are amazing!",
                    "Woof! You represent the Year of the Dog!",
                    "Winnie, look at my tail wagging!",
                    "High five, Winnie!",
                    "I am your best friend, Winnie.",
                    "Winnie, keep going!",
                    "I will always protect you, Winnie."
                ]
            },
            cat: {
                cn: [
                    "Âñµ~ ÊàëÂ•ΩÂõ∞ÂëÄÔºå‰Ω†‰πü‰ºëÊÅØ‰∏Ä‰∏ãÂêß„ÄÇ",
                    "‰Ω†ÁöÑÂ≠óÂÜôÂæóÁúüÂ•ΩÁúãÔºåÂÉèÂ∞èÈ±ºÂπ≤‰∏ÄÊ†∑ËØ±‰∫∫ÔºÅ",
                    "ÂñµÂñµ~ Êàë‰ª¨Êù•ÊçâËø∑ËóèÂêßÔºü",
                    "ËΩªËΩªÂú∞ÂÜôÔºåÂÉèÊàëËµ∞Ë∑Ø‰∏ÄÊ†∑ËΩª„ÄÇ",
                    "Âñµ~ ‰Ω†ÊòØÊúÄ‰ºòÈõÖÁöÑÂ∞èÂ≠¶Áîü„ÄÇ",
                    "Âø´ÁúãÊàëÁÅµÊ¥ªÁöÑË∫´ÊâãÔºÅ"
                ],
                en: [
                    "Meow~ I'm sleepy, take a break.",
                    "Your writing is purr-fect!",
                    "Meow~ Let's play hide and seek.",
                    "Softly, like a cat walking.",
                    "You are graceful like a cat.",
                    "Look at my moves!"
                ]
            },
            rabbit: {
                cn: [
                    "Ëπ¶Ëπ¶Ë∑≥Ë∑≥ÔºÅÊàëÊòØÂø´‰πêÁöÑÂ∞èÁôΩÂÖîÔºÅ",
                    "ÊàëÁà±ÂêÉËÉ°ËêùÂçúÔºå‰πüÁà±Áúã‰Ω†Â≠¶‰π†ÔºÅ",
                    "‰Ω†ÁúãÊàëÁöÑËÄ≥ÊúµÈïø‰∏çÈïøÔºü",
                    "Âä†Ê≤πÔºåÂÉèÊàëË∑ëÂæó‰∏ÄÊ†∑Âø´ÔºÅ",
                    "‰ªäÂ§©‰πüÊòØÂÖÖÊª°Ê¥ªÂäõÁöÑ‰∏ÄÂ§©ÔºÅ",
                    "‰Ω†ÁöÑËøõÊ≠•ÂÉèË∑≥È´ò‰∏ÄÊ†∑Âø´ÔºÅ"
                ],
                en: [
                    "Hop hop hop! I am a happy bunny!",
                    "I love carrots and watching you learn!",
                    "Are my ears long?",
                    "Run fast like me!",
                    "Full of energy today!",
                    "You are improving so fast!"
                ]
            },
            fox: {
                cn: [
                    "ÊàëÊòØËÅ™ÊòéÁöÑÂ∞èÁãêÁã∏Ôºå‰Ω†‰πüÂæàËÅ™ÊòéÔºÅ",
                    "ÁúãÊàëÁöÑÂ∞æÂ∑¥ÔºåÊòØ‰∏çÊòØÂæàËì¨ÊùæÔºü",
                    "Âä®Âä®ËÑëÁ≠ãÔºåËøô‰∏™ÈóÆÈ¢òÈöæ‰∏çÂÄí‰Ω†„ÄÇ",
                    "Êàë‰ª¨‰∏ÄËµ∑ÂéªÊ£ÆÊûóÊé¢Èô©ÂêßÔºÅ",
                    "Êú∫Êô∫Â¶Ç‰Ω†Ôºå‰∏ÄÂÆöËÉΩÂ≠¶‰ºöÔºÅ"
                ],
                en: [
                    "I am a clever fox, and so are you!",
                    "Look at my fluffy tail!",
                    "Use your brain, you can do it.",
                    "Let's explore the forest!",
                    "Smart kid, you got this!"
                ]
            },
            pig: {
                cn: [
                    "ÂìºÂìº~ ÊàëÈ•ø‰∫ÜÔºåÂ≠¶‰π†ÂÆåÂêÉÁÇπÂøÉÂêßÔºÅ",
                    "Áù°ËßâÂíåÂ≠¶‰π†ÔºåÊàëÈÉΩÂñúÊ¨¢„ÄÇ",
                    "‰Ω†ÁúüÂã§Â•ãÔºå‰∏çÂÉèÊàëËøô‰πàÊáíÁå™Áå™„ÄÇ",
                    "ÂìºÂìº~ ÁªôÊàëÊå†Êå†ËÉåÂêß„ÄÇ",
                    "ÊÖ¢ÂêûÂêû‰πüÊ≤°ÂÖ≥Á≥ªÔºåÂè™Ë¶ÅÂú®ËøõÊ≠•ÔºÅ"
                ],
                en: [
                    "Oink~ I'm hungry, snack time later!",
                    "I love sleeping and learning.",
                    "You are so diligent!",
                    "Oink~ Scratch my back please.",
                    "Slow is okay, as long as you improve!"
                ]
            },
            tiger: {
                cn: [
                    "ÂêºÔºÅÊàëÊòØÊ£ÆÊûó‰πãÁéãÔºå‰Ω†ÊòØÂ≠¶‰π†‰πãÁéãÔºÅ",
                    "ÊãøÂá∫‰Ω†ÁöÑÂãáÊ∞îÔºåÊàòËÉúÂõ∞ÈöæÔºÅ",
                    "ÂÉèËÄÅËôé‰∏ÄÊ†∑Âº∫Â£ÆÔºåÂÉèËÄÅËôé‰∏ÄÊ†∑ËÅ™ÊòéÔºÅ",
                    "Ë∞Å‰πü‰∏çÊï¢ÊâìÊâ∞‰Ω†Â≠¶‰π†ÔºÅ",
                    "ÂêºÔºÅ‰ªäÂ§©ÁöÑË°®Áé∞ÈùûÂ∏∏Â®ÅÈ£éÔºÅ"
                ],
                en: [
                    "Roar! I am the King, you are the Study King!",
                    "Be brave and conquer challenges!",
                    "Strong like a tiger, smart like a tiger!",
                    "No one disturbs your study!",
                    "Roar! Awesome performance today!"
                ]
            },
            panda: {
                cn: [
                    "ÊàëÊÉ≥ÂêÉÁ´πÂ≠êÔºå‰Ω†ÊÉ≥ÂÜôÊ±âÂ≠óÂêóÔºü",
                    "ÊÖ¢‰∏ãÊù•Ôºå‰∫´ÂèóÂ≠¶‰π†ÁöÑ‰πêË∂£„ÄÇ",
                    "ÊàëÊòØÂõΩÂÆùÔºå‰Ω†‰πüÊòØÂÆ∂ÈáåÁöÑÂÆùË¥ù„ÄÇ",
                    "ÈªëÁúºÂúàÊòØÂõ†‰∏∫Â≠¶‰π†Â§™Áî®Âäü‰∫ÜÂêóÔºü",
                    "Êä±Êä±ÊàëÔºåËΩØÁªµÁªµÁöÑÂæàËàíÊúçÂì¶„ÄÇ"
                ],
                en: [
                    "I want bamboo, do you want to write?",
                    "Slow down and enjoy learning.",
                    "I am a national treasure, and so are you.",
                    "Working too hard?",
                    "Hug me, I'm soft and fluffy."
                ]
            },
            dragon: {
                cn: [
                    "ÂêºÔºÅÊàëÊòØ‰∏≠ÂõΩÈæôÔºåÂ∏¶‰Ω†È£ûÂêë‰∫ëÁ´ØÔºÅ",
                    "È£ûÈæôÂú®Â§©ÔºåÂ≠¶Êó†Ê≠¢Â¢É„ÄÇ",
                    "‰Ω†ÁöÑÊΩúÂäõÂÉèÂ§ßÊµ∑‰∏ÄÊ†∑Ê∑±‰∏çÂèØÊµã„ÄÇ",
                    "‰∏ç‰ªÖË¶ÅÂÜôÂæóÂ•ΩÔºåËøòË¶ÅÊúâÊ∞îÂäøÔºÅ",
                    "Á•ûÈæô‰øù‰Ωë‰Ω†ËÄÉËØï‰∏ÄÁôæÂàÜÔºÅ"
                ],
                en: [
                    "Roar! I am the Dragon, fly with me!",
                    "Sky is the limit for learning.",
                    "Your potential is deep like the ocean.",
                    "Write with power and spirit!",
                    "Dragon luck for your exams!"
                ]
            }
        };

        const playAudio = (text, isEnglish = false) => {
            try {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.lang = isEnglish ? 'en-US' : 'zh-CN';
                u.pitch = 1.0; 
                u.rate = 0.85; 
                window.speechSynthesis.speak(u);
            } catch (err) {
                console.warn("Audio error:", err);
            }
        };

        const PHONICS_DATA = [
            { 
                id: 'A', word: 'Apple', meaning: 'ËãπÊûú', emoji: 'üçé', options: ['A', 'O', 'U'],
                vocab: [{en: 'Ant', cn: 'ËöÇËöÅ'}, {en: 'Arm', cn: 'ÊâãËáÇ'}, {en: 'Art', cn: 'Ëâ∫ÊúØ'}]
            },
            { 
                id: 'B', word: 'Bear', meaning: 'Â∞èÁÜä', emoji: 'üêª', options: ['B', 'P', 'D'],
                vocab: [{en: 'Ball', cn: 'ÁêÉ'}, {en: 'Bird', cn: 'È∏ü'}, {en: 'Book', cn: '‰π¶'}]
            },
            { 
                id: 'C', word: 'Cat', meaning: 'Â∞èÁå´', emoji: 'üê±', options: ['C', 'K', 'S'],
                vocab: [{en: 'Car', cn: 'Ê±ΩËΩ¶'}, {en: 'Cup', cn: 'ÊùØÂ≠ê'}, {en: 'Cake', cn: 'ËõãÁ≥ï'}]
            },
            { 
                id: 'D', word: 'Dog', meaning: 'Â∞èÁãó', emoji: 'üê∂', options: ['D', 'B', 'P'],
                vocab: [{en: 'Duck', cn: 'È∏≠Â≠ê'}, {en: 'Door', cn: 'Èó®'}, {en: 'Desk', cn: '‰π¶Ê°å'}]
            },
            { 
                id: 'E', word: 'Egg', meaning: 'È∏°Ëõã', emoji: 'ü•ö', options: ['E', 'I', 'A'],
                vocab: [{en: 'Elephant', cn: 'Â§ßË±°'}, {en: 'Ear', cn: 'ËÄ≥Êúµ'}, {en: 'Eye', cn: 'ÁúºÁùõ'}]
            },
            { 
                id: 'F', word: 'Fish', meaning: 'Â∞èÈ±º', emoji: 'üêü', options: ['F', 'T', 'V'],
                vocab: [{en: 'Frog', cn: 'ÈùíËõô'}, {en: 'Fan', cn: 'È£éÊâá'}, {en: 'Foot', cn: 'ËÑö'}]
            },
            { 
                id: 'G', word: 'Girl', meaning: 'Â•≥Â≠©', emoji: 'üëß', options: ['G', 'J', 'K'],
                vocab: [{en: 'Goat', cn: 'Â±±Áæä'}, {en: 'Grass', cn: 'Ëçâ'}, {en: 'Green', cn: 'ÁªøËâ≤'}]
            },
            { 
                id: 'H', word: 'Happy', meaning: 'ÂºÄÂøÉ', emoji: 'üòÑ', options: ['H', 'M', 'N'],
                vocab: [{en: 'Hat', cn: 'Â∏ΩÂ≠ê'}, {en: 'Hand', cn: 'Êâã'}, {en: 'House', cn: 'ÊàøÂ≠ê'}]
            },
            { 
                id: 'I', word: 'Ice', meaning: 'ÂÜ∞Âùó', emoji: 'üßä', options: ['I', 'E', 'L'],
                vocab: [{en: 'Ink', cn: 'Â¢®Ê∞¥'}, {en: 'Insect', cn: 'ÊòÜËô´'}, {en: 'Island', cn: 'Â≤õÂ±ø'}]
            },
            { 
                id: 'J', word: 'Juice', meaning: 'ÊûúÊ±Å', emoji: 'üßÉ', options: ['J', 'G', 'Y'],
                vocab: [{en: 'Jelly', cn: 'ÊûúÂÜª'}, {en: 'Jump', cn: 'Ë∑≥'}, {en: 'Jar', cn: 'ÁΩêÂ≠ê'}]
            },
            { 
                id: 'K', word: 'Kite', meaning: 'È£éÁ≠ù', emoji: 'ü™Å', options: ['K', 'C', 'X'],
                vocab: [{en: 'Key', cn: 'Èí•Âåô'}, {en: 'King', cn: 'ÂõΩÁéã'}, {en: 'Kangaroo', cn: 'Ë¢ãÈº†'}]
            },
            { 
                id: 'L', word: 'Lion', meaning: 'ÁãÆÂ≠ê', emoji: 'ü¶Å', options: ['L', 'I', 'R'],
                vocab: [{en: 'Leaf', cn: 'Ê†ëÂè∂'}, {en: 'Leg', cn: 'ËÖø'}, {en: 'Lamp', cn: 'Âè∞ÁÅØ'}]
            },
            { 
                id: 'M', word: 'Moon', meaning: 'Êúà‰∫Æ', emoji: 'üåô', options: ['M', 'N', 'W'],
                vocab: [{en: 'Monkey', cn: 'Áå¥Â≠ê'}, {en: 'Milk', cn: 'ÁâõÂ•∂'}, {en: 'Map', cn: 'Âú∞Âõæ'}]
            },
            { 
                id: 'N', word: 'Nose', meaning: 'ÈºªÂ≠ê', emoji: 'üëÉ', options: ['N', 'M', 'U'],
                vocab: [{en: 'Net', cn: 'ÁΩë'}, {en: 'Nest', cn: 'È∏üÂ∑¢'}, {en: 'Night', cn: 'Â§úÊôö'}]
            },
            { 
                id: 'O', word: 'Orange', meaning: 'Ê©ôÂ≠ê', emoji: 'üçä', options: ['O', 'A', 'Q'],
                vocab: [{en: 'Octopus', cn: 'Á´†È±º'}, {en: 'Owl', cn: 'Áå´Â§¥Èπ∞'}, {en: 'Onion', cn: 'Ê¥ãËë±'}]
            },
            { 
                id: 'P', word: 'Pig', meaning: 'Â∞èÁå™', emoji: 'üê∑', options: ['P', 'B', 'D'],
                vocab: [{en: 'Pen', cn: 'Èí¢Á¨î'}, {en: 'Pan', cn: 'Âπ≥Â∫ïÈîÖ'}, {en: 'Park', cn: 'ÂÖ¨Âõ≠'}]
            },
            { 
                id: 'Q', word: 'Queen', meaning: 'Â•≥Áéã', emoji: 'üë∏', options: ['Q', 'O', 'P'],
                vocab: [{en: 'Quilt', cn: 'Ë¢´Â≠ê'}, {en: 'Quiz', cn: 'ÊµãÈ™å'}, {en: 'Quiet', cn: 'ÂÆâÈùô'}]
            },
            { 
                id: 'R', word: 'Rabbit', meaning: 'ÂÖîÂ≠ê', emoji: 'üê∞', options: ['R', 'P', 'B'],
                vocab: [{en: 'Red', cn: 'Á∫¢Ëâ≤'}, {en: 'Rose', cn: 'Áé´Áë∞'}, {en: 'Rain', cn: 'Èõ®'}]
            },
            { 
                id: 'S', word: 'Sun', meaning: 'Â§™Èò≥', emoji: '‚òÄÔ∏è', options: ['S', 'C', 'Z'],
                vocab: [{en: 'Snake', cn: 'Ëõá'}, {en: 'Star', cn: 'ÊòüÊòü'}, {en: 'Sock', cn: 'Ë¢úÂ≠ê'}]
            },
            { 
                id: 'T', word: 'Tiger', meaning: 'ËÄÅËôé', emoji: 'üêØ', options: ['T', 'F', 'L'],
                vocab: [{en: 'Table', cn: 'Ê°åÂ≠ê'}, {en: 'Tree', cn: 'Ê†ë'}, {en: 'Ten', cn: 'ÂçÅ'}]
            },
            { 
                id: 'U', word: 'Umbrella', meaning: 'Èõ®‰ºû', emoji: '‚òÇÔ∏è', options: ['U', 'V', 'Y'],
                vocab: [{en: 'Up', cn: 'Âêë‰∏ä'}, {en: 'Uncle', cn: 'ÂèîÂèî'}, {en: 'Under', cn: '‰∏ãÈù¢'}]
            },
            { 
                id: 'V', word: 'Van', meaning: 'Ë¥ßËΩ¶', emoji: 'üöê', options: ['V', 'W', 'U'],
                vocab: [{en: 'Violin', cn: 'Â∞èÊèêÁê¥'}, {en: 'Vest', cn: 'ËÉåÂøÉ'}, {en: 'Vase', cn: 'Ëä±Áì∂'}]
            },
            { 
                id: 'W', word: 'Water', meaning: 'Ê∞¥', emoji: 'üíß', options: ['W', 'M', 'V'],
                vocab: [{en: 'Watch', cn: 'ÊâãË°®'}, {en: 'Wolf', cn: 'Áãº'}, {en: 'Wind', cn: 'È£é'}]
            },
            { 
                id: 'X', word: 'Box', meaning: 'ÁõíÂ≠ê', emoji: 'üì¶', options: ['X', 'S', 'K'],
                vocab: [{en: 'X-ray', cn: 'XÂÖâ'}, {en: 'Fox', cn: 'ÁãêÁã∏'}, {en: 'Mix', cn: 'Ê∑∑Âêà'}]
            },
            { 
                id: 'Y', word: 'Yo-yo', meaning: 'Ê∫úÊ∫úÁêÉ', emoji: 'ü™Ä', options: ['Y', 'I', 'J'],
                vocab: [{en: 'Yellow', cn: 'ÈªÑËâ≤'}, {en: 'Yak', cn: 'Áâ¶Áâõ'}, {en: 'Yogurt', cn: 'ÈÖ∏Â•∂'}]
            },
            { 
                id: 'Z', word: 'Zebra', meaning: 'ÊñëÈ©¨', emoji: 'ü¶ì', options: ['Z', 'S', 'X'],
                vocab: [{en: 'Zoo', cn: 'Âä®Áâ©Âõ≠'}, {en: 'Zero', cn: 'Èõ∂'}, {en: 'Zip', cn: 'ÊãâÈìæ'}]
            },
        ];

        const ChineseKnotIcon = () => (
             <svg width="28" height="28" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" className="drop-shadow-sm">
                <defs>
                    <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                        <feGaussianBlur stdDeviation="2" result="blur" />
                        <feComposite in="SourceGraphic" in2="blur" operator="over" />
                    </filter>
                </defs>
                <rect x="34" y="34" width="32" height="32" transform="rotate(45 50 50)" fill="#D32F2F" stroke="#B71C1C" strokeWidth="2" />
                <path d="M50 34 C50 20, 65 20, 65 35" stroke="#D32F2F" strokeWidth="4" fill="none" transform="rotate(-45 50 50)" />
                <path d="M50 34 C50 20, 35 20, 35 35" stroke="#D32F2F" strokeWidth="4" fill="none" transform="rotate(45 50 50)" />
                <path d="M50 66 C50 80, 65 80, 65 65" stroke="#D32F2F" strokeWidth="4" fill="none" transform="rotate(45 50 50)" />
                <path d="M50 66 C50 80, 35 80, 35 65" stroke="#D32F2F" strokeWidth="4" fill="none" transform="rotate(-45 50 50)" />
                <line x1="50" y1="74" x2="50" y2="95" stroke="#D32F2F" strokeWidth="4" strokeLinecap="round" />
                <line x1="42" y1="78" x2="42" y2="92" stroke="#D32F2F" strokeWidth="2" strokeLinecap="round" />
                <line x1="58" y1="78" x2="58" y2="92" stroke="#D32F2F" strokeWidth="2" strokeLinecap="round" />
                <rect x="42" y="42" width="16" height="16" transform="rotate(45 50 50)" fill="#FFCDD2" />
            </svg>
        );

        const QuizIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                <path d="M2 2l7.586 7.586"></path>
                <circle cx="11" cy="11" r="2"></circle>
            </svg>
        );

        const ShopModal = ({ onClose, inventory, equippedSkin, equippedHat, balance, onBuy, onEquip }) => {
            const [activeTab, setActiveTab] = useState('skin');
            
            const skins = SHOP_ITEMS.filter(item => item.category === 'skin');
            const accessories = SHOP_ITEMS.filter(item => item.category === 'accessory');
            const displayItems = activeTab === 'skin' ? skins : accessories;

            return (
                <div className="fixed inset-0 z-[400] bg-white/95 backdrop-blur-xl flex flex-col items-center animate-pop p-4">
                    <div className="w-full flex justify-between items-center mb-4">
                        <button onClick={onClose} className="bg-gray-100 p-2 rounded-full text-xl w-10 h-10 shadow-sm">‚úï</button>
                        <h2 className="text-2xl font-black text-qy-text-pink font-chinese">Â∞èÁãóÂïÜÂ∫ó</h2>
                        <div className="flex items-center bg-yellow-100 px-3 py-1 rounded-full border border-yellow-200">
                            <span className="text-xl mr-1">ü™ô</span>
                            <span className="font-bold text-yellow-700">{balance}</span>
                        </div>
                    </div>

                    <div className="flex gap-2 mb-4 bg-gray-100 p-1 rounded-xl">
                        <button 
                            onClick={() => setActiveTab('skin')}
                            className={`px-6 py-2 rounded-lg font-bold transition-all ${activeTab === 'skin' ? 'bg-white text-qy-text-pink shadow-sm' : 'text-gray-400'}`}
                        >
                            ÂÆ†Áâ© Pets
                        </button>
                        <button 
                            onClick={() => setActiveTab('accessory')}
                            className={`px-6 py-2 rounded-lg font-bold transition-all ${activeTab === 'accessory' ? 'bg-white text-qy-text-pink shadow-sm' : 'text-gray-400'}`}
                        >
                            Ë£ÖÈ•∞ Items
                        </button>
                    </div>

                    <div className="flex-1 w-full overflow-y-auto px-1 pb-10">
                        <div className="grid grid-cols-2 gap-4">
                            {displayItems.map(item => {
                                const isOwned = inventory.includes(item.id) || item.id === 'default';
                                const isEquipped = item.category === 'skin' ? equippedSkin === item.id : equippedHat === item.id;
                                
                                return (
                                    <div key={item.id} className={`bg-white rounded-2xl p-4 shadow-md border-2 flex flex-col items-center ${isEquipped ? 'border-green-400 bg-green-50' : 'border-pink-100'}`}>
                                        <div className="text-5xl mb-3 relative">
                                            {item.emoji}
                                            {isOwned && isEquipped && <div className="absolute -top-2 -right-2 bg-green-500 text-white text-xs px-2 py-0.5 rounded-full">‰ΩøÁî®‰∏≠</div>}
                                        </div>
                                        <h3 className="font-bold text-gray-700 mb-2">{item.name}</h3>
                                        <div className="text-xs text-gray-400 font-bold mb-3">{item.category === 'skin' ? 'Skin' : 'Item'}</div>
                                        
                                        {isOwned ? (
                                            <button 
                                                onClick={() => onEquip(item)}
                                                disabled={isEquipped}
                                                className={`w-full py-2 rounded-xl font-bold transition-all ${isEquipped ? 'bg-gray-200 text-gray-400 cursor-default' : 'bg-green-500 text-white shadow-lg active:scale-95'}`}
                                            >
                                                {isEquipped ? 'Â∑≤Á©øÊà¥' : 'Á©øÊà¥'}
                                            </button>
                                        ) : (
                                            <button 
                                                onClick={() => onBuy(item)}
                                                disabled={balance < item.price}
                                                className={`w-full py-2 rounded-xl font-bold transition-all flex items-center justify-center gap-1 ${balance < item.price ? 'bg-gray-200 text-gray-400' : 'bg-yellow-400 text-yellow-900 shadow-lg active:scale-95'}`}
                                            >
                                                <span>ü™ô</span> {item.price}
                                            </button>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            )
        };

        const Mascot = ({ mode, status, skinId, hatId, className }) => {
            const isEnglish = mode === 'english';
            const [currentAnim, setCurrentAnim] = useState('');
            const [dialogue, setDialogue] = useState(null);
            
            // Visuals
            const skinItem = SHOP_ITEMS.find(i => i.id === skinId) || SHOP_ITEMS[0];
            const hatItem = SHOP_ITEMS.find(i => i.id === hatId);

            useEffect(() => {
                if (status === 'success') {
                    setCurrentAnim('animate-tada'); 
                } else if (status === 'sad') {
                    setCurrentAnim('animate-shake');
                } else {
                    setCurrentAnim('');
                    setDialogue(null); 
                }
            }, [status]);

            useEffect(() => {
                if (dialogue) {
                    const timer = setTimeout(() => {
                        setDialogue(null);
                    }, 5000); 
                    return () => clearTimeout(timer);
                }
            }, [dialogue]);

            const handleInteraction = (e) => {
                e.stopPropagation();
                
                // Get dialogue based on current skin
                const skinKey = PET_DIALOGUES[skinId] ? skinId : 'default';
                const dialogues = PET_DIALOGUES[skinKey];
                const list = isEnglish ? dialogues.en : dialogues.cn;
                const text = list[Math.floor(Math.random() * list.length)];
                
                setDialogue(text);

                // Simple generic animation for interaction
                setCurrentAnim('animate-tada');
                playAudio(text, isEnglish);
                
                setTimeout(() => {
                    setCurrentAnim('');
                }, 1000); 
            };

            const handleCloseDialogue = (e) => {
                e.stopPropagation();
                setDialogue(null);
            };

            return (
                <div className={`relative flex flex-col items-center justify-end ${className || ''}`} onClick={handleInteraction}>
                    {dialogue && (
                        <div 
                            onClick={handleCloseDialogue}
                            className="absolute bottom-[110%] w-40 z-[201] animate-pop cursor-pointer pointer-events-auto"
                        >
                            <div className={`bg-white p-3 rounded-2xl shadow-xl border-2 text-center relative
                                ${isEnglish ? 'border-qy-purple text-qy-text-purple' : 'border-qy-pink text-qy-text-pink'}`}>
                                <p className="text-sm font-bold leading-tight">{dialogue}</p>
                                <div className={`absolute -bottom-[8px] left-1/2 -translate-x-1/2 w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-t-[12px]
                                    ${isEnglish ? 'border-t-qy-purple' : 'border-t-qy-pink'}`}></div>
                            </div>
                        </div>
                    )}
                    <div 
                        className={`text-6xl sm:text-7xl filter drop-shadow-lg cursor-pointer hover:scale-110 active:scale-95 transition-transform relative z-10 ${currentAnim}`}
                    >
                        {skinItem.emoji}
                        {hatItem && (
                            <div className="absolute -top-4 left-1/2 -translate-x-1/2 text-4xl drop-shadow-md">
                                {hatItem.emoji}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const PinyinSelector = ({ onClose, onSelectChar }) => {
            const [step, setStep] = useState('initial');
            const [selectedInitial, setSelectedInitial] = useState('');
            const [selectedMedial, setSelectedMedial] = useState('');
            const [selectedFinal, setSelectedFinal] = useState('');
            const [matchedChars, setMatchedChars] = useState([]);
            const [validPinyins, setValidPinyins] = useState(new Set());

            useEffect(() => {
                if(!COMMON_CHARS) return;
                const set = new Set();
                const chars = COMMON_CHARS.split('');
                chars.forEach(char => {
                    const pyResult = cnchar.spell(char); 
                    const addPinyin = (p) => {
                         if(typeof p === 'string') set.add(p.toLowerCase());
                    }
                    if(Array.isArray(pyResult)) {
                        pyResult.forEach(addPinyin);
                    } else {
                        addPinyin(pyResult);
                    }
                });
                setValidPinyins(set);
            }, []);

            const handleInitialClick = (init) => {
                setSelectedInitial(init);
                setStep('final');
                setSelectedMedial('');
            };

            const handleMedialClick = (medial) => {
                setSelectedMedial(medial === selectedMedial ? '' : medial);
            };

            const handleFinalClick = (final) => {
                if (!checkCombination(selectedInitial, selectedMedial, final)) return;

                setSelectedFinal(final);
                const init = selectedInitial === 'Êó†' ? '' : selectedInitial;
                
                const { searchPinyin } = assemblePinyin(init, selectedMedial, final);

                const matches = [];
                const chars = COMMON_CHARS.split('');
                chars.forEach(char => {
                    const pyNoTone = cnchar.spell(char);
                    const pyList = Array.isArray(pyNoTone) ? pyNoTone : [pyNoTone];
                    const hasMatch = pyList.some(p => p.toLowerCase() === searchPinyin.toLowerCase());
                    if (hasMatch) matches.push(char);
                });

                const uniqueMatches = [...new Set(matches)];
                setMatchedChars(uniqueMatches);
                setStep('select');
            };

            const assemblePinyin = (init, medial, final) => {
                let p_init = init;
                let p_medial = medial;
                let p_final = final;

                if (['j', 'q', 'x'].includes(init) && medial === 'v') {
                    p_medial = 'u';
                }
                if (init === 'y' && medial === 'v') {
                    p_medial = 'u';
                }
                 if (['j', 'q', 'x'].includes(init) && final.startsWith('v')) {
                     p_final = final.replace('v', 'u');
                }
                const searchPinyin = p_init + p_medial + p_final;
                return { searchPinyin };
            };

            const checkCombination = (init, medial, final) => {
                const i = init === 'Êó†' ? '' : init;
                const { searchPinyin } = assemblePinyin(i, medial, final);
                return validPinyins.has(searchPinyin);
            };

            const isMedialValidForInitial = (medial) => {
                return PINYIN_FINALS.some(final => checkCombination(selectedInitial, medial, final));
            };

            const handleBack = () => {
                if (step === 'select') setStep('final');
                else if (step === 'final') setStep('initial');
            };

            return (
                <div className="fixed inset-0 z-[300] bg-white/95 backdrop-blur-xl flex flex-col items-center animate-pop p-4">
                    <div className="w-full flex justify-between items-center mb-6">
                        <button onClick={step === 'initial' ? onClose : handleBack} className="bg-gray-100 p-2 rounded-full text-2xl w-12 h-12 shadow-sm active:scale-90 transition-transform">
                             {step === 'initial' ? '‚úï' : 'üîô'}
                        </button>
                        <h2 className="text-2xl font-black text-qy-text-pink font-chinese tracking-widest">
                            {step === 'initial' && 'ÈÄâÂ£∞ÊØç'}
                            {step === 'final' && 'ÈÄâÈüµÊØç'}
                            {step === 'select' && 'ÈÄâÊ±âÂ≠ó'}
                        </h2>
                        <div className="w-12"></div>
                    </div>

                    <div className="flex items-center gap-2 mb-8 bg-pink-50 px-6 py-2 rounded-full border border-pink-100">
                        <span className={`text-2xl font-bold ${selectedInitial ? 'text-qy-text-pink' : 'text-gray-300'}`}>
                            {selectedInitial || '?'}
                        </span>
                        {selectedMedial && (
                            <>
                                <span className="text-gray-300">+</span>
                                <span className="text-2xl font-bold text-qy-text-pink">
                                    {selectedMedial === 'v' ? '√º' : selectedMedial}
                                </span>
                            </>
                        )}
                        <span className="text-gray-300">+</span>
                        <span className={`text-2xl font-bold ${selectedFinal ? 'text-qy-text-pink' : 'text-gray-300'}`}>
                            {selectedFinal ? (selectedFinal.startsWith('v') ? selectedFinal.replace('v','√º') : selectedFinal) : '?'}
                        </span>
                    </div>

                    <div className="flex-1 w-full overflow-y-auto px-2">
                        {step === 'initial' && (
                            <div className="grid grid-cols-4 gap-4 pb-20">
                                {PINYIN_INITIALS.map(init => (
                                    <button 
                                        key={init}
                                        onClick={() => handleInitialClick(init)}
                                        className={`aspect-square rounded-2xl border-2 shadow-md flex items-center justify-center font-bold transition-all
                                            ${init === 'Êó†' ? 'bg-gray-50 border-gray-200 text-gray-500 text-xl' : 'bg-white border-pink-100 text-gray-600 text-3xl'}
                                            hover:bg-qy-pink hover:text-white hover:scale-105 active:scale-95`}
                                    >
                                        {init}
                                    </button>
                                ))}
                            </div>
                        )}

                        {step === 'final' && (
                            <div className="w-full flex flex-col gap-6 pb-20">
                                {selectedInitial !== 'Êó†' && (
                                    <div className="bg-pink-50 rounded-2xl p-4 border border-pink-100">
                                        <div className="text-xs font-bold text-pink-400 mb-2 uppercase">ÈÄâÊã©‰ªãÊØç (Medial):</div>
                                        <div className="flex gap-4 justify-around">
                                            {PINYIN_MEDIALS.map(medial => {
                                                const isValid = isMedialValidForInitial(medial);
                                                const display = medial === '' ? 'Êó†' : (medial === 'v' ? '√º' : medial);
                                                const isSelected = selectedMedial === medial;

                                                return (
                                                    <button
                                                        key={medial}
                                                        onClick={() => isValid && handleMedialClick(medial)}
                                                        disabled={!isValid}
                                                        className={`px-6 py-2 rounded-xl font-bold text-lg transition-all border-2
                                                            ${!isValid ? 'opacity-30 border-transparent text-gray-300 cursor-not-allowed' : 
                                                              isSelected ? 'bg-qy-text-pink text-white border-qy-text-pink shadow-md scale-105' : 
                                                              'bg-white text-gray-600 border-pink-100 hover:border-pink-300'}`}
                                                    >
                                                        {display}
                                                    </button>
                                                )
                                            })}
                                        </div>
                                    </div>
                                )}

                                <div>
                                    <div className="text-xs font-bold text-pink-400 mb-2 ml-1 uppercase">ÈÄâÊã©ÈüµÊØç (Final):</div>
                                    <div className="grid grid-cols-4 gap-4">
                                        {PINYIN_FINALS.map(final => {
                                            const isValid = checkCombination(selectedInitial, selectedMedial, final);
                                            if (!isValid) return null;

                                            return (
                                                <button 
                                                    key={final}
                                                    onClick={() => handleFinalClick(final)}
                                                    className="aspect-square rounded-2xl border-2 shadow-md flex items-center justify-center text-2xl font-bold transition-all bg-white border-pink-100 text-gray-600 hover:bg-qy-pink hover:text-white hover:scale-105 active:scale-95 cursor-pointer"
                                                >
                                                    {final.replace('v', '√º')}
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        )}

                        {step === 'select' && (
                            <div className="flex flex-col items-center w-full pb-20">
                                {matchedChars.length === 0 ? (
                                    <div className="text-center mt-10">
                                        <div className="text-6xl mb-4">ü§î</div>
                                        <p className="text-gray-400 font-bold">Ê≤°ÊúâÊâæÂà∞Ëøô‰∏™ÊãºÈü≥ÁöÑÂ∏∏Áî®Â≠óÂì¶</p>
                                        <button onClick={()=>setStep('final')} className="mt-6 px-6 py-2 bg-pink-100 text-pink-500 rounded-full font-bold">Êç¢‰∏Ä‰∏™ÈüµÊØçËØïËØï</button>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-4 sm:grid-cols-5 gap-3 w-full">
                                        {matchedChars.map((char, idx) => (
                                            <button 
                                                key={idx}
                                                onClick={() => onSelectChar(char)}
                                                className="aspect-square rounded-2xl bg-white border-2 border-pink-100 shadow-sm flex flex-col items-center justify-center hover:bg-pink-50 hover:scale-110 active:scale-95 transition-all"
                                            >
                                                <span className="text-3xl font-chinese text-qy-text-pink">{char}</span>
                                            </button>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const HanziQuiz = ({ onClose, setMascotStatus, addPoints }) => {
            const [questions, setQuestions] = useState([]);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [isFinished, setIsFinished] = useState(false);
            const [animState, setAnimState] = useState('');
            const [earnedPoints, setEarnedPoints] = useState(0);
            const [wrongQuestions, setWrongQuestions] = useState([]); 

            useEffect(() => {
                generateQuiz();
            }, []);

            const generateQuiz = () => {
                const chars = COMMON_CHARS.split('');
                const quizSet = [];
                for(let i=0; i<5; i++) {
                    const targetChar = chars[Math.floor(Math.random() * chars.length)];
                    const pinyin = cnchar.spell(targetChar, 'tone').toLowerCase(); 
                    const type = Math.random() > 0.5 ? 'choose-hanzi' : 'choose-pinyin';

                    let options = [];
                    if (type === 'choose-hanzi') {
                        options = [targetChar];
                        while(options.length < 4) {
                            const r = chars[Math.floor(Math.random() * chars.length)];
                            if(!options.includes(r)) options.push(r);
                        }
                    } else {
                        options = [pinyin];
                        while(options.length < 4) {
                            const rChar = chars[Math.floor(Math.random() * chars.length)];
                            const rPinyin = cnchar.spell(rChar, 'tone').toLowerCase(); 
                            if(!options.includes(rPinyin) && rPinyin !== pinyin) options.push(rPinyin);
                        }
                    }
                    options.sort(() => Math.random() - 0.5);
                    quizSet.push({ targetChar, pinyin, type, options });
                }
                setQuestions(quizSet);
                
                if(quizSet.length > 0 && quizSet[0].type === 'choose-hanzi') {
                     setTimeout(() => playAudio(quizSet[0].targetChar), 500);
                }
            };

            const handleAnswer = (selectedOption) => {
                const currentQ = questions[currentIndex];
                let isCorrect = false;
                
                if (currentQ.type === 'choose-hanzi') {
                    isCorrect = selectedOption === currentQ.targetChar;
                } else {
                    isCorrect = selectedOption === currentQ.pinyin;
                }

                if(isCorrect) {
                    playAudio("ÂØπÂï¶", false);
                    setScore(prev => prev + 1);
                    setMascotStatus('success');
                    addPoints(1); // 1 Coin per correct answer
                    setEarnedPoints(prev => prev + 1);
                } else {
                    playAudio("ÂæàÈÅóÊÜæÔºåÁ≠îÈîô‰∫Ü", false);
                    setMascotStatus('sad');
                    setAnimState('animate-shake');
                    setWrongQuestions(prev => [...prev, currentQ]);
                }

                // Wait 1s then move to next question regardless of correctness
                setTimeout(() => {
                    setAnimState('');
                    setMascotStatus('idle');
                    if(currentIndex < questions.length - 1) {
                         setCurrentIndex(prev => prev + 1);
                         const nextQ = questions[currentIndex+1];
                         if (nextQ.type === 'choose-hanzi') {
                            playAudio(nextQ.targetChar);
                         }
                    } else {
                        setIsFinished(true);
                        playAudio("ÊµãËØïÂÆåÊàê", false);
                    }
                }, 1000);
            };

            const replayAudio = () => {
                if(!isFinished && questions[currentIndex]) {
                    playAudio(questions[currentIndex].targetChar);
                }
            };

            const restartQuiz = () => {
                setIsFinished(false);
                setScore(0);
                setEarnedPoints(0);
                setCurrentIndex(0);
                setWrongQuestions([]);
                setAnimState('');
                generateQuiz();
            };

            const currentQ = questions[currentIndex];

            return (
                <div className="fixed inset-0 z-[300] bg-white/95 backdrop-blur-xl flex flex-col items-center animate-pop p-4">
                     <div className="w-full flex justify-between items-center mb-6">
                        <button onClick={onClose} className="bg-gray-100 p-2 rounded-full text-xl w-10 h-10 shadow-sm">‚úï</button>
                        <h2 className="text-xl font-black text-qy-text-pink font-chinese">Â∞èÂçöÂ£´ÊµãËØï</h2>
                        <div className="w-10"></div>
                    </div>

                    {!isFinished && currentQ ? (
                        <div className="flex flex-col items-center w-full max-w-sm mt-4">
                            <div className="w-full bg-pink-100 rounded-full h-4 mb-8">
                                <div className="bg-qy-pink h-4 rounded-full transition-all duration-500" style={{width: `${(currentIndex / questions.length) * 100}%`}}></div>
                            </div>

                            {currentQ.type === 'choose-hanzi' ? (
                                <div className={`bg-white border-4 border-pink-100 rounded-3xl p-8 mb-10 shadow-lg flex flex-col items-center cursor-pointer transition-transform ${animState}`} onClick={replayAudio}>
                                    <div className="text-6xl mb-4">üîä</div>
                                    <div className="text-4xl font-black font-rounded text-qy-text-pink">
                                        {currentQ.pinyin}
                                    </div>
                                    <p className="text-gray-400 text-sm mt-2 font-bold">ÁÇπÂáªÂê¨ÂèëÈü≥</p>
                                </div>
                            ) : (
                                <div className={`bg-white border-4 border-pink-100 rounded-3xl p-8 mb-10 shadow-lg flex flex-col items-center transition-transform ${animState}`}>
                                    <div className="text-8xl font-chinese text-qy-text-pink mb-2">
                                        {currentQ.targetChar}
                                    </div>
                                    <p className="text-gray-400 text-sm mt-2 font-bold">ÈÄâÊã©Ê≠£Á°ÆÁöÑÊãºÈü≥</p>
                                </div>
                            )}

                            <div className="grid grid-cols-2 gap-4 w-full">
                                {currentQ.options.map((opt, i) => (
                                    <button 
                                        key={i}
                                        onClick={() => handleAnswer(opt)}
                                        className={`aspect-square bg-white border-2 border-pink-100 rounded-2xl shadow-sm hover:bg-qy-pink hover:text-white hover:scale-105 active:scale-95 transition-all flex items-center justify-center
                                            ${currentQ.type === 'choose-hanzi' ? 'text-4xl font-chinese' : 'text-2xl font-black font-rounded'}`}
                                    >
                                        {opt}
                                    </button>
                                ))}
                            </div>
                        </div>
                    ) : (
                        <div className="flex flex-col items-center justify-center h-full pb-20 w-full max-w-md">
                            <div className="text-8xl mb-6 animate-tada">
                                {score === questions.length ? 'üèÜ' : 'üìù'}
                            </div>
                            <h3 className="text-3xl font-black text-qy-text-pink mb-2">ÊµãËØïÂÆåÊàêÔºÅ</h3>
                            <p className="text-xl text-gray-500 font-bold mb-4">ÂæóÂàÜ: {score} / {questions.length}</p>
                            
                            {earnedPoints > 0 && (
                                <div className="bg-yellow-100 px-6 py-3 rounded-full mb-6 flex items-center border border-yellow-300 animate-pulse">
                                    <span className="text-3xl mr-2">ü™ô</span>
                                    <span className="text-2xl font-bold text-yellow-700">+{earnedPoints}</span>
                                </div>
                            )}

                            {wrongQuestions.length > 0 && (
                                <div className="w-full bg-red-50 rounded-2xl p-4 mb-6 border border-red-100 overflow-y-auto max-h-48">
                                    <h4 className="text-red-500 font-bold mb-3 text-center">ÈúÄË¶ÅÂ§ç‰π†ÁöÑÈ¢òÁõÆ</h4>
                                    <div className="space-y-2">
                                        {wrongQuestions.map((q, idx) => (
                                            <div key={idx} className="flex justify-between items-center bg-white p-2 rounded-lg shadow-sm">
                                                <div className="flex items-center gap-2">
                                                    <span className="font-chinese text-2xl text-gray-700">{q.targetChar}</span>
                                                    <span className="text-gray-400">({q.pinyin})</span>
                                                </div>
                                                <div className="text-sm font-bold text-green-500">
                                                    {q.type === 'choose-hanzi' ? 'ËÆ§Â≠ó' : 'ÊãºÈü≥'}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            <div className="flex gap-4 mt-4">
                                <button onClick={onClose} className="px-6 py-3 bg-white text-gray-500 border-2 border-gray-200 rounded-full font-bold text-lg shadow-sm hover:bg-gray-50 active:scale-95 transition-transform">
                                    ËøîÂõû‰∏ªÈ°µ
                                </button>
                                <button onClick={restartQuiz} className="px-8 py-3 bg-qy-text-pink text-white rounded-full font-bold text-lg shadow-lg hover:scale-105 active:scale-95 transition-transform">
                                    ÂÜçÁé©‰∏ÄÊ¨°
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const MiZiGe = () => (
            <svg viewBox="0 0 300 300" style={{ width: '100%', height: '100%' }}>
                <rect x="0" y="0" width="300" height="300" fill="white" rx="20" />
                <rect x="4" y="4" width="292" height="292" fill="none" stroke="#FFB7C5" strokeWidth="4" rx="20" />
                <line x1="0" y1="0" x2="300" y2="300" stroke="#FFCCD5" strokeWidth="2" strokeDasharray="8,8" />
                <line x1="300" y1="0" x2="0" y2="300" stroke="#FFCCD5" strokeWidth="2" strokeDasharray="8,8" />
                <line x1="150" y1="0" x2="150" y2="300" stroke="#FFCCD5" strokeWidth="2" strokeDasharray="8,8" />
                <line x1="0" y1="150" x2="300" y2="150" stroke="#FFCCD5" strokeWidth="2" strokeDasharray="8,8" />
            </svg>
        );

        const HanziPlayer = ({ char, mode, onMistake, onCorrect, onComplete }) => {
            const containerRef = useRef(null);
            const writerRef = useRef(null);

            useEffect(() => {
                if (containerRef.current) containerRef.current.innerHTML = ""; 
                if (!char) return;

                const timer = setTimeout(() => {
                    if (!containerRef.current || !window.HanziWriter) return;
                    try {
                        const writer = HanziWriter.create(containerRef.current, char, {
                            width: 300,
                            height: 300,
                            padding: 20,
                            showOutline: true,
                            strokeAnimationSpeed: 1, 
                            delayBetweenStrokes: 500,
                            coloring: 'auto',
                            radicalColor: '#D63384',
                            strokeColor: '#333333',
                            outlineColor: '#FFCCD5',
                            drawingWidth: 30,
                            charDataLoader: (char, onComplete) => {
                                fetch(`https://cdn.jsdelivr.net/npm/hanzi-writer-data@2.0/${char}.json`)
                                    .then(res => res.json())
                                    .then(onComplete)
                                    .catch(err => console.error("Fetch Failed:", err));
                            },
                            onLoadCharDataSuccess: (data) => {
                                writer.showCharacter(); 
                                if (mode === 'animate') {
                                    // Recursive loop function for continuous animation
                                    const loopAnimation = () => {
                                        writer.animateCharacter({
                                            onComplete: () => {
                                                setTimeout(loopAnimation, 1000); // Wait 1s then restart
                                            }
                                        });
                                    };
                                    loopAnimation();
                                } else if (mode === 'quiz') {
                                    writer.quiz({
                                        onMistake: onMistake,
                                        onCorrectStroke: onCorrect,
                                        onComplete: onComplete
                                    });
                                }
                            },
                            onLoadCharDataError: (err) => console.error("Writer Load Error:", err)
                        });
                        writerRef.current = writer;
                    } catch (e) {
                        console.error("Crash during create:", e);
                    }
                }, 500); 

                return () => {
                    clearTimeout(timer);
                    if (writerRef.current) {
                        try { writerRef.current.cancelQuiz(); } catch(e){}
                    }
                };
            }, [char, mode]); 

            return (
                <div className="relative animate-pop mx-auto" style={{ width: '300px', height: '300px', borderRadius: '30px', overflow: 'hidden', boxShadow: '0 10px 30px rgba(0,0,0,0.05)', border: '6px solid white', background: 'white' }}>
                    <div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', zIndex: 0 }}><MiZiGe /></div>
                    <div ref={containerRef} style={{ width: '300px', height: '300px', position: 'relative', zIndex: 10, cursor: 'pointer' }} />
                </div>
            );
        };

        const HanziView = ({ setMascotStatus, addPoints, skinId, hatId, mascotStatus }) => {
            const [charData, setCharData] = useState(null);
            const [selectedPinyin, setSelectedPinyin] = useState('');
            const [mode, setMode] = useState('quiz'); 
            const [feedback, setFeedback] = useState(''); 
            const [error, setError] = useState(null);
            const [showPinyinSelector, setShowPinyinSelector] = useState(false);
            const [showQuiz, setShowQuiz] = useState(false);
            const [associatedWords, setAssociatedWords] = useState([]);

            useEffect(() => {
                setTimeout(() => handleSearch('‰πî'), 100);
            }, []);

            const handleSearch = (char) => {
                setError(null);
                setFeedback('');
                setMascotStatus('idle');
                setAssociatedWords([]);
                
                if (!char || !/[\u4e00-\u9fa5]/.test(char)) {
                    setError('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑÊ±âÂ≠ó');
                    return;
                }
                
                try {
                    const rawPinyins = cnchar.spell(char, 'array', 'tone');
                    const strokesCount = cnchar.stroke(char);
                    const pinyins = (Array.isArray(rawPinyins) ? rawPinyins : [rawPinyins]).map(p => p.toLowerCase());

                    let words = [];
                    if (cnchar.words) {
                         const rawWords = cnchar.words(char);
                         if(Array.isArray(rawWords)) {
                             words = rawWords.filter(w => w !== char).slice(0, 3);
                         }
                    }

                    setCharData({
                        char,
                        pinyins: pinyins,
                        strokesCount,
                        id: Date.now() 
                    });
                    
                    setAssociatedWords(words);
                    setSelectedPinyin(pinyins[0]);
                    setMode('quiz'); 
                    playAudio(char, false);
                } catch (e) {
                    setError('Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªú~');
                    console.error(e);
                }
            };

            const handleComplete = () => {
                setFeedback('Â§™Ê£í‰∫ÜÔºÅüíØ');
                setMascotStatus('success');
                playAudio("ÂÜôÂæóÁúüÂ•Ω", false);
                setTimeout(() => setMascotStatus('idle'), 3000);
            };

            const readPinyin = (p) => {
                setSelectedPinyin(p); 
                playAudio(charData.char, false);
            };

            const handleSelectFromPinyin = (char) => {
                setShowPinyinSelector(false);
                handleSearch(char);
            };

            return (
                <div className="w-full max-w-lg px-4 flex flex-col items-center pt-1 pb-32">
                    {showPinyinSelector && (
                        <PinyinSelector 
                            onClose={() => setShowPinyinSelector(false)} 
                            onSelectChar={handleSelectFromPinyin} 
                        />
                    )}
                    {showQuiz && (
                        <HanziQuiz 
                            onClose={() => setShowQuiz(false)}
                            setMascotStatus={setMascotStatus}
                            addPoints={addPoints}
                        />
                    )}
                    {error && <div className="w-full bg-white text-qy-text-pink px-4 py-3 rounded-2xl mb-6 text-sm font-bold text-center border-2 border-pink-100 shadow-sm">{error}</div>}
                    
                    <div className="w-full flex flex-col items-center animate-pop">
                        <div className="w-full flex items-center justify-between gap-2 mb-4 relative z-10 px-1">
                            <div className="shrink-0">
                                <button 
                                    onClick={() => setShowPinyinSelector(true)}
                                    className="h-12 w-16 bg-qy-pink text-white rounded-2xl shadow-md active:scale-95 transition-all flex items-center justify-center border-b-4 border-pink-300"
                                >
                                    <span className="text-2xl">üîç</span>
                                </button>
                            </div>

                            <div className="flex-1 flex justify-center overflow-x-auto no-scrollbar">
                                {charData && (
                                    <div className="flex items-center gap-2 py-1">
                                        {charData.pinyins.map((p, idx) => (
                                            <button key={idx} onClick={() => readPinyin(p)} className={`h-11 px-4 rounded-xl text-lg font-black font-rounded transition-all border-b-4 shrink-0 whitespace-nowrap shadow-sm flex items-center justify-center ${selectedPinyin === p ? 'bg-white text-qy-text-pink border-qy-text-pink ring-2 ring-pink-100 scale-105' : 'bg-white text-gray-900 border-pink-200 hover:border-pink-300'}`}>
                                                {p}
                                            </button>
                                        ))}
                                    </div>
                                )}
                            </div>

                            <div className="flex-1 flex justify-end max-w-[80px]">
                                <button 
                                    onClick={() => setShowQuiz(true)}
                                    className="h-11 px-3 bg-white text-qy-text-purple border-2 border-purple-200 rounded-xl shadow-sm hover:bg-purple-50 active:scale-95 transition-all flex items-center gap-1 w-full justify-center"
                                >
                                    <span className="text-xl">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                                            <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                                            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                                            <path d="M2 2l7.586 7.586"></path>
                                        </svg>
                                    </span>
                                    <span className="font-bold text-sm hidden sm:inline">ÊµãËØï</span>
                                </button>
                            </div>
                        </div>

                        {charData ? (
                            <>
                                <div className="relative mb-6 w-full flex justify-center items-end">
                                    <div className="relative">
                                        <HanziPlayer 
                                            key={charData.id + mode} 
                                            char={charData.char} mode={mode}
                                            onMistake={() => {setFeedback('Âä†Ê≤πÔºÅ'); setTimeout(()=>setFeedback(''), 1000)}}
                                            onCorrect={() => {setFeedback('ÂØπÂï¶ÔºÅ'); setTimeout(()=>setFeedback(''), 800)}}
                                            onComplete={handleComplete}
                                        />
                                        {feedback && <div className="absolute -top-16 left-1/2 transform -translate-x-1/2 pointer-events-none z-30 w-full text-center"><span className="bg-qy-text-pink text-white px-4 py-2 rounded-xl font-bold shadow-xl text-lg animate-bounce border-2 border-white">{feedback}</span></div>}
                                    </div>
                                </div>
                                <div className="flex items-end justify-center w-full max-w-sm mb-8 gap-2">
                                    <div className="flex-1 flex gap-2">
                                        <button onClick={() => setMode('animate')} className={`flex-1 py-3 rounded-2xl font-bold transition-all shadow-md active:scale-95 flex items-center justify-center gap-1 text-sm sm:text-base border-b-4 ${mode === 'animate' ? 'bg-qy-pink text-white border-pink-400' : 'bg-white text-pink-400 border-pink-100'}`}>üëÄ ÁúãÂä®Áîª</button>
                                        <button onClick={() => setMode('quiz')} className={`flex-1 py-3 rounded-2xl font-bold transition-all shadow-md active:scale-95 flex items-center justify-center gap-1 text-sm sm:text-base border-b-4 ${mode === 'quiz' ? 'bg-qy-text-pink text-white border-pink-700' : 'bg-white text-pink-400 border-pink-100'}`}>‚úçÔ∏è ÂÜôÂÜôÁúã</button>
                                    </div>
                                    <div className="shrink-0 pb-1 pl-1">
                                         <Mascot mode="hanzi" status={mascotStatus} skinId={skinId} hatId={hatId} />
                                    </div>
                                </div>
                                <div className="w-full mb-6 bg-white p-5 rounded-3xl shadow-sm border border-pink-100 relative overflow-hidden">
                                    <div className="absolute -right-4 -top-4 text-8xl opacity-5 pointer-events-none">üìñ</div>
                                    <p className="text-xs text-pink-400 font-bold uppercase mb-4 ml-1">üîó ËÅîÊÉ≥ÁªÑËØç (Word Association)</p>
                                    {associatedWords.length > 0 ? (
                                        <div className="flex flex-wrap gap-3 justify-center">
                                            {associatedWords.map((word, i) => (
                                                <button 
                                                    key={i}
                                                    onClick={() => playAudio(word, false)}
                                                    className="px-4 py-2 bg-pink-50 text-qy-text-pink rounded-xl font-chinese text-xl font-bold border border-pink-100 hover:bg-pink-100 hover:scale-105 active:scale-95 transition-all flex items-center gap-2"
                                                >
                                                    <span>{word}</span>
                                                    <span className="text-xs opacity-50">üîä</span>
                                                </button>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="text-center text-gray-400 italic py-2">
                                            ÊöÇÊó†Â∏∏ËßÅÁªÑËØç
                                        </div>
                                    )}
                                </div>
                            </>
                        ) : null}
                    </div>
                </div>
            );
        };

        const EnglishView = ({ setMascotStatus, addPoints, skinId, hatId, mascotStatus }) => {
            const [selectedItem, setSelectedItem] = useState(null); 
            const [activeTab, setActiveTab] = useState('learn'); 
            const [quizState, setQuizState] = useState({ 
                questions: [], 
                currentIdx: 0, 
                score: 0, 
                finished: false, 
                earned: 0,
                wrongQuestions: []
            });

            const selectLetter = (item) => {
                setSelectedItem(item);
                setActiveTab('learn'); 
                setMascotStatus('idle');
                setQuizState({ questions: [], currentIdx: 0, score: 0, finished: false, earned: 0, wrongQuestions: [] });
                playAudio(item.id, true);
            };

            const closeModal = () => {
                setSelectedItem(null);
            }

            const playLetterAudio = () => {
                if(!selectedItem) return;
                playAudio(selectedItem.id, true);
            };

            const playVocabAudio = (vocabItem) => {
                playAudio(vocabItem.en, true);
                setTimeout(() => {
                    playAudio(vocabItem.cn, false);
                }, 1000);
            };

            // Enhanced Quiz Logic
            const startQuiz = () => {
                const qs = [];
                // Generate 5 questions
                for(let i=0; i<5; i++) {
                    const type = Math.floor(Math.random() * 3); // 0: Find Letter, 1: Find Word (Listen), 2: Find Translation
                    let q = { type };
                    
                    if (type === 0) {
                        q.prompt = `Find letter ${selectedItem.id}`;
                        q.answer = selectedItem.id;
                        // Options: Correct + 2 random letters
                        const opts = [selectedItem.id];
                        while(opts.length < 3) {
                            const r = PHONICS_DATA[Math.floor(Math.random() * PHONICS_DATA.length)].id;
                            if(!opts.includes(r)) opts.push(r);
                        }
                        q.options = opts.sort(() => Math.random() - 0.5);
                    } else if (type === 1) {
                        // Pick a word from current letter
                        const vocab = selectedItem.vocab[Math.floor(Math.random() * selectedItem.vocab.length)];
                        q.audio = vocab.en;
                        q.prompt = "Listen & Pick English";
                        q.answer = vocab.en;
                         // Options: Correct + 2 random words from other letters
                         const opts = [vocab.en];
                         while(opts.length < 3) {
                            const rLetter = PHONICS_DATA[Math.floor(Math.random() * PHONICS_DATA.length)];
                            const rVocab = rLetter.vocab[Math.floor(Math.random() * rLetter.vocab.length)].en;
                            if(!opts.includes(rVocab)) opts.push(rVocab);
                         }
                         q.options = opts.sort(() => Math.random() - 0.5);
                    } else {
                         // Pick a meaning
                         const vocab = selectedItem.vocab[Math.floor(Math.random() * selectedItem.vocab.length)];
                         q.promptText = vocab.cn;
                         q.prompt = "Select English";
                         q.answer = vocab.en;
                         const opts = [vocab.en];
                         while(opts.length < 3) {
                            const rLetter = PHONICS_DATA[Math.floor(Math.random() * PHONICS_DATA.length)];
                            const rVocab = rLetter.vocab[Math.floor(Math.random() * rLetter.vocab.length)].en;
                            if(!opts.includes(rVocab)) opts.push(rVocab);
                         }
                         q.options = opts.sort(() => Math.random() - 0.5);
                    }
                    qs.push(q);
                }
                setQuizState({ questions: qs, currentIdx: 0, score: 0, finished: false, earned: 0, wrongQuestions: [] });
                setActiveTab('quiz');
                
                // Play audio for first question if needed
                if(qs[0].type === 1) setTimeout(() => playAudio(qs[0].audio, true), 500);
            };

            const handleQuizAnswer = (ans) => {
                const q = quizState.questions[quizState.currentIdx];
                const isCorrect = ans === q.answer;
                
                let newScore = quizState.score;
                let newEarned = quizState.earned;
                let newWrong = [...quizState.wrongQuestions];

                if(isCorrect) {
                    playAudio("Good job", true);
                    setMascotStatus('success');
                    newScore += 1;
                    addPoints(1);
                    newEarned += 1;
                } else {
                    playAudio("Oops, wrong", true);
                    setMascotStatus('sad');
                    newWrong.push(q);
                }
                
                // Move to next regardless of result
                setTimeout(() => {
                    setMascotStatus('idle');
                    if(quizState.currentIdx < 4) {
                        const nextIdx = quizState.currentIdx + 1;
                        setQuizState(prev => ({ 
                            ...prev, 
                            score: newScore, 
                            currentIdx: nextIdx, 
                            earned: newEarned,
                            wrongQuestions: newWrong
                        }));
                        const nextQ = quizState.questions[nextIdx];
                        if(nextQ.type === 1) playAudio(nextQ.audio, true);
                    } else {
                         setQuizState(prev => ({ 
                             ...prev, 
                             score: newScore, 
                             finished: true, 
                             earned: newEarned,
                             wrongQuestions: newWrong
                         }));
                         playAudio("Quiz finished", true);
                    }
                }, 1000);
            };

            const replayQuizAudio = () => {
                const q = quizState.questions[quizState.currentIdx];
                if(q.type === 1) playAudio(q.audio, true);
                if(q.type === 2) playAudio(q.promptText, false); 
            }

            return (
                <div className="w-full max-w-lg px-4 flex flex-col items-center pt-1 pb-32">
                    <div className="w-full max-w-2xl">
                        <div className="grid grid-cols-4 sm:grid-cols-6 gap-3">
                            {PHONICS_DATA.map(item => (
                                <button 
                                    key={item.id}
                                    onClick={() => selectLetter(item)}
                                    className="aspect-square bg-white rounded-2xl shadow-md border border-gray-50 flex flex-col items-center justify-center hover:scale-105 transition-transform hover:shadow-lg active:scale-95 overflow-hidden"
                                >
                                    <span className="text-5xl font-bold text-qy-text-purple font-rounded mb-1">
                                        {item.id}{item.id.toLowerCase()}
                                    </span>
                                    <span className="text-lg">{item.emoji}</span>
                                </button>
                            ))}
                        </div>
                    </div>

                    {selectedItem && (
                        <div className="fixed inset-0 z-[150] bg-gradient-to-br from-purple-50 via-white to-pink-50 w-screen h-screen overflow-y-auto overscroll-contain animate-pop flex flex-col">
                            <div className="absolute top-[-10%] right-[-10%] w-[50vh] h-[50vh] bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-float pointer-events-none"></div>
                            <div className="absolute bottom-[-10%] left-[-10%] w-[50vh] h-[50vh] bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-float pointer-events-none" style={{animationDelay: '1.5s'}}></div>
                            <div className="w-full flex items-center justify-between p-6 z-[160]">
                                <button 
                                    onClick={closeModal}
                                    className="flex items-center gap-2 px-4 py-2 bg-white/80 hover:bg-white text-purple-700 rounded-full font-bold shadow-sm transition-all border border-purple-100"
                                >
                                    <span>üîô</span>
                                </button>
                                <div className="text-3xl font-black text-qy-text-purple font-rounded tracking-wider">
                                    {selectedItem.id}{selectedItem.id.toLowerCase()}
                                </div>
                                <div className="w-10"></div>
                            </div>

                            <div className="flex-1 w-full z-10 flex flex-col items-center py-4 relative overflow-y-auto">
                                <div className="w-full max-w-md px-4 flex flex-col items-center gap-6">
                                    {activeTab === 'learn' && (
                                        <div className="animate-pop w-full flex flex-col items-center">
                                            <div className="relative group mb-6">
                                                <div className="absolute inset-0 bg-white rounded-full blur-xl opacity-60 scale-110"></div>
                                                <div className="relative bg-white/80 backdrop-blur-sm p-10 rounded-[2.5rem] shadow-2xl border-4 border-white flex flex-col items-center justify-center w-64 h-64">
                                                    <div className="absolute -top-4 -right-4 bg-white p-3 rounded-full shadow-lg border-2 border-purple-50 animate-bounce text-4xl">
                                                        {selectedItem.emoji}
                                                    </div>
                                                    <span className="text-[7rem] leading-none font-black text-transparent bg-clip-text bg-gradient-to-br from-qy-text-purple to-purple-400 font-rounded drop-shadow-sm select-none">
                                                        {selectedItem.id}
                                                        <span className="text-[4rem] text-purple-300 ml-1">{selectedItem.id.toLowerCase()}</span>
                                                    </span>
                                                </div>
                                            </div>
                                            <div className="flex flex-col items-center gap-2 mb-6">
                                                <h2 className="text-4xl font-bold text-gray-700 tracking-wide">{selectedItem.word}</h2>
                                                <span className="text-xl font-chinese font-bold text-white bg-qy-text-purple px-8 py-2 rounded-full shadow-md">
                                                    {selectedItem.meaning}
                                                </span>
                                            </div>
                                            <div className="flex items-center gap-4">
                                                <button onClick={playLetterAudio} className="bg-white hover:bg-purple-50 text-qy-text-purple border-2 border-purple-100 px-8 py-3 rounded-full font-bold shadow-lg active:scale-95 transition-all flex items-center gap-3 text-lg">
                                                    <span className="text-2xl">üîä</span> <span>Listen</span>
                                                </button>
                                                <Mascot mode="english" status={mascotStatus} skinId={skinId} hatId={hatId} />
                                            </div>
                                        </div>
                                    )}

                                    {activeTab === 'vocab' && (
                                        <div className="animate-pop w-full flex flex-col items-center gap-4">
                                            <h3 className="text-qy-text-purple font-bold text-xl mb-2">üìö Words with {selectedItem.id}</h3>
                                            {selectedItem.vocab.map((v, idx) => (
                                                <button 
                                                    key={idx}
                                                    onClick={() => playVocabAudio(v)}
                                                    className="w-full bg-white hover:bg-purple-50 border-2 border-purple-100 rounded-2xl p-4 shadow-sm active:scale-95 transition-all flex items-center justify-between group"
                                                >
                                                    <div className="flex flex-col items-start">
                                                        <span className="text-2xl font-bold text-gray-800">{v.en}</span>
                                                        <span className="text-md text-purple-400 font-chinese font-bold">{v.cn}</span>
                                                    </div>
                                                    <span className="text-3xl bg-purple-100 w-12 h-12 rounded-full flex items-center justify-center group-hover:bg-purple-200 transition-colors">üîä</span>
                                                </button>
                                            ))}
                                        </div>
                                    )}

                                    {activeTab === 'quiz' && (
                                        <div className="animate-pop w-full flex flex-col items-center w-full">
                                            {!quizState.finished ? (
                                                quizState.questions.length === 0 ? (
                                                     <button onClick={startQuiz} className="bg-qy-text-purple text-white px-8 py-3 rounded-full text-xl font-bold shadow-xl active:scale-95 transition-transform mt-10">Start Quiz üöÄ</button>
                                                ) : (
                                                    <div className="w-full bg-white/60 backdrop-blur-md rounded-3xl p-6 shadow-xl border border-white/50 flex flex-col items-center">
                                                        <div className="w-full bg-purple-100 rounded-full h-3 mb-6">
                                                            <div className="bg-qy-text-purple h-3 rounded-full transition-all duration-300" style={{width: `${((quizState.currentIdx)/5)*100}%`}}></div>
                                                        </div>

                                                        {quizState.questions[quizState.currentIdx].type === 1 && (
                                                             <button onClick={replayQuizAudio} className="mb-6 w-24 h-24 bg-purple-100 rounded-full flex items-center justify-center text-4xl shadow-md active:scale-90 transition-transform">üîä</button>
                                                        )}
                                                        
                                                        {quizState.questions[quizState.currentIdx].type === 2 && (
                                                             <div className="mb-6 text-3xl font-chinese font-bold text-qy-text-purple">{quizState.questions[quizState.currentIdx].promptText}</div>
                                                        )}

                                                        <h3 className="text-gray-500 font-bold mb-6 text-lg">{quizState.questions[quizState.currentIdx].prompt}</h3>
                                                        
                                                        <div className="flex flex-wrap gap-4 justify-center w-full">
                                                            {quizState.questions[quizState.currentIdx].options.map((opt, i) => (
                                                                <button
                                                                    key={i}
                                                                    onClick={() => handleQuizAnswer(opt)}
                                                                    className="min-w-[80px] px-4 py-3 bg-white border-2 border-purple-100 rounded-2xl text-xl font-bold shadow-sm hover:bg-purple-50 active:bg-purple-200 transition-colors"
                                                                >
                                                                    {opt}
                                                                </button>
                                                            ))}
                                                        </div>
                                                    </div>
                                                )
                                            ) : (
                                                <div className="flex flex-col items-center w-full">
                                                    <div className="text-7xl mb-4 animate-tada">üåü</div>
                                                    <h3 className="text-3xl font-bold text-qy-text-purple mb-2">Quiz Finished!</h3>
                                                    <p className="text-xl text-gray-500 mb-4">Score: {quizState.score} / 5</p>
                                                    
                                                    {quizState.earned > 0 && (
                                                        <div className="bg-yellow-100 px-6 py-3 rounded-full mb-6 flex items-center border border-yellow-300 animate-pulse">
                                                            <span className="text-3xl mr-2">ü™ô</span>
                                                            <span className="text-2xl font-bold text-yellow-700">+{quizState.earned}</span>
                                                        </div>
                                                    )}

                                                    {quizState.wrongQuestions.length > 0 && (
                                                        <div className="w-full bg-red-50 rounded-2xl p-4 mb-6 border border-red-100 overflow-y-auto max-h-48">
                                                            <h4 className="text-red-500 font-bold mb-3 text-center">Mistakes Review</h4>
                                                            <div className="space-y-2">
                                                                {quizState.wrongQuestions.map((q, idx) => (
                                                                    <div key={idx} className="flex justify-between items-center bg-white p-2 rounded-lg shadow-sm">
                                                                        <div className="flex items-center gap-2">
                                                                            <span className="font-bold text-lg text-gray-700">
                                                                                {q.type === 0 ? `Letter ${q.answer}` : q.answer}
                                                                            </span>
                                                                        </div>
                                                                        <div className="text-sm font-bold text-purple-500">
                                                                            {q.type === 0 ? 'Find' : (q.type === 1 ? 'Listen' : 'Trans.')}
                                                                        </div>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    )}

                                                    <button onClick={startQuiz} className="bg-qy-text-purple text-white px-8 py-3 rounded-full font-bold shadow-lg active:scale-95">Play Again</button>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>

                            <div className="w-full bg-white/90 backdrop-blur-md border-t border-purple-100 pb-[env(safe-area-inset-bottom)] z-[160]">
                                <div className="flex justify-around items-center p-2">
                                    <button onClick={() => setActiveTab('learn')} className={`flex flex-col items-center p-2 rounded-2xl w-20 transition-all ${activeTab === 'learn' ? 'text-qy-text-purple bg-purple-50' : 'text-gray-400'}`}>
                                        <span className="text-2xl mb-1">üëÄ</span>
                                        <span className="text-xs font-bold">Learn</span>
                                    </button>
                                    <button onClick={() => setActiveTab('vocab')} className={`flex flex-col items-center p-2 rounded-2xl w-20 transition-all ${activeTab === 'vocab' ? 'text-qy-text-purple bg-purple-50' : 'text-gray-400'}`}>
                                        <span className="text-2xl mb-1">üìñ</span>
                                        <span className="text-xs font-bold">Words</span>
                                    </button>
                                    <button onClick={() => { setActiveTab('quiz'); setQuizState({ questions: [], currentIdx: 0, score: 0, finished: false }); }} className={`flex flex-col items-center p-2 rounded-2xl w-20 transition-all ${activeTab === 'quiz' ? 'text-qy-text-purple bg-purple-50' : 'text-gray-400'}`}>
                                        <span className="text-2xl mb-1">üß©</span>
                                        <span className="text-xs font-bold">Quiz</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            const [currentMode, setCurrentMode] = useState('hanzi');
            const [mascotStatus, setMascotStatus] = useState('idle');
            const [showShop, setShowShop] = useState(false);
            
            // Global State for Points and Inventory
            const [points, setPoints] = useState(() => parseInt(localStorage.getItem('points') || '0'));
            const [inventory, setInventory] = useState(() => JSON.parse(localStorage.getItem('inventory') || '[]'));
            const [equippedSkin, setEquippedSkin] = useState(() => localStorage.getItem('equippedSkin') || 'default');
            const [equippedHat, setEquippedHat] = useState(() => localStorage.getItem('equippedHat') || null);

            useEffect(() => {
                if (currentMode === 'hanzi') {
                    document.body.className = 'bg-pattern-hanzi transition-colors duration-500';
                } else {
                    document.body.className = 'bg-pattern-english transition-colors duration-500';
                }
            }, [currentMode]);

            useEffect(() => {
                localStorage.setItem('points', points);
                localStorage.setItem('inventory', JSON.stringify(inventory));
                localStorage.setItem('equippedSkin', equippedSkin);
                if(equippedHat) localStorage.setItem('equippedHat', equippedHat);
                else localStorage.removeItem('equippedHat');
            }, [points, inventory, equippedSkin, equippedHat]);

            const addPoints = (amount) => {
                setPoints(prev => prev + amount);
            };

            const handleBuy = (item) => {
                if(points >= item.price) {
                    setPoints(prev => prev - item.price);
                    setInventory(prev => [...prev, item.id]);
                }
            };

            const handleEquip = (item) => {
                if(item.category === 'skin') setEquippedSkin(item.id);
                if(item.category === 'accessory') {
                    setEquippedHat(prev => prev === item.id ? null : item.id);
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center relative overflow-hidden">
                    <div className={`w-full py-2 pt-[calc(0.5rem+env(safe-area-inset-top))] px-3 flex items-center justify-between sticky top-0 z-40 shadow-sm transition-colors duration-300
                        ${currentMode === 'hanzi' ? 'bg-qy-pink' : 'bg-qy-purple'}`}>
                        <div className="flex items-center gap-2 text-white overflow-hidden">
                            <span className="text-xl drop-shadow-sm shrink-0">
                                {currentMode === 'hanzi' ? <ChineseKnotIcon /> : 'ü¶Ñ'}
                            </span>
                            <h1 className="text-base font-black font-chinese tracking-widest drop-shadow-md truncate leading-tight">
                                {currentMode === 'hanzi' ? 'Áéã‰πî‰æùÁöÑÊ±âÂ≠ó‰πêÂõ≠' : 'Winnie\'s English Park'}
                            </h1>
                        </div>
                        <div className="flex items-center gap-2">
                             <button 
                                onClick={() => setShowShop(true)}
                                className="bg-yellow-400 text-yellow-900 px-3 py-1 rounded-full font-bold shadow-md flex items-center gap-1 active:scale-90 transition-transform"
                             >
                                <span>ü™ô</span>
                                <span>{points}</span>
                             </button>
                             <div className="bg-white/30 p-1 rounded-full flex shrink-0">
                                <button 
                                    onClick={() => setCurrentMode('hanzi')}
                                    className={`px-3 py-1 rounded-full text-xs font-bold transition-all whitespace-nowrap ${currentMode === 'hanzi' ? 'bg-white text-qy-text-pink shadow-sm' : 'text-white hover:bg-white/20'}`}
                                >
                                    Ê±âÂ≠ó
                                </button>
                                <button 
                                    onClick={() => setCurrentMode('english')}
                                    className={`px-3 py-1 rounded-full text-xs font-bold transition-all whitespace-nowrap ${currentMode === 'english' ? 'bg-white text-qy-text-purple shadow-sm' : 'text-white hover:bg-white/20'}`}
                                >
                                    Eng
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className="w-full flex justify-center relative">
                        {currentMode === 'hanzi' ? (
                            <HanziView 
                                setMascotStatus={setMascotStatus} 
                                addPoints={addPoints} 
                                skinId={equippedSkin} 
                                hatId={equippedHat} 
                                mascotStatus={mascotStatus}
                            />
                        ) : (
                            <EnglishView 
                                setMascotStatus={setMascotStatus} 
                                addPoints={addPoints} 
                                skinId={equippedSkin} 
                                hatId={equippedHat} 
                                mascotStatus={mascotStatus}
                            />
                        )}
                    </div>

                    {showShop && (
                        <ShopModal 
                            onClose={() => setShowShop(false)}
                            inventory={inventory}
                            equippedSkin={equippedSkin}
                            equippedHat={equippedHat}
                            balance={points}
                            onBuy={handleBuy}
                            onEquip={handleEquip}
                        />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('SW registered:', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed:', registrationError);
                    });
            });
        }
    </script>
</body>
</html>