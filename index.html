<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Â≠¶Ê±âÂ≠ó</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-title" content="Â≠¶Ê±âÂ≠ó">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Icons -->
    <link rel="icon" type="image/png" href="icon.png" />
    <link rel="apple-touch-icon" href="icon.png" />
    <link rel="icon" sizes="192x192" href="icon.png" />
    
    <!-- REQUIRED SCRIPT ORDER -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Hanzi Writer -->
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    
    <!-- CnChar Core + Plugins (Order Matters) -->
    <script src="https://cdn.jsdelivr.net/npm/cnchar/cnchar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cnchar-poly/cnchar.poly.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cnchar-order/cnchar.order.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cnchar-trad/cnchar.trad.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cnchar-radical/cnchar.radical.min.js"></script>

    <!-- Configure Tailwind for Qiaoyi's Dual Theme -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Hanzi Mode (Pink)
                        'qy-pink': '#FFB7C5',      
                        'qy-dark-pink': '#FF8FAB', 
                        'qy-text-pink': '#D63384',
                        
                        // English Mode (Lavender)
                        'qy-purple': '#E0BBE4',
                        'qy-dark-purple': '#957DAD',
                        'qy-text-purple': '#6D28D9', // Violet 700
                        'qy-bg-purple': '#F3E8FF',   // Purple 50
                    },
                    fontFamily: {
                        'rounded': ['"Varela Round"', 'sans-serif'],
                        'chinese': ['"Ma Shan Zheng"', '"KaiTi"', 'serif'],
                        'handwriting': ['"Varela Round"', 'sans-serif'], // Fallback for handwriting
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'pop': 'bounce-in 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        'bounce-in': {
                            '0%': { transform: 'scale(0.3)', opacity: '0' },
                            '50%': { transform: 'scale(1.05)' },
                            '70%': { transform: 'scale(0.9)' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Varela+Round&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Varela Round', "Microsoft YaHei", sans-serif;
            transition: background-color 0.5s ease;
            /* Prevent bouncing on iOS */
            overscroll-behavior-y: none;
        }
        
        /* Custom Scrollbar */
        .stroke-scroll::-webkit-scrollbar { height: 8px; }
        .stroke-scroll::-webkit-scrollbar-track { background: transparent; }
        .stroke-scroll::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }

        /* --- CONTEXT-AWARE DOG ANIMATIONS --- */
        
        /* Jump: Excitement (Up/Down) */
        @keyframes dog-jump {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-25px); }
        }
        .animate-dog-jump { animation: dog-jump 0.5s ease-in-out; }

        /* Wiggle: Playful (Rotate Tail/Body) */
        @keyframes dog-wiggle {
            0%, 100% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
        }
        .animate-dog-wiggle { animation: dog-wiggle 0.5s ease-in-out infinite; }

        /* Spin: Showing Off (360 Rotate) */
        @keyframes dog-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .animate-dog-spin { animation: dog-spin 0.6s linear; }

        /* Pulse: Love/Comfort (Scale Breath) */
        @keyframes dog-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        .animate-dog-pulse { animation: dog-pulse 1s ease-in-out infinite; }

        /* Generic Entrance */
        @keyframes tada {
            0% { transform: scale(1); }
            10%, 20% { transform: scale(0.9) rotate(-3deg); }
            30%, 50%, 70%, 90% { transform: scale(1.1) rotate(3deg); }
            40%, 60%, 80% { transform: scale(1.1) rotate(-3deg); }
            100% { transform: scale(1) rotate(0); }
        }
        .animate-tada { animation: tada 1s ease-in-out; }

        /* Modal Blur Background */
        .modal-backdrop {
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
        }
    </style>
</head>
<body class="bg-pink-50"> <!-- Default bg -->
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- COMMON CHARACTERS FOR LOOKUP (3500 Common Characters) ---
        // Covers full elementary curriculum + middle school basics.
        const COMMON_CHARS = "ÁöÑ‰∏ÄÊòØÂú®‰∏ç‰∫ÜÊúâÂíå‰∫∫Ëøô‰∏≠Â§ß‰∏∫‰∏ä‰∏™ÂõΩÊàë‰ª•Ë¶Å‰ªñÊó∂Êù•Áî®‰ª¨ÁîüÂà∞‰ΩúÂú∞‰∫éÂá∫Â∞±ÂàÜÂØπÊàê‰ºöÂèØ‰∏ªÂèëÂπ¥Âä®ÂêåÂ∑•‰πüËÉΩ‰∏ãËøáÂ≠êËØ¥‰∫ßÁßçÈù¢ËÄåÊñπÂêéÂ§öÂÆöË°åÂ≠¶Ê≥ïÊâÄÊ∞ëÂæóÁªèÂçÅ‰∏â‰πãËøõÁùÄÁ≠âÈÉ®Â∫¶ÂÆ∂ÁîµÂäõÈáåÂ¶ÇÊ∞¥ÂåñÈ´òËá™‰∫åÁêÜËµ∑Â∞èÁâ©Áé∞ÂÆûÈáèÈÉΩ‰∏§‰ΩìÂà∂Êú∫ÂΩì‰ΩøÁÇπ‰ªé‰∏öÊú¨ÂéªÊääÊÄßÂ•ΩÂ∫îÂºÄÂÆÉÂêàËøòÂõ†Áî±ÂÖ∂‰∫õÁÑ∂ÂâçÂ§ñÂ§©ÊîøÂõõÊó•ÈÇ£Á§æ‰πâ‰∫ãÂπ≥ÂΩ¢Áõ∏ÂÖ®Ë°®Èó¥Ê†∑ÊÉ≥ÂêëÈÅìÂëΩÊ≠§‰ΩçÁêÜÊúõÊûúÊñôÂª∫ÊúàÂÖ¨ÊïôÁ≥ªÂπ∂Êï∞Â∏∏ÊñáÈÄöÊúü‰πàÊâãÊé•ÂëòÂè£Á´ãÊÉÖËøêÂÆâÊúÄÂÜõ‰ªäÊèêÊ∞îÈáçÂ±±ÁªìÊîæËß£ÂêÑÂ∞ëËµÑÊúüÊâìÂè∞ÂÄôÂø´ÁúºÊØî‰π¶Á¨ëËØ≠Â£∞Ë•øÂçóÁæéÁïåÂåóËæπ‰π¶ËØªÂÜôÂ≠óÊ∏ÖÊòé‰∫ÆÊòüÁÅ´Â¶àÁà∏Áà∑Â•∂Âì•ÂßêÂºüÂ¶πÊ†°Â∏àËØæÁ¨îÁ∫∏ÁêÉËçâÊ†ëËä±È∏üÈ±ºËô´ÁâõÁæäÈ©¨ÁãóÊó©ÊôöÈ•≠Ë°£ËΩ¶Èó®Á™óÂ∫äÁÅØÈíüËßâÊ¥óÊæ°Âà∑ËÑ∏ÁâôÊâãË∂≥Ë∫´Â§¥Âè£ËÄ≥ÁõÆÈºªÊâãË∂≥Â§ß‰∏≠Â∞èÂ§öÂ∞ëÊó•ÊúàÊ∞¥ÁÅ´ÂúüÊú®ÈáëÁü≥Áî∞ÂúüÂ§©È£éÈõ®Èõ™Áîµ‰∫ëÂÜ∞Ê≤ôÊµ∑Ê≤≥ÊπñÊ±üÊ¥ãÁà∏Â¶àÂì•ÂºüÂßêÂ¶πÁà∑Â•∂‰ºØÂèîÂß®ÂßëÂÆ∂Ê†°Â∏àÁîüÂêåÂ≠¶ÂèãÁà±ÁúãÂê¨ËØ¥ËØªÂÜôÁîªÂî±Ë∑≥Ë∑ëÂùêÁ´ãËµ∞È£ûÂêÉÂñùÁé©‰πêÊò•Â§èÁßãÂÜ¨Á∫¢ÈªÑËìùÁªøÁôΩÈªëÁ¥´Ê©ôÁÅ∞Ê£ï‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πùÂçÅÁôæÂçÉ‰∏á‰∏ä‰∏≠‰∏ãÂ∑¶Âè≥ÂâçÂêéÂÜÖÂ§ñÈù¢ÈáåÊñπÂúÜÈïøÁü≠È´òÁüÆÁ≤óÁªÜÂø´ÊÖ¢ÂÜ∑ÁÉ≠Âπ≤ÊπøËΩªÈáçÊòéÊöóÂºÄÂÖ≥Âá∫ÂÖ•Êù•ÂéªÂùêÂçßÁ´ãË°åÈòøÂïäÂüÉÊå®ÂìéÂîâÂìÄÁöëÁôåËîºÁüÆËâæÁ¢çÁà±ÈöòÈûçÊ∞®ÂÆâ‰ø∫ÊåâÊöóÂ≤∏ËÉ∫Ê°àËÇÆÊòÇÁõéÂáπÊïñÁÜ¨Áø±Ë¢ÑÂÇ≤Â••ÊáäÊæ≥Áà∏ÊâíËä≠Áñ§Â∑¥ÊãîË∑ãÈù∂ÊääËÄôÂùùÈú∏ÁΩ¢Áà∏ÁôΩÊüèÁôæÊëÜ‰Ω∞Ë¥•ÊãúÁ®óÊñëÁè≠Êê¨Êâ≥Ëà¨È¢ÅÊùøÁâàÊâÆÊãå‰º¥Áì£ÂçäÂäûÁªäÈÇ¶Â∏ÆÊ¢ÜÊ¶úËÜÄÁªëÊ£íÁ£ÖËöåÈïëÂÇçË∞§ËãûËÉûÂåÖË§íÂâ•ËñÑÈõπ‰øùÂ†°È•±ÂÆùÊä±Êä•Êö¥Ë±πÈ≤çÁàÜÊùØÁ¢ëÊÇ≤ÂçëÂåóËæàËÉåË¥ùÈí°ÂÄçÁãàÂ§áÊÉ´ÁÑôË¢´Â•îËãØÊú¨Á¨®Â¥©Áª∑Áî≠Ê≥µËπ¶Ëø∏ÈÄºÈºªÊØîÈÑôÁ¨îÂΩºÁ¢ßËìñËîΩÊØïÊØôÂ∏ÅÂ∫áÁóπÈó≠ÊïùÂºäÂøÖËæüÂ£ÅËáÇÈÅøÈôõÈû≠ËæπÁºñË¥¨ÊâÅ‰æøÂèòÂçûËæ®Ëæ©Ëæ´ÈÅçÊ†áÂΩ™ËÜòË°®È≥ñÊÜãÂà´Áò™ÂΩ¨ÊñåÊøíÊª®ÂÆæÂ±èÂÜ∞ÊüÑ‰∏ôÁßâÈ•ºÁÇ≥ÁóÖÂπ∂ÁéªËè†Êí≠Êã®ÈíµÊ≥¢ÂçöÂãÉÊêèÈìÇÁÆî‰ºØÂ∏õËà∂ËÑñËÜäÊ∏§Ê≥äÈ©≥ÊçïÂçúÂì∫Ë°•Âü†‰∏çÂ∏ÉÊ≠•Á∞øÈÉ®ÊÄñÊì¶ÁåúË£ÅÊùêÊâçË¥¢Áù¨Ë∏©ÈááÂΩ©ËèúËî°È§êÂèÇËöïÊÆãÊÉ≠ÊÉ®ÊÉ®ËãçËà±‰ªìÊ≤ßËóèÊìçÁ≥ôÊßΩÊõπËçâÂéïÁ≠ñ‰æßÂÜåÊµãÂ±ÇËπ≠ÊèíÂèâËå¨Ëå∂Êü•Á¢¥ÊêΩÂØüÂ≤îÂ∑ÆËØßÊãÜÊü¥Ë±∫ÊêÄÊé∫ËùâÈ¶ãË∞óÁº†Èì≤‰∫ßÈòêÈ¢§ÊòåÁåñÂú∫Â∞ùÂ∏∏ÈïøÂÅøËÇ†ÂéÇÊïûÁïÖÂî±ÂÄ°Ë∂ÖÊäÑÈíûÊúùÂò≤ÊΩÆÂ∑¢ÂêµÁÇíËΩ¶ÊâØÊí§Êé£ÂΩªÊæàË°¨Áß∞ÊíëÊæÑÂëàÊâøËØöÂüé‰πòÊÉ©Á®ãÊæÑÁß§ÂêÉÁó¥ÊåÅÂåôÊ±†ËøüÂºõÈ©∞ËÄªÈΩø‰æàÂ∞∫Ëµ§ÁøÖÊñ•ÁÇΩÂÖÖÂÜ≤Ëô´Â¥áÂÆ†ÊäΩÈÖ¨Áï¥Ë∏åÁ®†ÊÑÅÁ≠π‰ªáÁª∏ÁûÖ‰∏ëËá≠ÂàùÂá∫Ê©±Âé®Ë∫áÈîÑÈõèÂ§ÑÊè£Â∑ùÁ©øÊ§Ω‰º†ËàπÂñò‰∏≤ÁñÆÁ™óÂπ¢Â∫äÈóØÂàõÂêπÁÇäÊç∂Èî§Êò•Ê§øÈÜáÂîáÊ∑≥Á∫ØË†¢Êà≥Áª∞ÁñµËå®Á£ÅÈõåËæûÊÖàÁì∑ËØçÊ≠§Âà∫ËµêÊ¨°ËÅ™Ëë±Âõ±ÂåÜ‰ªé‰∏õÂáëÁ≤óÈÜãÁ∞á‰øÉËπøÁØ°Á™úÊëßÂ¥îÂÇ¨ËÑÜÁòÅÁ≤πÊ∑¨Áø†ÊùëÂ≠òÂØ∏Á£ãÊíÆÊêìÊé™Êå´ÈîôÊê≠ËææÁ≠îÁò©ÊâìÂ§ßÂëÜÊ≠πÂÇ£Êà¥Â∏¶ÊÆÜ‰ª£Ë¥∑Ë¢ãÂæÖÈÄÆÊÄ†ËÄΩÊãÖ‰∏πÂçïÈÉ∏Êé∏ËÉÜÊó¶Ê∞Æ‰ΩÜÊÉÆÊ∑°ËØûÂºπËõãÂΩìÊå°ÂÖöËç°Ê°£ÂàÄÊç£ËπàÂÄíÂ≤õÁ•∑ÂØºÂà∞Á®ªÊÇºÈÅìÁõóÂæ∑ÂæóÁöÑËπ¨ÁÅØÁôªÁ≠âÁû™Âá≥ÈÇìÂ†§‰ΩéÊª¥Ëø™ÊïåÁ¨õÁãÑÊ∂§ÁøüÂ´°ÊäµÂ∫ïÂú∞ËíÇÁ¨¨Â∏ùÂºüÈÄíÁºîÈ¢†ÊéÇÊªáÁ¢òÁÇπÂÖ∏ÈùõÂû´Áîµ‰ΩÉÁî∏Â∫óÊÉ¶Â•†Ê∑ÄÊÆøÁ¢âÂèºÈõïÂáãÂàÅÊéâÂêäÈíìË∞ÉË∑åÁàπÁ¢üËù∂Ëø≠Ë∞çÂè†‰∏ÅÁõØÂèÆÈíâÈ°∂ÈºéÈî≠ÂÆöËÆ¢‰∏¢‰∏úÂÜ¨Ëë£ÊáÇÂä®Ê†ã‰æóÊñóÊäñÈô°Ë±ÜÁù£ÊØíËØªÁã¨È°øÂ¢©ÁõæÊï¶Ëπ≤Ëπ≤Á´ØÁü≠ÊÆµÊñ≠ÁºéÂ†ÜÂÖëÈòüÂØπÂ¢©Âê®Ëπ≤Êï¶È°øÂõ§ÈíùÁõæÈÅÅÂ§öÂìÜÂ§∫Â∫¶Ê∏°ÈïÄÁ´ØÁü≠ÊÆµÊñ≠ÁºéÂ†ÜÂÖëÈòüÂØπÂ§öÂìÜÂ§∫Â∫¶Ê∏°ÈïÄÁ´ØÁü≠ÊÆµÊñ≠ÁºéÂ†ÜÂÖëÈòüÂØπÂ§öÂìÜÂ§∫Â∫¶Ê∏°ÈïÄÂ≥®‰øÑÂ®•ÈÑÇÈπÖËõæÈ¢ùÂéÑÊâºÊÅ∂È•øÊÅ©ËÄåÂÑøËÄ≥Â∞îÈ•µË¥∞ÂèëÁΩöÁ≠è‰ºê‰πèÈòÄÊ≥ïÁèêËó©Â∏ÜÁï™ÁøªÊ®äÁüæÈííÁπÅÂá°ÁÉ¶ÂèçËøîËåÉË¥©ÁäØÈ•≠Ê≥õÂùäËä≥ÊñπËÇ™ÊàøÈò≤Â¶®‰ªøËÆøÁ∫∫ÊîæËè≤ÈùûÂï°È£ûËÇ•Âå™ËØΩÂê†ËÇ∫Â∫üÊ≤∏Ë¥πËä¨ÈÖöÂê©Ê∞õÂàÜÁ∫∑ÂùüÁÑöÊ±æÁ≤âÂ•ã‰ªΩÂøøÊÑ§Á≤™‰∏∞Â∞ÅÊû´ËúÇÂ≥∞ÈîãÈ£éÁñØÁÉΩÈÄ¢ÂÜØÁºùËÆΩÂ•âÂá§‰ΩõÂê¶Â§´Êï∑ËÇ§Â≠µÊâ∂ÊãÇËæêÂπÖÊ∞üÁ¨¶‰ºè‰øòÊúçÊµÆÊ∂™Á¶èË¢±ÂºóÁî´ÊäöËæÖ‰øØÈáúÊñßËÑØËÖëÂ∫úËÖêËµ¥ÂâØË¶ÜËµãÂ§çÂÇÖ‰ªòÈòúÁà∂ËÖπË¥üÂØåËÆ£ÈôÑÂ¶áÁºöÂíêÂô∂ÂòéËØ•ÊîπÊ¶ÇÈíôÁõñÊ∫âÂπ≤ÁîòÊùÜÊüëÁ´øËÇùËµ∂ÊÑüÁßÜÊï¢Ëµ£ÂÜàÂàöÈí¢Áº∏ËÇõÁ∫≤Â≤óÊ∏ØÊù†ÁØôÁöãÈ´òËÜèÁæîÁ≥ïÊêûÈïêÁ®øÂëäÂì•Ê≠åÊêÅÊààÈ∏ΩËÉ≥ÁñôÂâ≤Èù©ËëõÊ†ºËõ§ÈòÅÈöîÈì¨‰∏™ÂêÑÁªôÊ†πË∑üËÄïÊõ¥Â∫öÁæπÂüÇËÄøÊ¢óÂ∑•ÊîªÂäüÊÅ≠Èæö‰æõË∫¨ÂÖ¨ÂÆ´ÂºìÂ∑©Ê±ûÊã±Ë¥°ÂÖ±Èí©ÂãæÊ≤üËãüÁãóÂû¢ÊûÑË¥≠Â§üËæúËèáÂíïÁÆç‰º∞Ê≤ΩÂ≠§ÂßëÈºìÂè§ËõäÈ™®Ë∞∑ËÇ°ÊïÖÈ°æÂõ∫ÈõáÂàÆÁìúÂâêÂØ°ÊåÇË§Ç‰πñÊãêÊÄ™Ê£∫ÂÖ≥ÂÆòÂÜ†ËßÇÁÆ°È¶ÜÁΩêÊÉØÁÅåË¥ØÂÖâÂπøÈÄõÁë∞ËßÑÂú≠Á°ÖÂΩíÈæüÈó∫ËΩ®È¨ºËØ°Áô∏Ê°ÇÊüúË∑™Ë¥µÂàΩËæäÊªöÊ£çÈîÖÈÉ≠ÂõΩÊûúË£πËøáÂìàÈ™∏Â≠©Êµ∑Ê∞¶‰∫•ÂÆ≥È™áÈÖ£ÊÜ®ÈÇØÈü©Âê´Ê∂µÂØíÂáΩÂñäÁΩïÁø∞ÊíºÊççÊó±ÊÜæÊÇçÁÑäÁÑäÊ±óÊ±âÂ§ØÊù≠Ëà™Â£ïÂöéË±™ÊØ´ÈÉùÂ•ΩËÄóÂè∑Êµ©ÂëµÂñùËç∑ËèèÊ†∏Á¶æÂíå‰ΩïÂêàÁõíË≤âÈòÇÊ≤≥Ê∂∏Ëµ´Ë§êÈπ§Ë¥∫ÂòøÈªëÁóïÂæàÁã†ÊÅ®Âìº‰∫®Ê®™Ë°°ÊÅíËΩ∞ÂìÑÁÉòËôπÈ∏øÊ¥™ÂÆèÂºòÁ∫¢Âñâ‰æØÁå¥ÂêºÂêéÂéöÂÄô‰πéÂëºÂøΩÂºßÁãêËÉ°Â£∂ÊπñËë´ÁëöÁ≥äËù¥ËôéÂî¨Êä§‰∫íÊ≤™Êà∑Ëä±ÂìóÂçéÁåæÊªëÁîªÂàíÂåñËØùÊßêÂæäÊÄÄÊ∑ÆÂùèÊ¨¢ÁéØÊ°ìËøòÁºìÊç¢ÊÇ£Âî§Áó™Ë±¢ÁÑïÊ∂£ÂÆ¶ÂπªËçíÊÖåÈªÑÁ£∫ËùóÁ∞ßÁöáÂá∞ÊÉ∂ÁÖåÊôÉÂπåÊÅçË∞éÁÅ∞Êå•ËæâÂæΩÊÅ¢ËõîÂõûÊØÅÊÇîÊÖßÂçâÊÉ†Êô¶Ë¥øÁßΩ‰ºöÁÉ©Ê±áËÆ≥ËØ≤ÁªòËç§ÊòèÂ©öÈ≠ÇÊµëÊ∑∑Ë±ÅÊ¥ª‰ºôÁÅ´Ëé∑ÊàñÊÉëÈúçË¥ßÁ•∏ÂáªÂúæÂü∫Êú∫Áï∏Á®ΩÁßØÁÆïËÇåÈ••ËøπÊøÄËÆ•È∏°Âß¨Áª©ÁºâÂêâÊûÅÊ£òËæëÁ±çÈõÜÂèäÊÄ•ÁñæÊ±≤Âç≥Â´âÁ∫ßÊå§Âá†ËÑäÂ∑±ËìüÊäÄÂÜÄÂ≠£‰ºéÁ•≠ÂâÇÊÇ∏ÊµéÂØÑÂØÇËÆ°ËÆ∞Êó¢ÂøåÈôÖÁªßÁ∫™ÂòâÊû∑Â§π‰Ω≥ÂÆ∂Âä†ËçöÈ¢äË¥æÁî≤ÈíæÂÅáÁ®º‰ª∑Êû∂È©æÂ´ÅÊ≠ºÁõëÂùöÂ∞ñË∑µÈó¥ÁÖéÂÖºËÇ©Ëâ∞Â•∏ÁºÑËåßÊ£ÄÊü¨Á¢±Êã£Êç°ÁÆÄ‰ø≠Ââ™ÂáèËçêÊßõÈâ¥Ë∑µË¥±ËßÅÈîÆÁÆ≠‰ª∂ÂÅ•Ëà∞ÂâëÈ•ØÊ∏êÊ∫ÖÊ∂ßÂª∫ÂÉµÂßúÂ∞ÜÊµÜÊ±üÁñÜËíãÊ°®Â•ñËÆ≤Âå†ÈÖ±ÈôçËïâÊ§íÁ§ÅÁÑ¶ËÉ∂‰∫§ÈÉäÊµáÈ™ÑÂ®áÂöºÊêÖÈì∞Áü´‰æ•ËÑöÁã°ËßíÈ•∫Áº¥ÁªûÂâøÊïôÈÖµËΩøËæÉÂè´Á™ñÊè≠Êé•ÁöÜÁß∏Ë°óÈò∂Êà™Âä´ËäÇÊ°îÊù∞Êç∑Áù´Á´≠Ê¥ÅÁªìËß£ÂßêÊàíËóâËä•ÁïåÂÄü‰ªãÁñ•ËØ´Â±äÂ∑æÁ≠ãÊñ§Èáë‰ªäÊ¥•Ë•üÁ¥ßÈî¶‰ªÖË∞®ËøõÈù≥ÊôãÁ¶ÅËøëÁÉ¨Êµ∏Â∞ΩÂä≤ËçÜÂÖ¢ËåéÁùõÊô∂È≤∏‰∫¨ÊÉäÁ≤æÁ≤≥Áªè‰∫ïË≠¶ÊôØÈ¢àÈùôÂ¢ÉÊï¨ÈïúÂæÑÁóâÈùñÁ´üÁ´ûÂáÄÁÇØÁ™òÊè™Á©∂Á∫†ÁéñÈü≠‰πÖÁÅ∏‰πùÈÖíÂé©ÊïëÊóßËáºËàÖÂíéÂ∞±ÁñöÈû†ÊãòÁãôÁñΩËèäÂ±ÄÂíÄÁü©‰∏æÊ≤ÆËÅöÊãíÊçÆÂ∑®ÂÖ∑Ë∑ùË∏ûÈîØ‰ø±Âè•ÊÉßÁÇ¨ÂâßÊçêÈπÉÂ®üÂÄ¶Áú∑Âç∑Áª¢ÊíÖÊî´ÊäâÊéòÂÄîÁàµËßâÂÜ≥ËØÄÁªùÂùáËèåÈíßÂÜõÂêõÂ≥ª‰øäÁ´£ÊµöÈÉ°È™èÂñÄÂíñÂç°ÂíØÂºÄÊè©Ê•∑Ê•∑ÂáØÊÖ®ÂàäÂ†™ÂãòÂùéÁ†çÁúãÂ∫∑ÊÖ∑Á≥†ÊâõÊäó‰∫¢ÁÇïËÄÉÊã∑ÁÉ§Èù†Âù∑ËãõÊüØÊ£µÁ£ïÈ¢óÁßëÂ£≥Âí≥ÂèØÊ∏¥ÂÖãÂàªÂÆ¢ËØæËÇØÂïÉÂû¶ÊÅ≥ÂùëÂê≠Á©∫ÊÅêÂ≠îÊéßÊä†Âè£Êâ£ÂØáÊûØÂì≠Á™üËã¶ÈÖ∑Â∫ìË£§Â§∏ÂûÆÊåéË∑®ËÉØÂùóÂø´‰æ©Á≠∑ÂÆΩÊ¨æÂå°Á≠êÁãÇÊ°ÜÁüøÁú∂Êó∑ÂÜµ‰∫èÁõîÂ≤øÁ™•ËëµÂ•éÈ≠ÅÂÇÄÈ¶àÊÑßÊ∫ÉÂù§ÊòÜÊçÜÂõ∞Êã¨Êâ©ÂªìÈòîÂûÉÂúæÊãâÂñáËú°ËÖäËæ£Âï¶Ëé±Êù•ËµñËìùÂ©™Ê†èÊã¶ÁØÆÈòëÂÖ∞ÊæúË∞∞ÊèΩËßàÊáíÁºÜÁÉÇÊª•ÁêÖÊ¶îÁãºÂªäÈÉéÊúóÊµ™ÊçûÂä≥Áâ¢ËÄÅ‰Ω¨Âß•ÈÖ™ÁÉôÊ∂ùÂãí‰πêÈõ∑Èï≠ËïæÁ£äÁ¥ØÂÑ°ÂûíÊìÇËÇãÁ±ªÊ≥™Ê£±Ê•ûÂÜ∑ÂéòÊ¢®ÁäÅÈªéÁØ±Áã∏Á¶ªÊºìÁêÜÊùéÈáåÈ≤§Á§ºËéâËçîÂêèÊ†ó‰∏ΩÂéâÂä±Á†æÂéÜÂà©ÂÇà‰æã‰øêÁó¢Á´ãÁ≤íÊ≤•Èö∂ÂäõÁíÉÂì©‰ø©ËÅîËé≤ËøûÈï∞ÂªâÊÄúÊ∂üÂ∏òÊïõËÑ∏ÈìæÊÅãÁÇºÁªÉÁ≤ÆÂáâÊ¢ÅÁ≤±ËâØ‰∏§ËæÜÈáèÊôæ‰∫ÆË∞ÖÊí©ËÅäÂÉöËæΩÊΩ¶‰∫ÜÊíÇÈï£ÂªñÊñôÂàóË£ÇÁÉàÂä£ÁåéÁê≥ÊûóÁ£∑Èúñ‰∏¥ÈÇªÈ≥ûÊ∑ãÂáõËµÅÂêùÊãéÁé≤Ëè±Èõ∂ÈæÑÈìÉ‰º∂ÁÅµÂ≤≠È¢ÜÂè¶‰ª§Ê∫úÁêâÊ¶¥Á°´È¶èÁïôÂàòÁò§ÊµÅÊü≥ÂÖ≠ÈæôËÅãÂíôÁ¨ºÁ™øÈöÜÂûÑÊã¢ÈôáÊ•ºÂ®ÑÊêÇÁØìÊºèÈôãËä¶Âç¢È¢ÖÂ∫êÁÇâÊé≥Âç§ËôèÈ≤ÅÈ∫ìÁ¢åÈú≤Ë∑ØËµÇÈπøÁ¶ÑÂΩïÈôÜÊàÆÈ©¥ÂêïÈìù‰æ£ÊóÖÂ±•Â±°ÁºïËôëÊ∞ØÂæãÁéáÊª§ÁªøÂ≥¶ÊåõÂ≠™Êª¶Âçµ‰π±Êé†Áï•Êä°ËΩÆ‰º¶‰ªëÊ≤¶Á∫∂ËÆ∫ËêùËû∫ÁΩóÈÄªÈî£ÁÆ©È™°Ë£∏ËêΩÊ¥õÈ™ÜÁªúÂ¶àÈ∫ªÁéõÁ†ÅËöÇÈ©¨È™ÇÂòõÂêóÂüã‰π∞È∫¶ÂçñËøàËÑâÁûíÈ¶íËõÆÊª°ËîìÊõºÊÖ¢Êº´ËäíËå´Áõ≤Ê∞ìÂøôËéΩÁå´ËåÖÈîöÊØõÁüõÈìÜÂçØËåÇÂÜíÂ∏ΩË≤åË¥∏‰πàÁé´ÊûöÊ¢ÖÈÖ∂ÈúâÁÖ§Ê≤°ÁúâÂ™íÈïÅÊØèÁæéÊòßÂØêÂ¶πÂ™öÈó®Èó∑‰ª¨ËêåËíôÊ™¨ÁõüÈî∞ÁåõÊ¢¶Â≠üÁúØÈÜöÈù°Á≥úËø∑Ë∞úÂº•Á±≥ÁßòËßÖÊ≥åËúúÂØÜÂπÇÊ£âÁú†ÁªµÂÜïÂÖçÂãâÂ®©ÁºÖÈù¢ËãóÊèèÁûÑËóêÁßíÊ∏∫Â∫ôÂ¶ôËîëÁÅ≠Ê∞ëÊäøÁöøÊïèÊÇØÈóΩÊòéËûüÈ∏£Èì≠ÂêçÂëΩË∞¨Êë∏ÊëπËòëÊ®°ËÜúÁ£®Êë©È≠îÊäπÊú´Ëé´Â¢®ÈªòÊ≤´Êº†ÂØûÈôåË∞ãÁâüÊüêÊãáÁâ°‰∫©ÂßÜÊØçÂ¢ìÊöÆÂπïÂãüÊÖïÊú®ÁõÆÁù¶ÁâßÁ©ÜÊãøÂì™ÂëêÈí†ÈÇ£Â®úÁ∫≥Ê∞ñ‰πÉÂ•∂ËÄêÂ•àÂçóÁî∑ÈöæÂõäÊå†ËÑëÊÅºÈóπÊ∑ñÂë¢È¶ÅÂÜÖÂ´©ËÉΩÂ¶ÆÈúìÂÄ™Ê≥•Â∞ºÊãü‰Ω†ÂåøËÖªÈÄÜÊ∫∫Ëî´ÊãàÂπ¥Á¢æÊíµÊçªÂøµÂ®òÈÖøÈ∏üÂ∞øÊçèËÅÇÂ≠ΩÂïÆÈïäÈïçÊ∂ÖÊÇ®Êü†ÁãûÂáùÂÆÅÊãßÊ≥ûÁâõÊâ≠ÈíÆÁ∫ΩËÑìÊµìÂÜúÂºÑÂ•¥Âä™ÊÄíÂ•≥ÊöñËôêÁñüÊå™Êá¶Á≥ØËØ∫Âì¶Ê¨ßÈ∏•ÊÆ¥ËóïÂëïÂÅ∂Ê≤§Âï™Ë∂¥Áà¨Â∏ïÊÄïÁê∂ÊãçÊéíÁâåÂæòÊπÉÊ¥æÊîÄÊΩòÁõòÁ£êÁõºÁïîÂà§Âèõ‰πìÂ∫ûÊóÅËÄ™ËÉñÊäõÂíÜÂà®ÁÇÆË¢çË∑ëÊ≥°Âë∏ËÉöÂüπËµîÈô™ÈÖç‰Ω©Ê≤õÂñ∑ÁõÜÁ†∞Êä®ÁÉπÊæéÂΩ≠Ëì¨Ê£öÁ°ºÁØ∑ËÜ®ÊúãÈπèÊçßÁ¢∞ÂùØÁ†íÈúπÊâπÊä´ÂäàÁêµÊØóÂï§ËÑæÁñ≤ÁöÆÂåπÁóûÂÉªÂ±ÅË≠¨ÁØáÂÅèÁâáÈ™óÈ£òÊºÇÁì¢Á•®ÊíáÁû•ÊãºÈ¢ëË¥´ÂìÅËÅò‰πíÂù™ËãπËêçÂπ≥Âá≠Áì∂ËØÑÂ±èÂù°Ê≥ºÈ¢áÂ©ÜÁ†¥È≠ÑËø´Á≤ïÂâñÊâëÈì∫‰ªÜËí≤Ëë°Ëè©Ëí≤ÂüîÊú¥ÂúÉÊôÆÊµ¶Ë∞±ÊõùÁÄëÊúüÊ¨∫Ê†ñÊàöÂ¶ª‰∏ÉÂáÑÊºÜÊüíÊ≤èÂÖ∂Ê£ãÂ•áÊ≠ßÁï¶Â¥éËÑêÈΩêÊóóÁ•àÁ•ÅÈ™ëËµ∑Â≤Ç‰πû‰ºÅÂêØÂ•ëÁ†åÂô®Ê∞îËøÑÂºÉÊ±ΩÊ≥£ËÆ´ÊéêÊ¥ΩÁâµÊâ¶ÈíéÈìÖÂçÉËøÅÁ≠æË∞¶‰πæÈªîÈí±Èí≥ÂâçÊΩúÈÅ£ÊµÖË∞¥Â†ëÂµåÊ¨†Ê≠âÊû™ÂëõËÖîÁæåÂ¢ôËî∑Âº∫Êä¢Ê©áÈîπÊï≤ÊÇÑÊ°•Áûß‰πî‰æ®Â∑ßÈûòÊí¨ÁøòÂ≥≠‰øèÁ™çÂàáËåÑ‰∏îÊÄØÁ™ÉÈí¶‰æµ‰∫≤Áß¶Áê¥Âã§ËäπÊìíÁ¶ΩÂØùÊ≤ÅÈùíËΩªÊ∞¢ÂÄæÂçøÊ∏ÖÊìéÊô¥Ê∞∞ÊÉÖÈ°∑ËØ∑Â∫ÜÁêºÁ©∑Áßã‰∏òÈÇ±ÁêÉÊ±ÇÂõöÈÖãÊ≥ÖË∂ãÂå∫ËõÜÊõ≤Ë∫ØÂ±àÈ©±Ê∏†ÂèñÂ®∂ÈæãË∂£ÂéªÂúàÈ¢ßÊùÉÈÜõÊ≥âÂÖ®ÁóäÊã≥Áä¨Âà∏ÂäùÁº∫ÁÇîÁò∏Âç¥ÈπäÊ¶∑Á°ÆÈõÄË£ôÁæ§ÁÑ∂ÁáÉÂÜâÊüìÁì§Â£§ÊîòÂö∑ËÆ©È•∂Êâ∞ÁªïÊÉπÁÉ≠Â£¨‰ªÅ‰∫∫ÂøçÈüß‰ªªËÆ§ÂàÉÂ¶äÁ∫´Êâî‰ªçÊó•ÊàéËå∏ËìâËç£ËûçÁÜîÊ∫∂ÂÆπÁªíÂÜóÊèâÊüîËÇâËåπË†ïÂÑíÂ≠∫Â¶ÇËæ±‰π≥Ê±ùÂÖ•Ë§•ËΩØÈòÆËïäÁëûÈîêÈó∞Ê∂¶Ëã•Âº±ÊííÊ¥íËê®ËÖÆÈ≥ÉÂ°ûËµõ‰∏âÂèÅ‰ºûÊï£Ê°ëÂóì‰∏ßÊêîÈ™öÊâ´Â´ÇÁëüËâ≤Ê∂©Ê£ÆÂÉßËééÁ†ÇÊùÄÂàπÊ≤ôÁ∫±ÂÇªÂï•ÁÖûÁ≠õÊôíÁèäËã´ÊùâÂ±±Âà†ÁÖΩË°´Èó™ÈôïÊìÖËµ°ËÜ≥ÂñÑÊ±ïÊâáÁºÆÂ¢í‰º§ÂïÜËµèÊôå‰∏äÂ∞öË£≥Ê¢¢ÊçéÁ®çÁÉßËäçÂã∫Èü∂Â∞ëÂì®ÈÇµÁªçÂ•¢ËµäËõáËàåËàçËµ¶ÊëÑÂ∞ÑÊÖëÊ∂âÁ§æËÆæÁ†∑Áî≥Âëª‰º∏Ë∫´Ê∑±Â®†ÁªÖÁ•ûÊ≤àÂÆ°Â©∂ËÇæÁîöÊ∏óÊÖéÂçáÁîüÂ£∞Áâ≤ËÉúÁª≥ÁúÅÂú£ÁõõÂâ©Â∞∏Â§±Â∏àËØóÊñΩÁãÆÊπøÂçÅÁü≥Êó∂ËØÜÂÆûÊãæËöÄÈ£üÂè≤Áü¢‰ΩøÂ±éÈ©∂ÂßãÂºèÁ§∫Â£´‰∏ñÊüø‰∫ãÊã≠Ë™ìÈÄùÂäøÊòØÂóúÂô¨ÈÄÇ‰ªï‰æçÈáäÈ•∞Ê∞èÂ∏ÇÊÅÉÂÆ§ËßÜËØïÊî∂ÊâãÈ¶ñÂÆàÂØøÊéàÂîÆÂèóÁò¶ÂÖΩËî¨Êû¢Ê¢≥ÊÆäÊäíËæìÂèîËàíÊ∑ëÁñè‰π¶ËµéÂ≠∞ÁÜüËñØÊöëÊõôÁΩ≤ËúÄÈªçÈº†Â±ûÊúØËø∞Ê†ëÊùüÊàçÁ´ñÂ¢ÖÂ∫∂Êï∞Êº±ÊÅïÂà∑ËÄçÊëîË°∞Áî©Â∏ÖÊ†ìÊã¥ÈúúÂèåÁàΩË∞ÅÊ∞¥Áù°Á®éÂêÆÁû¨È°∫ËàúËØ¥Á°ïÊúîÁÉÅÊñØÊíïÂò∂ÊÄùÁßÅÂè∏‰∏ùÊ≠ªËÇÜÂØ∫Âó£Âõõ‰º∫‰ººÈ•≤Â∑≥ÊùæËÄ∏ÊÄÇÈ¢ÇÈÄÅÂÆãËÆºËØµÊêúËâòÊìûÂóΩËãèÈÖ•‰øóÁ¥†ÈÄüÁ≤üÂ°ëÊ∫ØÂÆøËØâËÇÉÈÖ∏ËíúÁÆóËôΩÈöãÈöèÁª•È´ìÁ¢éÂ≤ÅÁ©óÈÅÇÈößÁ•üÂ≠ôÊçüÁ¨ãËìëÊ¢≠ÂîÜÁº©ÁêêÁ¥¢ÈîÅÊâÄÂ°å‰ªñÂÆÉÂ•πÂ°îÁç≠ÊåûËπãË∏èËÉéËãîÊä¨Âè∞Ê≥∞ÈÖûÂ§™ÊÄÅÊ±∞ÂùçÊëäË¥™Áò´Êª©ÂùõÊ™ÄÁó∞ÊΩ≠Ë∞≠Ë∞àÂù¶ÊØØË¢íÁ¢≥Êé¢ÂèπÁÇ≠Ê±§Â°òÊê™Â†ÇÊ£†ÂîêÁ≥ñËÜõÂ°òÂÄòË∫∫Ê∑åË∂üÁÉ´ÊéèÊ∂õÊªîÁª¶ËêÑÊ°ÉÈÄÉÊ∑òÈô∂ËÆ®Â•óÁâπËó§ËÖæÁñºË™äÊ¢ØÂâîË∏¢ÈîëÊèêÈ¢òËπÑÂïº‰ΩìÊõøÂöèÊÉïÊ∂ïÂâÉÂ±âÂ§©Ê∑ªÂ°´Áî∞ÁîúÊÅ¨ËàîËÖÜÊåëÊù°Ëø¢Áú∫Ë∑≥Ë¥¥ÈìÅÂ∏ñÂéÖÂê¨ÁÉÉÊ±ÄÂª∑ÂÅú‰∫≠Â∫≠Êå∫ËâáÈÄöÊ°êÈÖÆÁû≥ÂêåÈìúÂΩ§Á´•Ê°∂ÊçÖÁ≠íÁªüÁóõÂÅ∑ÊäïÂ§¥ÈÄèÂá∏ÁßÉÁ™ÅÂõæÂæíÈÄîÊ∂ÇÂ±†ÂúüÂêêÂÖîÊπçÂõ¢Êé®È¢ìËÖøËúïË§™ÈÄÄÂêûÂ±ØËáÄÊãñÊâòËÑ±È∏µÈôÄÈ©ÆÈ©ºÊ§≠Â¶•ÊãìÂîæÊåñÂìáËõôÊ¥ºÂ®ÉÁì¶Ë¢úÊ≠™Â§ñÂºØÊπæÁé©È°Ω‰∏∏ÁÉ∑ÂÆåÁ¢óÊåΩÊôöÁöñÊÉãÂÆõÂ©â‰∏áËÖïÊ±™Áéã‰∫°ÊûâÁΩëÂæÄÊó∫ÊúõÂøòÂ¶ÑÂ®ÅÂ∑çÂæÆÂç±Èü¶ËøùÊ°ÖÂõ¥ÂîØÊÉü‰∏∫ÊΩçÁª¥ËãáËêéÂßî‰ºü‰º™Â∞æÁ∫¨Êú™ËîöÂë≥ÁïèËÉÉÂñÇÈ≠è‰ΩçÊ∏≠Ë∞ìÂ∞âÊÖ∞Âç´ÁòüÊ∏©ËöäÊñáÈóªÁ∫πÂêªÁ®≥Á¥äÈóÆÂó°ÁøÅÁìÆÊåùËúóÊ∂°Á™ùÊàëÊñ°ÂçßÊè°Ê≤ÉÂ∑´ÂëúÈí®‰πåÊ±°ËØ¨Â±ãÊó†ËäúÊ¢ßÂêæÂê¥ÊØãÊ≠¶‰∫îÊçÇÂçàËàû‰ºç‰æÆÂùûÊàäÈõæÊô§Áâ©ÂãøÂä°ÊÇüËØØÊòîÁÜôÊûêË•øÁ°íÁüΩÊô∞ÂòªÂê∏Èî°Áâ∫Á®ÄÊÅØÂ∏åÊÇâËÜùÂ§ïÊÉúÁÜÑÁÉØÊ∫™Ê±êÁäÄÊ™ÑË¢≠Â∏≠‰π†Â™≥ÂñúÈì£Ê¥óÁ≥ªÈöôÊàèÁªÜÁûéËôæÂå£ÈúûËæñÊöáÂ≥°‰æ†Áã≠‰∏ãÂé¶Â§èÂêìÊéÄÈî®ÂÖà‰ªôÈ≤úÁ∫§Âí∏Ë¥§Ë°îËà∑Èó≤Ê∂éÂº¶Â´åÊòæÈô©Áé∞ÁåÆÂéøËÖ∫È¶ÖÁæ°ÂÆ™Èô∑ÈôêÁ∫øÁõ∏Âé¢Èï∂È¶ôÁÆ±Ë•ÑÊπò‰π°ÁøîÁ••ËØ¶ÊÉ≥Âìç‰∫´È°πÂ∑∑Ê©°ÂÉèÂêëË±°ËêßÁ°ùÈúÑÂâäÂìÆÂö£ÈîÄÊ∂àÂÆµÊ∑ÜÊôìÂ∞èÂ≠ùÊ†°ËÇñÂï∏Á¨ëÊïàÊ•î‰∫õÊ≠áËùéÈûãÂçèÊåüÊê∫ÈÇ™ÊñúËÉÅË∞êÂÜôÊ¢∞Âç∏ËüπÊáàÊ≥ÑÊ≥ªË∞¢Â±ëËñ™ËäØÈîåÊ¨£ËæõÊñ∞ÂøªÂøÉ‰ø°Ë°ÖÊòüËÖ•Áå©ÊÉ∫ÂÖ¥ÂàëÂûãÂΩ¢ÈÇ¢Ë°åÈÜíÂπ∏ÊùèÊÄßÂßìÂÖÑÂá∂ËÉ∏ÂåàÊ±πÈõÑÁÜä‰ºë‰øÆÁæûÊúΩÂóÖÈîàÁßÄË¢ñÁª£Â¢üÊàåÈúÄËôöÂòòÈ°ªÂæêËÆ∏ËìÑÈÖóÂèôÊó≠Â∫èÁïúÊÅ§ÁµÆÂ©øÁª™Áª≠ËΩ©ÂñßÂÆ£ÊÇ¨ÊóãÁéÑÈÄâÁô£Áú©ÁªöÈù¥ËñõÂ≠¶Á©¥Èõ™Ë°ÄÂããÁÜèÂæ™Êó¨ËØ¢ÂØªÈ©ØÂ∑°ÊÆâÊ±õËÆ≠ËÆØÈÄäËøÖÂéãÊäºÈ∏¶È∏≠ÂëÄ‰∏´ËäΩÁâôËöúÂ¥ñË°ôÊ∂ØÈõÖÂìë‰∫öËÆ∂ÁÑâÂíΩÈòâÁÉüÊ∑πÁõê‰∏•Á†îÂ≤©Âª∂Ë®ÄÈ¢úÈòéÁÇéÊ≤øÂ•ÑÊé©ÁúºË°çÊºîËâ≥Â†∞ÁáïÂéåÁ†öÈõÅÂîÅÂΩ¶ÁÑ∞ÂÆ¥Ë∞öÈ™åÊÆÉÂ§ÆÈ∏ØÁßßÊù®Êâ¨‰ΩØÁñ°ÁæäÊ¥ãÈò≥Ê∞ß‰ª∞ÁóíÂÖªÊ†∑ÊºæÈÇÄËÖ∞Â¶ñÁë∂ÊëáÂ∞ßÈÅ•Á™ëË∞£ÂßöÂí¨ËàÄËçØË¶ÅËÄÄÊ§∞ÂôéËÄ∂Áà∑ÈáéÂÜ∂‰πüÈ°µÊéñ‰∏öÂè∂Êõ≥ËÖãÂ§úÊ∂≤‰∏ÄÂ£πÂåªÊèñÈì±‰æù‰ºäË°£È¢êÂ§∑ÈÅóÁßª‰ª™ËÉ∞ÁñëÊ≤ÇÂÆúÂß®ÂΩùÊ§ÖËöÅÂÄöÂ∑≤‰πôÁü£‰ª•Ëâ∫ÊäëÊòìÈÇëÂ±π‰∫øÂΩπËáÜÈÄ∏ËÇÑÁñ´‰∫¶Ë£îÊÑèÊØÖÂøÜ‰πâÁõäÊ∫¢ËØ£ËÆÆË∞äËØëÂºÇÁøºÁøåÁªéËåµËç´Âõ†ÊÆ∑Èü≥Èò¥ÂßªÂêüÈì∂Ê∑´ÂØÖÈ•ÆÂ∞πÂºïÈöêÂç∞Ëã±Ê®±Â©¥Èπ∞Â∫îÁº®ËéπËê§Ëê•ËçßËùáËøéËµ¢ÁõàÂΩ±È¢ñÁ°¨Êò†ÂìüÊã•‰Ω£ËáÉÁóàÂ∫∏ÈõçË∏äËõπÂíèÊ≥≥Ê∂åÊ∞∏ÊÅøÂãáÁî®ÂπΩ‰ºòÊÇ†ÂøßÂ∞§Áî±ÈÇÆÈìÄÁäπÊ≤πÊ∏∏ÈÖâÊúâÂèãÂè≥‰ΩëÈáâËØ±ÂèàÂπºËøÇÊ∑§‰∫éÁõÇÊ¶ÜËôûÊÑöËàÜ‰Ωô‰øûÈÄæÈ±ºÊÑâÊ∏ùÊ∏îÈöÖ‰∫àÂ®±Èõ®‰∏éÂ±øÁ¶πÂÆáËØ≠ÁæΩÁéâÂüüËäãÈÉÅÂêÅÈÅáÂñªÂ≥™Âæ°ÊÑàÊ¨≤Áã±ËÇ≤Ë™âÊµ¥ÂØìË£ïÈ¢ÑË±´È∏≥Ê∏äÂÜ§ÂÖÉÂû£Ë¢ÅÂéüÊè¥ËæïÂõ≠ÂëòÂúÜÁåøÊ∫êÁºòËøúËãëÊÑøÊÄ®Èô¢Êõ∞Á∫¶Ë∂äË∑ÉÈí•Â≤≥Á≤§ÊúàÊÇ¶ÈòÖËØªËÄò‰∫ëÈÉßÂåÄÈô®ÂÖÅËøêËï¥ÈÖùÊôïÈüµÂ≠ïÂåùÁ†∏ÊùÇÊ†ΩÂìâÁÅæÂÆ∞ËΩΩÂÜçÂú®Âí±ÊîíÊöÇËµûËµÉËÑèËë¨ÈÅ≠Á≥üÂáøËóªÊû£Êó©Êæ°Ëö§Ë∫ÅÂô™ÈÄ†ÁöÇÁÅ∂Áá•Ë¥£Êã©ÂàôÊ≥ΩË¥ºÊÄéÂ¢ûÊÜéÊõæËµ†ÊâéÂñ≥Ê∏£Êú≠ËΩßÈì°Èó∏Áú®Ê†ÖÊ¶®Âíã‰πçÁÇ∏ËØàÊëòÊñãÂÆÖÁ™ÑÂÄ∫ÂØ®ÁûªÊØ°ÊñΩÁ≤òÊ≤æË©πÊØ°Â±ïÊàòÁ´ôÊπõÁªΩÊ®üÁ´†ÂΩ∞Êº≥Âº†ÊéåÊ∂®Êùñ‰∏àÂ∏êË¥¶‰ªóËÉÄÁò¥ÈöúÊãõÊò≠ÊâæÊ≤ºËµµÁÖßÁΩ©ÂÖÜËÇáÂè¨ÈÅÆÊäòÂì≤Ëõ∞ËæôËÄÖÈîóËîóËøôÊµôÁèçÊñüÁúüÁîÑÁ†ßËáªË¥ûÈíà‰æ¶ÊûïÁñπËØäÈúáÊåØÈïáÈòµËí∏Êå£ÁùÅÂæÅÁã∞‰∫âÊÄîÊï¥ÊãØÊ≠£ÊîøÂ∏ßÁóáÈÉëËØÅËäùÊûùÊîØÂê±ËúòÁü•ËÇ¢ËÑÇÊ±Å‰πãÁªáËÅåÁõ¥Ê§çÊÆñÊâßÂÄº‰æÑÂùÄÊåáÊ≠¢Ë∂æÂè™Êó®Á∫∏ÂøóÊåöÊé∑Ëá≥Ëá¥ÁΩÆÂ∏úÂ≥ôÂà∂Êô∫Áß©Á®öË¥®ÁÇôÁóîÊªûÊ≤ªÁ™í‰∏≠ÁõÖÂø†ÈíüË°∑ÁªàÁßçËÇøÈáç‰ª≤‰ºóËàüÂë®Â∑ûÊ¥≤ËØåÁ≤•ËΩ¥ËÇòÂ∏öÂííÁö±ÂÆôÊòºÈ™§Áè†Ê†™ËõõÊú±Áå™ËØ∏ËØõÈÄêÁ´πÁÉõÁÖÆÊãÑÁû©Âò±‰∏ªËëóÊü±Âä©ËõÄË¥ÆÈì∏Á≠ë‰ΩèÊ≥®Á•ùÈ©ªÊäìÁà™ÊãΩ‰∏ìÁ†ñËΩ¨Êí∞ËµöÁØÜÊ°©Â∫ÑË£ÖÂ¶ÜÊíûÂ£ÆÁä∂Ê§éÈî•ËøΩËµòÂù†ÁºÄË∞ÜÂáÜÊçâÊãôÂçìÊ°åÁê¢ËåÅÈÖåÂïÑÁùÄÁÅºÊµäÂÖπÂí®ËµÑÂßøÂßøÊªãÊ∑ÑÂ≠úÁ¥´‰ªîÁ±ΩÊªìÂ≠êËá™Ê∏çÂ≠óÈ¨ÉÊ£ïË∏™ÂÆóÁªºÊÄªÁ∫µÈÇπËµ∞Â•èÊèçÁßüË∂≥ÂçíÊóèÁ•ñËØÖÈòªÁªÑÈíªÁ∫ÇÂò¥ÈÜâÊúÄÁΩ™Â∞äÈÅµÊò®Â∑¶‰ΩêÊüûÂÅö‰ΩúÂùêÂ∫ßÂùêÂ∫ß";

        // --- PINYIN DATA ---
        // Added 'Êó†' (None) for zero-initial syllables (like 'ai', 'an', 'e')
        const PINYIN_INITIALS = ['Êó†','b','p','m','f','d','t','n','l','g','k','h','j','q','x','zh','ch','sh','r','z','c','s','y','w'];
        
        // Medials (Jiemu) - The bridge in Sanpin (Three-spell)
        const PINYIN_MEDIALS = ['','i','u','v'];
        
        // Standard Finals (Yunmu) - Restored to standard list without compounds
        const PINYIN_FINALS = [
            'a','o','e','ai','ei','ao','ou','an','en','ang','eng','ong',
            'i','ia','ie','iao','iu','ian','in','iang','ing','iong',
            'u','ua','uo','ui','uai','uan','un','uang',
            'v','ve','vn' // 'v' is √º in input
        ];

        // --- SAFE AUDIO ENGINE (CRASH PROOF) ---
        // cancelPrevious: If true, stops current audio. If false, adds to queue.
        const playAudio = (text, isPuppy = false, isEnglish = false, cancelPrevious = true) => {
            try {
                // Safety cancel only if requested
                if (cancelPrevious) {
                    window.speechSynthesis.cancel();
                }

                const u = new SpeechSynthesisUtterance(text);
                
                // Simple Lang Logic
                u.lang = isEnglish ? 'en-US' : 'zh-CN';

                if (isPuppy) {
                    // PUPPY SETTINGS: High Pitch = Cute
                    u.pitch = 1.5; 
                    u.rate = 1.1; 
                } else {
                    // TEACHER SETTINGS: Normal Pitch, Slow
                    u.pitch = 1.0; 
                    u.rate = 0.85; 
                }

                window.speechSynthesis.speak(u);
            } catch (err) {
                console.warn("Audio error (ignored to prevent crash):", err);
            }
        };

        // --- MASCOT DIALOGUE DATABASE (Refactored with Actions) ---
        
        const CN_DIALOGUES = [
            { text: "‰πî‰æùÔºå‰Ω†ÊòØ‰∏ñÁïå‰∏äÊúÄÊ£íÁöÑ‰∏ÄÂπ¥Á∫ßÂ∞èÂ≠¶ÁîüÔºÅ", action: "jump" },
            { text: "Ê±™Ê±™ÔºÅ‰πî‰æùÔºåÊàë‰πüÊÉ≥Ë¶Å‰∏Ä‰ª∂Á≤âËâ≤ÁöÑÊñ∞Ë°£ÊúçÔºÅ", action: "wiggle" },
            { text: "‰πî‰æùÔºåÂÜôÁ¥Ø‰∫ÜÂêóÔºüÊë∏Êë∏ÊàëÁöÑÂ§¥‰ºëÊÅØ‰∏Ä‰∏ãÂêß„ÄÇ", action: "pulse" },
            { text: "‰πî‰æùÂä†Ê≤πÔºÅÊàë‰ª¨Â±ûÁãóÁöÑÂ∞èÊúãÂèã‰∏ç‰ªÖÂèØÁà±ÔºåËøòÂæàÂä™ÂäõÔºÅ", action: "jump" },
            { text: "ÂìáÔºÅ‰πî‰æùÂÜôÂ≠óË∂äÊù•Ë∂äÂ•ΩÁúã‰∫ÜÔºåÊàëË¶ÅÁªô‰Ω†ÊØî‰∏™ÂøÉÔºÅ", action: "pulse" },
            { text: "‰πî‰æùÔºå‰Ω†Áü•ÈÅìÂêóÔºüÊàëÊúÄÂñúÊ¨¢Áúã‰Ω†ËÆ§ÁúüÁöÑÊ†∑Â≠ê„ÄÇ", action: "pulse" },
            { text: "ÂòøÂòøÔºå‰πî‰æùÔºå‰Ω†ÁúãÊàëÁöÑÂ∞æÂ∑¥ÊëáÂæóÂø´‰∏çÂø´Ôºü", action: "wiggle" },
            { text: "‰πî‰æùÔºå‰ªäÂ§©ÁöÑ‰Ωú‰∏öÊàë‰ª¨‰∏ÄÂÆöËÉΩÊãø‰∏ÄÁôæÂàÜÔºÅ", action: "jump" },
            { text: "‰πî‰æùÔºå‰∏çË¶ÅÊÄïÁäØÈîôÔºåÊàë‰ºö‰∏ÄÁõ¥Èô™ÁùÄ‰Ω†ÁöÑ„ÄÇ", action: "pulse" },
            { text: "‰πî‰æùÔºåËøô‰∏™Â≠óËôΩÁÑ∂ÈöæÔºå‰ΩÜÊòØ‰Ω†‰∏ÄÂÆöË°åÔºÅ", action: "jump" },
            { text: "‰πî‰æùÔºåÊàë‰ª¨‰ºëÊÅØ‰∏Ä‰ºöÔºåÂî±È¶ñÂÑøÊ≠åÂ•Ω‰∏çÂ•ΩÔºü", action: "wiggle" },
            { text: "‰πî‰æùÔºå‰Ω†Â∞±ÂÉèÊò•Â§©ÁöÑËä±Êúµ‰∏ÄÊ†∑ÂèØÁà±ÔºÅ", action: "pulse" },
            { text: "‰πî‰æùÔºå‰ªäÂ§©Âú®Â≠¶Ê†°ÂºÄÂøÉÂêóÔºüÂø´ÂëäËØâÊàëÔºÅ", action: "wiggle" },
            { text: "‰πî‰æùÔºåÊàëÊòØ‰Ω†ÁöÑÂÆàÊä§Â∞èÁãóÔºåÊàë‰ºöÊ∞∏Ëøú‰øùÊä§‰Ω†ÔºÅ", action: "pulse" },
            { text: "‰πî‰æùÔºåÂø´ÁúãÔºåÊàëÂ≠¶‰ºö‰∫ÜÊñ∞ÁöÑË∑≥ËàûÂä®‰ΩúÔºÅ", action: "spin" }
        ];

        const EN_DIALOGUES = [
            { en: "Winnie, you are amazing!", cn: "WinnieÔºå‰Ω†Â§™Ê£í‰∫ÜÔºÅ", action: "jump" },
            { en: "Good morning, Winnie! Ready to learn?", cn: "Êó©‰∏äÂ•ΩWinnieÔºÅÂáÜÂ§áÂ•ΩÂ≠¶‰π†‰∫ÜÂêóÔºü", action: "jump" },
            { en: "Winnie, look at this letter!", cn: "WinnieÔºåÁúãËøô‰∏™Â≠óÊØçÔºÅ", action: "wiggle" },
            { en: "You represent the Year of the Dog, Winnie!", cn: "WinnieÔºå‰Ω†ÊòØÂ±ûÁãóÁöÑÂ∞è‰ª£Ë°®Âì¶ÔºÅ", action: "wiggle" },
            { en: "Winnie, is your favorite color pink?", cn: "WinnieÔºå‰Ω†ÊúÄÂñúÊ¨¢ÁöÑÈ¢úËâ≤ÊòØÁ≤âËâ≤ÂêóÔºü", action: "wiggle" },
            { en: "High five, Winnie!", cn: "WinnieÔºåÂáª‰∏™ÊéåÔºÅ", action: "jump" },
            { en: "I am your best friend, Winnie.", cn: "WinnieÔºåÊàëÊòØ‰Ω†ÊúÄÂ•ΩÁöÑÊúãÂèã„ÄÇ", action: "pulse" },
            { en: "Winnie, keep going!", cn: "WinnieÔºåÁªßÁª≠Âä†Ê≤πÔºÅ", action: "jump" },
            { en: "What a beautiful day, Winnie.", cn: "WinnieÔºå‰ªäÂ§©Â§©Ê∞îÁúüÂ•Ω„ÄÇ", action: "wiggle" },
            { en: "Winnie, you speak English very well.", cn: "WinnieÔºå‰Ω†ÁöÑËã±ËØ≠ËØ¥ÂæóÂæàÂ•Ω„ÄÇ", action: "spin" },
            { en: "Let's play a game, Winnie.", cn: "WinnieÔºåÊàë‰ª¨Êù•Áé©‰∏™Ê∏∏ÊàèÂêß„ÄÇ", action: "spin" },
            { en: "Winnie, do you like apples?", cn: "WinnieÔºå‰Ω†ÂñúÊ¨¢ËãπÊûúÂêóÔºü", action: "wiggle" },
            { en: "Listen carefully, Winnie.", cn: "WinnieÔºå‰ªîÁªÜÂê¨Âì¶„ÄÇ", action: "pulse" },
            { en: "You are so smart, Winnie.", cn: "WinnieÔºå‰Ω†ÁúüËÅ™Êòé„ÄÇ", action: "jump" },
            { en: "See you tomorrow, Winnie.", cn: "WinnieÔºåÊòéÂ§©ËßÅ„ÄÇ", action: "pulse" }
        ];

        // --- Data: Phonics (A-Z) with Translations ---
        const PHONICS_DATA = [
            { id: 'A', word: 'Apple', meaning: 'ËãπÊûú', emoji: 'üçé', options: ['A', 'O', 'U'] },
            { id: 'B', word: 'Bear', meaning: 'Â∞èÁÜä', emoji: 'üêª', options: ['B', 'P', 'D'] },
            { id: 'C', word: 'Cat', meaning: 'Â∞èÁå´', emoji: 'üê±', options: ['C', 'K', 'S'] },
            { id: 'D', word: 'Dog', meaning: 'Â∞èÁãó', emoji: 'üê∂', options: ['D', 'B', 'P'] },
            { id: 'E', word: 'Egg', meaning: 'È∏°Ëõã', emoji: 'ü•ö', options: ['E', 'I', 'A'] },
            { id: 'F', word: 'Fish', meaning: 'Â∞èÈ±º', emoji: 'üêü', options: ['F', 'T', 'V'] },
            { id: 'G', word: 'Girl', meaning: 'Â•≥Â≠©', emoji: 'üëß', options: ['G', 'J', 'K'] },
            { id: 'H', word: 'Happy', meaning: 'ÂºÄÂøÉ', emoji: 'üòÑ', options: ['H', 'M', 'N'] },
            { id: 'I', word: 'Ice', meaning: 'ÂÜ∞Âùó', emoji: 'üßä', options: ['I', 'E', 'L'] },
            { id: 'J', word: 'Juice', meaning: 'ÊûúÊ±Å', emoji: 'üßÉ', options: ['J', 'G', 'Y'] },
            { id: 'K', word: 'Kite', meaning: 'È£éÁ≠ù', emoji: 'ü™Å', options: ['K', 'C', 'X'] },
            { id: 'L', word: 'Lion', meaning: 'ÁãÆÂ≠ê', emoji: 'ü¶Å', options: ['L', 'I', 'R'] },
            { id: 'M', word: 'Moon', meaning: 'Êúà‰∫Æ', emoji: 'üåô', options: ['M', 'N', 'W'] },
            { id: 'N', word: 'Nose', meaning: 'ÈºªÂ≠ê', emoji: 'üëÉ', options: ['N', 'M', 'U'] },
            { id: 'O', word: 'Orange', meaning: 'Ê©ôÂ≠ê', emoji: 'üçä', options: ['O', 'A', 'Q'] },
            { id: 'P', word: 'Pig', meaning: 'Â∞èÁå™', emoji: 'üê∑', options: ['P', 'B', 'D'] },
            { id: 'Q', word: 'Queen', meaning: 'Â•≥Áéã', emoji: 'üë∏', options: ['Q', 'O', 'P'] },
            { id: 'R', word: 'Rabbit', meaning: 'ÂÖîÂ≠ê', emoji: 'üê∞', options: ['R', 'P', 'B'] },
            { id: 'S', word: 'Sun', meaning: 'Â§™Èò≥', emoji: '‚òÄÔ∏è', options: ['S', 'C', 'Z'] },
            { id: 'T', word: 'Tiger', meaning: 'ËÄÅËôé', emoji: 'üêØ', options: ['T', 'F', 'L'] },
            { id: 'U', word: 'Umbrella', meaning: 'Èõ®‰ºû', emoji: '‚òÇÔ∏è', options: ['U', 'V', 'Y'] },
            { id: 'V', word: 'Van', meaning: 'Ë¥ßËΩ¶', emoji: 'üöê', options: ['V', 'W', 'U'] },
            { id: 'W', word: 'Water', meaning: 'Ê∞¥', emoji: 'üíß', options: ['W', 'M', 'V'] },
            { id: 'X', word: 'Box', meaning: 'ÁõíÂ≠ê', emoji: 'üì¶', options: ['X', 'S', 'K'] },
            { id: 'Y', word: 'Yo-yo', meaning: 'Ê∫úÊ∫úÁêÉ', emoji: 'ü™Ä', options: ['Y', 'I', 'J'] },
            { id: 'Z', word: 'Zebra', meaning: 'ÊñëÈ©¨', emoji: 'ü¶ì', options: ['Z', 'S', 'X'] },
        ];

        // --- Shared Components ---

        // Custom Chinese Knot Icon (SVG)
        const ChineseKnotIcon = () => (
             <svg width="34" height="34" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" className="drop-shadow-sm">
                <defs>
                    <filter id="glow" x="-20%" y="-20%" width="140%" height="140%">
                        <feGaussianBlur stdDeviation="2" result="blur" />
                        <feComposite in="SourceGraphic" in2="blur" operator="over" />
                    </filter>
                </defs>
                <rect x="34" y="34" width="32" height="32" transform="rotate(45 50 50)" fill="#D32F2F" stroke="#B71C1C" strokeWidth="2" />
                <path d="M50 34 C50 20, 65 20, 65 35" stroke="#D32F2F" strokeWidth="4" fill="none" transform="rotate(-45 50 50)" />
                <path d="M50 34 C50 20, 35 20, 35 35" stroke="#D32F2F" strokeWidth="4" fill="none" transform="rotate(45 50 50)" />
                <path d="M50 66 C50 80, 65 80, 65 65" stroke="#D32F2F" strokeWidth="4" fill="none" transform="rotate(45 50 50)" />
                <path d="M50 66 C50 80, 35 80, 35 65" stroke="#D32F2F" strokeWidth="4" fill="none" transform="rotate(-45 50 50)" />
                <line x1="50" y1="74" x2="50" y2="95" stroke="#D32F2F" strokeWidth="4" strokeLinecap="round" />
                <line x1="42" y1="78" x2="42" y2="92" stroke="#D32F2F" strokeWidth="2" strokeLinecap="round" />
                <line x1="58" y1="78" x2="58" y2="92" stroke="#D32F2F" strokeWidth="2" strokeLinecap="round" />
                <rect x="42" y="42" width="16" height="16" transform="rotate(45 50 50)" fill="#FFCDD2" />
            </svg>
        );

        // --- MASCOT COMPONENT (Redesigned for Middle-Right Position) ---
        const Mascot = ({ mode, status }) => {
            const isEnglish = mode === 'english';
            const [currentAnim, setCurrentAnim] = useState('');
            const [dialogue, setDialogue] = useState(null);
            
            useEffect(() => {
                if (status === 'success') {
                    setCurrentAnim('animate-tada'); 
                } else {
                    setCurrentAnim('');
                    setDialogue(null); 
                }
            }, [status]);

            const handleInteraction = (e) => {
                e.stopPropagation();
                
                const list = isEnglish ? EN_DIALOGUES : CN_DIALOGUES;
                const item = list[Math.floor(Math.random() * list.length)];
                
                setDialogue(isEnglish ? item.en : item.text);

                // Map ACTION to CSS CLASS
                let animClass = 'animate-tada';
                if (item.action === 'jump') animClass = 'animate-dog-jump';
                if (item.action === 'wiggle') animClass = 'animate-dog-wiggle';
                if (item.action === 'spin') animClass = 'animate-dog-spin';
                if (item.action === 'pulse') animClass = 'animate-dog-pulse';

                setCurrentAnim(animClass);

                // Safe Audio Call
                if (isEnglish) {
                    playAudio(item.en, true, true);
                } else {
                    playAudio(item.text, true, false);
                }

                setTimeout(() => {
                    setCurrentAnim('');
                }, 1000); 
            };

            const handleCloseDialogue = (e) => {
                e.stopPropagation();
                setDialogue(null);
            };

            return (
                <div className="relative flex flex-col items-center group">
                    {/* Speech Bubble - Pops Left */}
                    {dialogue && (
                        <div 
                            onClick={handleCloseDialogue}
                            className="absolute right-[110%] top-1/2 -translate-y-1/2 w-48 z-[201] animate-pop cursor-pointer"
                            role="button"
                            aria-label="Close dialogue"
                        >
                            <div className={`bg-white p-3 rounded-2xl shadow-xl border-2 text-center relative
                                ${isEnglish ? 'border-qy-purple text-qy-text-purple' : 'border-qy-pink text-qy-text-pink'}`}>
                                
                                {/* Close Button */}
                                <div className="absolute -top-2 -left-2 w-6 h-6 bg-white border border-gray-200 rounded-full flex items-center justify-center text-gray-400 font-bold shadow-sm hover:text-red-500 z-10">‚úï</div>
                                
                                <p className="text-sm font-bold leading-tight">{dialogue}</p>
                                <div className={`absolute top-1/2 -translate-y-1/2 -right-[12px] w-0 h-0 border-t-[8px] border-t-transparent border-b-[8px] border-b-transparent border-l-[12px]
                                    ${isEnglish ? 'border-l-qy-purple' : 'border-l-qy-pink'}`}></div>
                            </div>
                        </div>
                    )}

                    {/* Dog Emoji - Scaled for fixed position */}
                    <div 
                        onClick={handleInteraction}
                        className={`text-6xl sm:text-7xl filter drop-shadow-lg cursor-pointer hover:scale-110 active:scale-95 transition-transform relative z-10 ${currentAnim}`}
                        role="button"
                        aria-label="Interact with Mascot"
                    >
                        üê∂
                    </div>
                </div>
            );
        };

        // --- NEW COMPONENT: PINYIN SELECTOR MODAL ---
        const PinyinSelector = ({ onClose, onSelectChar }) => {
            const [step, setStep] = useState('initial'); // 'initial' | 'final' | 'select'
            const [selectedInitial, setSelectedInitial] = useState('');
            const [selectedMedial, setSelectedMedial] = useState(''); // New: Medial State
            const [selectedFinal, setSelectedFinal] = useState('');
            const [matchedChars, setMatchedChars] = useState([]);
            const [validPinyins, setValidPinyins] = useState(new Set());

            // 1. Compute valid pinyins from character database on mount
            useEffect(() => {
                if(!COMMON_CHARS) return;
                const set = new Set();
                const chars = COMMON_CHARS.split('');
                chars.forEach(char => {
                    const pyResult = cnchar.spell(char); 
                    const addPinyin = (p) => {
                         if(typeof p === 'string') set.add(p.toLowerCase());
                    }
                    if(Array.isArray(pyResult)) {
                        pyResult.forEach(addPinyin);
                    } else {
                        addPinyin(pyResult);
                    }
                });
                setValidPinyins(set);
            }, []);

            const handleInitialClick = (init) => {
                setSelectedInitial(init);
                setStep('final');
                setSelectedMedial(''); // Reset medial when picking new initial
            };

            // Toggle Medial
            const handleMedialClick = (medial) => {
                setSelectedMedial(medial === selectedMedial ? '' : medial); // Allow toggle off
            };

            const handleFinalClick = (final) => {
                if (!checkCombination(selectedInitial, selectedMedial, final)) return;

                setSelectedFinal(final);
                const init = selectedInitial === 'Êó†' ? '' : selectedInitial;
                
                // Assemble full pinyin logic for searching
                const { searchPinyin } = assemblePinyin(init, selectedMedial, final);

                // Filter Common Chars
                const matches = [];
                const chars = COMMON_CHARS.split('');
                chars.forEach(char => {
                    const pyNoTone = cnchar.spell(char);
                    const pyList = Array.isArray(pyNoTone) ? pyNoTone : [pyNoTone];
                    const hasMatch = pyList.some(p => p.toLowerCase() === searchPinyin.toLowerCase());
                    if (hasMatch) matches.push(char);
                });

                const uniqueMatches = [...new Set(matches)];
                setMatchedChars(uniqueMatches);
                setStep('select');
            };

            // --- HELPER: Logic for combining Initial + Medial + Final into Standard Pinyin ---
            // Handles rules like j/q/x + √º -> u
            const assemblePinyin = (init, medial, final) => {
                // Base components
                let p_init = init;
                let p_medial = medial;
                let p_final = final;

                // RULE 1: j, q, x + √º (v) -> ju, qu, xu
                if (['j', 'q', 'x'].includes(init) && medial === 'v') {
                    p_medial = 'u';
                }
                // RULE 2: y + √º (v) -> yu
                if (init === 'y' && medial === 'v') {
                    p_medial = 'u';
                }
                 // RULE 3: j, q, x + √ºe (ve) -> jue, que, xue
                 if (['j', 'q', 'x'].includes(init) && final.startsWith('v')) {
                     // If medial is empty but final starts with v (like ve)
                     p_final = final.replace('v', 'u');
                }

                // If medial is 'v' but initial allows 'v' (n, l), keep 'v' (nv, lv)
                // If final has 'v', keep it unless caught by rules above

                const searchPinyin = p_init + p_medial + p_final;
                return { searchPinyin };
            };

            // Check if a specific combination is valid in DB
            const checkCombination = (init, medial, final) => {
                const i = init === 'Êó†' ? '' : init;
                const { searchPinyin } = assemblePinyin(i, medial, final);
                return validPinyins.has(searchPinyin);
            };

            // Check if a Medial is valid for current Initial (checking against ALL finals)
            const isMedialValidForInitial = (medial) => {
                // Loop through all finals, if AT LEAST ONE combination works, this medial is valid
                return PINYIN_FINALS.some(final => checkCombination(selectedInitial, medial, final));
            };

            const handleBack = () => {
                if (step === 'select') setStep('final');
                else if (step === 'final') setStep('initial');
            };

            return (
                <div className="fixed inset-0 z-[300] bg-white/95 backdrop-blur-xl flex flex-col items-center animate-pop p-4">
                    {/* Header */}
                    <div className="w-full flex justify-between items-center mb-6">
                        <button onClick={step === 'initial' ? onClose : handleBack} className="bg-gray-100 p-2 rounded-full text-2xl w-12 h-12 shadow-sm active:scale-90 transition-transform">
                             {step === 'initial' ? '‚úï' : 'üîô'}
                        </button>
                        <h2 className="text-2xl font-black text-qy-text-pink font-chinese tracking-widest">
                            {step === 'initial' && 'ÈÄâÂ£∞ÊØç (Initials)'}
                            {step === 'final' && 'ÈÄâÈüµÊØç (Finals)'}
                            {step === 'select' && 'ÈÄâÊ±âÂ≠ó (Pick Char)'}
                        </h2>
                        <div className="w-12"></div>
                    </div>

                    {/* Progress Display */}
                    <div className="flex items-center gap-2 mb-8 bg-pink-50 px-6 py-2 rounded-full border border-pink-100">
                        <span className={`text-2xl font-bold ${selectedInitial ? 'text-qy-text-pink' : 'text-gray-300'}`}>
                            {selectedInitial || '?'}
                        </span>
                        {/* Only show + Medial if selected */}
                        {selectedMedial && (
                            <>
                                <span className="text-gray-300">+</span>
                                <span className="text-2xl font-bold text-qy-text-pink">
                                    {selectedMedial === 'v' ? '√º' : selectedMedial}
                                </span>
                            </>
                        )}
                        <span className="text-gray-300">+</span>
                        <span className={`text-2xl font-bold ${selectedFinal ? 'text-qy-text-pink' : 'text-gray-300'}`}>
                            {selectedFinal ? (selectedFinal.startsWith('v') ? selectedFinal.replace('v','√º') : selectedFinal) : '?'}
                        </span>
                    </div>

                    {/* Content Area */}
                    <div className="flex-1 w-full overflow-y-auto px-2">
                        
                        {/* Step 1: Initials */}
                        {step === 'initial' && (
                            <div className="grid grid-cols-4 gap-4 pb-20">
                                {PINYIN_INITIALS.map(init => (
                                    <button 
                                        key={init}
                                        onClick={() => handleInitialClick(init)}
                                        className={`aspect-square rounded-2xl border-2 shadow-md flex items-center justify-center font-bold transition-all
                                            ${init === 'Êó†' ? 'bg-gray-50 border-gray-200 text-gray-500 text-xl' : 'bg-white border-pink-100 text-gray-600 text-3xl'}
                                            hover:bg-qy-pink hover:text-white hover:scale-105 active:scale-95`}
                                    >
                                        {init}
                                    </button>
                                ))}
                            </div>
                        )}

                        {/* Step 2: Finals (With Medial Toggle) */}
                        {step === 'final' && (
                            <div className="w-full flex flex-col gap-6 pb-20">
                                
                                {/* 2.1 Medial Toggles (Only if Initial is not 'Êó†') */}
                                {selectedInitial !== 'Êó†' && (
                                    <div className="bg-pink-50 rounded-2xl p-4 border border-pink-100">
                                        <div className="text-xs font-bold text-pink-400 mb-2 uppercase">ÈÄâÊã©‰ªãÊØç (Medial):</div>
                                        <div className="flex gap-4 justify-around">
                                            {PINYIN_MEDIALS.map(medial => {
                                                const isValid = isMedialValidForInitial(medial);
                                                const display = medial === '' ? 'Êó†' : (medial === 'v' ? '√º' : medial);
                                                const isSelected = selectedMedial === medial;

                                                return (
                                                    <button
                                                        key={medial}
                                                        onClick={() => isValid && handleMedialClick(medial)}
                                                        disabled={!isValid}
                                                        className={`px-6 py-2 rounded-xl font-bold text-lg transition-all border-2
                                                            ${!isValid ? 'opacity-30 border-transparent text-gray-300 cursor-not-allowed' : 
                                                              isSelected ? 'bg-qy-text-pink text-white border-qy-text-pink shadow-md scale-105' : 
                                                              'bg-white text-gray-600 border-pink-100 hover:border-pink-300'}`}
                                                    >
                                                        {display}
                                                    </button>
                                                )
                                            })}
                                        </div>
                                    </div>
                                )}

                                {/* 2.2 Finals Grid */}
                                <div>
                                    <div className="text-xs font-bold text-pink-400 mb-2 ml-1 uppercase">ÈÄâÊã©ÈüµÊØç (Final):</div>
                                    <div className="grid grid-cols-4 gap-4">
                                        {PINYIN_FINALS.map(final => {
                                            const isValid = checkCombination(selectedInitial, selectedMedial, final);
                                            // HIDE INVALID OPTIONS COMPLETELY
                                            if (!isValid) return null;

                                            return (
                                                <button 
                                                    key={final}
                                                    onClick={() => handleFinalClick(final)}
                                                    className="aspect-square rounded-2xl border-2 shadow-md flex items-center justify-center text-2xl font-bold transition-all bg-white border-pink-100 text-gray-600 hover:bg-qy-pink hover:text-white hover:scale-105 active:scale-95 cursor-pointer"
                                                >
                                                    {final.replace('v', '√º')}
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Step 3: Selection */}
                        {step === 'select' && (
                            <div className="flex flex-col items-center w-full pb-20">
                                {matchedChars.length === 0 ? (
                                    <div className="text-center mt-10">
                                        <div className="text-6xl mb-4">ü§î</div>
                                        <p className="text-gray-400 font-bold">Ê≤°ÊúâÊâæÂà∞Ëøô‰∏™ÊãºÈü≥ÁöÑÂ∏∏Áî®Â≠óÂì¶</p>
                                        <button onClick={()=>setStep('final')} className="mt-6 px-6 py-2 bg-pink-100 text-pink-500 rounded-full font-bold">Êç¢‰∏Ä‰∏™ÈüµÊØçËØïËØï</button>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-4 sm:grid-cols-5 gap-3 w-full">
                                        {matchedChars.map((char, idx) => (
                                            <button 
                                                key={idx}
                                                onClick={() => onSelectChar(char)}
                                                className="aspect-square rounded-2xl bg-white border-2 border-pink-100 shadow-sm flex flex-col items-center justify-center hover:bg-pink-50 hover:scale-110 active:scale-95 transition-all"
                                            >
                                                <span className="text-3xl font-chinese text-qy-text-pink">{char}</span>
                                            </button>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- HANZI VIEW COMPONENTS ---

        const MiZiGe = () => (
            <svg viewBox="0 0 300 300" style={{ width: '100%', height: '100%' }}>
                <rect x="0" y="0" width="300" height="300" fill="white" rx="20" />
                <rect x="4" y="4" width="292" height="292" fill="none" stroke="#FFB7C5" strokeWidth="4" rx="20" />
                <line x1="0" y1="0" x2="300" y2="300" stroke="#FFCCD5" strokeWidth="2" strokeDasharray="8,8" />
                <line x1="300" y1="0" x2="0" y2="300" stroke="#FFCCD5" strokeWidth="2" strokeDasharray="8,8" />
                <line x1="150" y1="0" x2="150" y2="300" stroke="#FFCCD5" strokeWidth="2" strokeDasharray="8,8" />
                <line x1="0" y1="150" x2="300" y2="150" stroke="#FFCCD5" strokeWidth="2" strokeDasharray="8,8" />
            </svg>
        );

        const HanziPlayer = ({ char, mode, onMistake, onCorrect, onComplete }) => {
            const containerRef = useRef(null);
            const writerRef = useRef(null);

            useEffect(() => {
                if (containerRef.current) containerRef.current.innerHTML = ""; 
                if (!char) return;

                const timer = setTimeout(() => {
                    if (!containerRef.current || !window.HanziWriter) return;
                    try {
                        const writer = HanziWriter.create(containerRef.current, char, {
                            width: 300,
                            height: 300,
                            padding: 20,
                            showOutline: true,
                            strokeAnimationSpeed: 1, 
                            delayBetweenStrokes: 500,
                            coloring: 'auto',
                            radicalColor: '#D63384',
                            strokeColor: '#333333',
                            outlineColor: '#FFCCD5',
                            drawingWidth: 30,
                            charDataLoader: (char, onComplete) => {
                                fetch(`https://cdn.jsdelivr.net/npm/hanzi-writer-data@2.0/${char}.json`)
                                    .then(res => res.json())
                                    .then(onComplete)
                                    .catch(err => console.error("Fetch Failed:", err));
                            },
                            onLoadCharDataSuccess: (data) => {
                                writer.showCharacter(); 
                                if (mode === 'animate') {
                                    writer.animateCharacter({ loop: true });
                                } else if (mode === 'quiz') {
                                    writer.quiz({
                                        onMistake: onMistake,
                                        onCorrectStroke: onCorrect,
                                        onComplete: onComplete
                                    });
                                }
                            },
                            onLoadCharDataError: (err) => console.error("Writer Load Error:", err)
                        });
                        writerRef.current = writer;
                    } catch (e) {
                        console.error("Crash during create:", e);
                    }
                }, 500); 

                return () => {
                    clearTimeout(timer);
                    if (writerRef.current) {
                        try { writerRef.current.cancelQuiz(); } catch(e){}
                    }
                };
            }, [char, mode]); 

            return (
                <div className="relative animate-pop mx-auto" style={{ width: '300px', height: '300px', borderRadius: '30px', overflow: 'hidden', boxShadow: '0 10px 30px rgba(0,0,0,0.05)', border: '6px solid white', background: 'white' }}>
                    <div style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', zIndex: 0 }}><MiZiGe /></div>
                    <div ref={containerRef} style={{ width: '300px', height: '300px', position: 'relative', zIndex: 10, cursor: 'pointer' }} />
                </div>
            );
        };

        const HanziView = ({ setMascotStatus }) => {
            const [inputValue, setInputValue] = useState('');
            const [charData, setCharData] = useState(null);
            const [selectedPinyin, setSelectedPinyin] = useState('');
            const [mode, setMode] = useState('animate'); 
            const [feedback, setFeedback] = useState(''); 
            const [error, setError] = useState(null);
            const [showPinyinSelector, setShowPinyinSelector] = useState(false);

            useEffect(() => {
                setTimeout(() => handleSearch('‰πî'), 100);
            }, []);

            const handleSearch = (charOverride) => {
                setError(null);
                setFeedback('');
                setMascotStatus('idle');
                const text = typeof charOverride === 'string' ? charOverride : inputValue;
                
                // Audio: Teacher Voice
                if (!text) {
                    playAudio("ËØ∑ËæìÂÖ•‰∏Ä‰∏™Ê±âÂ≠óÔºåÊàëÊù•Â∏Æ‰Ω†Â≠¶‰π†", false, false);
                    return;
                }

                const char = text.trim()[0]; 
                if (!/[\u4e00-\u9fa5]/.test(char)) {
                    setError('ËØ∑ËæìÂÖ•‰∏≠ÊñáÊ±âÂ≠óÂì¶~');
                    return;
                }
                try {
                    if (typeof cnchar === 'undefined') throw new Error('Loading...');
                    const pinyins = cnchar.spell(char, 'array', 'tone');
                    const strokeNames = cnchar.stroke(char, 'order', 'name');
                    const strokesCount = cnchar.stroke(char);
                    const radical = cnchar.radical(char);
                    
                    setCharData({
                        char,
                        pinyins: Array.isArray(pinyins) ? pinyins : [pinyins],
                        strokeNames: Array.isArray(strokeNames) ? strokeNames : [],
                        strokesCount,
                        radical,
                        id: Date.now() 
                    });
                    setSelectedPinyin(Array.isArray(pinyins) ? pinyins[0] : pinyins);
                    setMode('animate'); 
                    setInputValue(''); 
                    if(typeof charOverride === 'string') setInputValue(char);

                    // Audio: Teacher Voice (Read Character)
                    playAudio(char, false, false);

                } catch (e) {
                    setError('Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªú~');
                }
            };

            const handleComplete = () => {
                setFeedback('Â§™Ê£í‰∫ÜÔºÅüíØ');
                setMascotStatus('success');
                // Audio: Puppy Voice (Praise)
                playAudio("Ê±™Ê±™ÔºÅ‰πî‰æùÂÜôÂæóÁúüÂ•ΩÔºÅ", true, false);
                setTimeout(() => setMascotStatus('idle'), 3000);
            };

            const readPinyin = (p) => {
                setSelectedPinyin(p); 
                // Audio: Teacher Voice
                playAudio(charData.char, false, false);
            };

            // Audio: Read stroke name
            const readStroke = (name) => {
                playAudio(name, false, false);
            }

            // Callback from Pinyin Selector
            const handleSelectFromPinyin = (char) => {
                setShowPinyinSelector(false);
                setInputValue(char);
                handleSearch(char);
            };

            return (
                <div className="w-full max-w-lg px-4 flex flex-col items-center pt-2 pb-32">
                    {/* Search */}
                    <div className="w-full flex gap-3 mb-4 relative z-10">
                        <div className="flex-1 bg-white rounded-full shadow-sm border-2 border-qy-pink flex items-center px-4 focus-within:ring-4 ring-pink-100 transition-all">
                            {/* Clickable Magnifying Glass for Pinyin Selector */}
                            <button 
                                onClick={() => setShowPinyinSelector(true)}
                                className="text-qy-pink text-xl hover:scale-125 transition-transform active:scale-90"
                                aria-label="Open Pinyin Selector"
                            >
                                üîç
                            </button>
                            <input 
                                type="text" 
                                className="w-full py-2 px-2 text-xl font-chinese text-center outline-none bg-transparent placeholder-pink-200 text-qy-text-pink"
                                placeholder="ËæìÂÖ•Ê±âÂ≠ó..."
                                value={inputValue}
                                onChange={(e) => setInputValue(e.target.value)}
                                onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
                                maxLength={1}
                            />
                        </div>
                        <button onClick={() => handleSearch()} className="bg-qy-text-pink hover:bg-pink-600 text-white font-bold py-2 px-6 rounded-full shadow-md active:scale-95 border-2 border-transparent">
                            Â≠¶‰π†
                        </button>
                    </div>

                    {/* PINYIN SELECTOR MODAL */}
                    {showPinyinSelector && (
                        <PinyinSelector 
                            onClose={() => setShowPinyinSelector(false)} 
                            onSelectChar={handleSelectFromPinyin} 
                        />
                    )}

                    {error && <div className="w-full bg-white text-qy-text-pink px-4 py-3 rounded-2xl mb-6 text-sm font-bold text-center border-2 border-pink-100 shadow-sm">{error}</div>}

                    {charData ? (
                        <div className="w-full flex flex-col items-center">
                            <div className="flex flex-wrap justify-center gap-3 mb-6">
                                {charData.pinyins.map((p, idx) => (
                                    <button key={idx} onClick={() => readPinyin(p)} className={`px-5 py-2 rounded-2xl text-xl font-black font-rounded transition-all border-b-4 ${selectedPinyin === p ? 'bg-qy-pink text-white border-pink-400 scale-105' : 'bg-white text-pink-300 border-pink-100 hover:bg-pink-50'}`}>
                                        {p}
                                    </button>
                                ))}
                                <button onClick={() => playAudio(charData.char, false, false)} className="w-10 h-10 flex items-center justify-center bg-white text-qy-text-pink rounded-full shadow-sm hover:scale-110 border-2 border-pink-100">üîä</button>
                            </div>

                            <div className="relative mb-8 w-full flex justify-center items-end">
                                <div className="relative">
                                    <HanziPlayer 
                                        key={charData.id + mode} 
                                        char={charData.char} mode={mode}
                                        onMistake={() => {setFeedback('Âä†Ê≤πÔºÅ'); setTimeout(()=>setFeedback(''), 1000)}}
                                        onCorrect={() => {setFeedback('ÂØπÂï¶ÔºÅ'); setTimeout(()=>setFeedback(''), 800)}}
                                        onComplete={handleComplete}
                                    />
                                    {feedback && <div className="absolute -top-16 left-1/2 transform -translate-x-1/2 pointer-events-none z-30 w-full text-center"><span className="bg-qy-text-pink text-white px-4 py-2 rounded-xl font-bold shadow-xl text-lg animate-bounce border-2 border-white">{feedback}</span></div>}
                                </div>
                            </div>

                            <div className="grid grid-cols-2 gap-4 w-full mb-8 max-w-xs">
                                <button onClick={() => setMode('animate')} className={`py-3 rounded-2xl font-bold transition-all shadow-md active:scale-95 flex items-center justify-center gap-2 text-lg border-b-4 ${mode === 'animate' ? 'bg-qy-pink text-white border-pink-400' : 'bg-white text-pink-400 border-pink-100'}`}>üëÄ ÁúãÂä®Áîª</button>
                                <button onClick={() => setMode('quiz')} className={`py-3 rounded-2xl font-bold transition-all shadow-md active:scale-95 flex items-center justify-center gap-2 text-lg border-b-4 ${mode === 'quiz' ? 'bg-qy-text-pink text-white border-pink-700' : 'bg-white text-pink-400 border-pink-100'}`}>‚úçÔ∏è ÂÜôÂÜôÁúã</button>
                            </div>
                            
                            <div className="w-full mb-6 bg-white p-4 rounded-3xl shadow-sm border border-pink-100">
                                <p className="text-xs text-pink-400 font-bold uppercase mb-3 ml-1">üé® Á¨îÁîªÈ°∫Â∫è ({charData.strokesCount}) - ÁÇπÂáªËØªÈü≥</p>
                                <div className="flex flex-wrap gap-2 w-full px-1">
                                    {charData.strokeNames.map((name, i) => {
                                        const displayName = typeof name === 'string' ? name.split('').join(' ') : name;
                                        return (
                                            <button 
                                                key={i} 
                                                onClick={() => readStroke(typeof name === 'string' ? name : '')}
                                                className="bg-pink-100 text-pink-600 px-3 py-1 rounded-full text-sm font-bold border border-pink-200 hover:bg-pink-200 active:scale-95 transition-colors"
                                            >
                                                <span className="text-[10px] opacity-60 mr-1">{i + 1}.</span>
                                                {displayName}
                                            </button>
                                        )
                                    })}
                                </div>
                            </div>
                        </div>
                    ) : null}
                </div>
            );
        };

        // --- NEW COMPONENT: ENGLISH WRITER (CANVAS TRACING) ---
        const EnglishWriter = ({ letter, isUpper, onComplete }) => {
            const canvasRef = useRef(null);
            const [isDrawing, setIsDrawing] = useState(false);
            const [hasDrawn, setHasDrawn] = useState(false);
            const displayChar = isUpper ? letter.toUpperCase() : letter.toLowerCase();

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                // Handle High DPI
                const dpr = window.devicePixelRatio || 1;
                
                // FIX: Use offsetWidth/Height to get the correct layout size (320px) 
                // instead of getBoundingClientRect which might be scaled down by the entry animation.
                const width = canvas.offsetWidth;
                const height = canvas.offsetHeight;
                
                canvas.width = width * dpr;
                canvas.height = height * dpr;
                
                ctx.scale(dpr, dpr);
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.strokeStyle = '#6D28D9'; // Drawing color (Purple)
                ctx.lineWidth = 12;
            }, []); // Init only

            const getPos = (e) => {
                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                
                // Calculate scale factor in case visual size != logical size (e.g. during animation or css scaling)
                const scaleX = canvas.offsetWidth / rect.width;
                const scaleY = canvas.offsetHeight / rect.height;

                return {
                    x: (clientX - rect.left) * scaleX,
                    y: (clientY - rect.top) * scaleY
                };
            };

            const startDrawing = (e) => {
                e.preventDefault(); // Prevent scroll on touch
                setIsDrawing(true);
                setHasDrawn(true);
                const ctx = canvasRef.current.getContext('2d');
                const {x, y} = getPos(e);
                ctx.beginPath();
                ctx.moveTo(x, y);
            };

            const draw = (e) => {
                if (!isDrawing) return;
                e.preventDefault();
                const ctx = canvasRef.current.getContext('2d');
                const {x, y} = getPos(e);
                ctx.lineTo(x, y);
                ctx.stroke();
            };

            const stopDrawing = () => {
                setIsDrawing(false);
                const ctx = canvasRef.current.getContext('2d');
                ctx.closePath();
            };

            const clearCanvas = () => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                // Reset canvas by setting width/height (this clears it and resets state)
                const dpr = window.devicePixelRatio || 1;
                const width = canvas.offsetWidth;
                const height = canvas.offsetHeight;
                canvas.width = width * dpr;
                canvas.height = height * dpr;
                
                // Restore context settings lost by reset
                ctx.scale(dpr, dpr);
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.strokeStyle = '#6D28D9';
                ctx.lineWidth = 12;
                
                setHasDrawn(false);
            };

            // Simple validation simulation
            const checkWriting = () => {
                if(hasDrawn) {
                    onComplete();
                    // Optional: Visual flair
                }
            };

            return (
                <div className="w-full flex flex-col items-center">
                    {/* Notebook Paper Container - Removed Lines */}
                    <div className="relative w-80 h-80 rounded-3xl overflow-hidden shadow-inner border-4 border-white bg-white">
                        
                        {/* Guide Letter (Behind Canvas) */}
                        <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                             <span className="text-[12rem] font-handwriting text-gray-200 translate-y-[-10%]" style={{fontFamily: '"Varela Round", sans-serif'}}>
                                {displayChar}
                             </span>
                        </div>

                        {/* Drawing Canvas */}
                        <canvas 
                            ref={canvasRef}
                            className="absolute inset-0 w-full h-full touch-none cursor-crosshair z-10"
                            onMouseDown={startDrawing}
                            onMouseMove={draw}
                            onMouseUp={stopDrawing}
                            onMouseLeave={stopDrawing}
                            onTouchStart={startDrawing}
                            onTouchMove={draw}
                            onTouchEnd={stopDrawing}
                        />
                    </div>
                    
                    {/* Controls */}
                    <div className="flex gap-4 mt-6">
                        <button onClick={clearCanvas} className="w-14 h-14 bg-red-100 text-red-500 rounded-full flex items-center justify-center text-2xl shadow-sm border border-red-200 active:scale-95 transition-transform">
                            üóëÔ∏è
                        </button>
                        <button onClick={checkWriting} className={`flex-1 px-6 bg-qy-text-purple text-white rounded-full font-bold text-lg shadow-md active:scale-95 transition-all border-2 border-transparent ${!hasDrawn ? 'opacity-50 grayscale' : ''}`}>
                            ‚ú® ÂÆåÊàê Check
                        </button>
                    </div>
                </div>
            );
        }

        // --- ENGLISH VIEW COMPONENTS (Updated) ---

        const EnglishView = ({ setMascotStatus }) => {
            const [selectedItem, setSelectedItem] = useState(null); 
            const [gameStatus, setGameStatus] = useState('playing'); 
            const [activeTab, setActiveTab] = useState('learn'); // 'learn' | 'write' | 'quiz'
            const [writeCase, setWriteCase] = useState('upper'); // 'upper' | 'lower'

            const selectLetter = (item) => {
                setSelectedItem(item);
                setGameStatus('playing');
                setActiveTab('learn'); // Reset to Learn
                setMascotStatus('idle');
                playAudio(item.id, false, true);
            };

            const closeModal = () => {
                setSelectedItem(null);
            }

            const playLetterAudio = () => {
                if(!selectedItem) return;
                playAudio(selectedItem.id, false, true);
            };

            const checkAnswer = (letter) => {
                if (gameStatus === 'success') return;
                if (letter === selectedItem.id || letter === selectedItem.id.toLowerCase()) {
                    setGameStatus('success');
                    setMascotStatus('success');
                    playAudio(selectedItem.word, false, true, true); 
                    playAudio(selectedItem.meaning, false, false, false);
                    playAudio("Good job, Winnie!", true, true, false);
                    setTimeout(() => setMascotStatus('idle'), 4000); 
                } else {
                    playAudio("Try again!", false, true, true);
                }
            };

            const handleWriteComplete = () => {
                 setMascotStatus('success');
                 playAudio("Great writing!", true, true);
                 setTimeout(() => setMascotStatus('idle'), 2000);
            };

            return (
                <div className="w-full max-w-lg px-4 flex flex-col items-center pt-2 pb-32">
                    
                    {/* Grid List */}
                    <div className="w-full max-w-2xl">
                        <div className="grid grid-cols-4 sm:grid-cols-6 gap-3">
                            {PHONICS_DATA.map(item => (
                                <button 
                                    key={item.id}
                                    onClick={() => selectLetter(item)}
                                    className="aspect-square bg-white rounded-2xl shadow-md border border-gray-50 flex flex-col items-center justify-center hover:scale-105 transition-transform hover:shadow-lg active:scale-95 overflow-hidden"
                                >
                                    <span className="text-5xl font-bold text-qy-text-purple font-rounded mb-1">
                                        {item.id}{item.id.toLowerCase()}
                                    </span>
                                    <span className="text-lg">{item.emoji}</span>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* FOCUS MODAL - TABBED INTERFACE */}
                    {selectedItem && (
                        <div className="fixed inset-0 z-[150] bg-gradient-to-br from-purple-50 via-white to-pink-50 w-screen h-screen overflow-y-auto overscroll-contain animate-pop flex flex-col">
                            
                            {/* Background Elements */}
                            <div className="absolute top-[-10%] right-[-10%] w-[50vh] h-[50vh] bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-float pointer-events-none"></div>
                            <div className="absolute bottom-[-10%] left-[-10%] w-[50vh] h-[50vh] bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-float pointer-events-none" style={{animationDelay: '1.5s'}}></div>

                            {/* Header: Back & Title */}
                            <div className="w-full flex items-center justify-between p-6 z-[160]">
                                <button 
                                    onClick={closeModal}
                                    className="flex items-center gap-2 px-4 py-2 bg-white/80 hover:bg-white text-purple-700 rounded-full font-bold shadow-sm transition-all border border-purple-100"
                                >
                                    <span>üîô</span>
                                </button>
                                <div className="text-3xl font-black text-qy-text-purple font-rounded tracking-wider">
                                    {selectedItem.id}{selectedItem.id.toLowerCase()}
                                </div>
                                <div className="w-10"></div> {/* Spacer */}
                            </div>

                            {/* Main Content Area */}
                            <div className="flex-1 w-full z-10 flex flex-col items-center py-4 relative overflow-y-auto">
                                <div className="w-full max-w-md px-4 flex flex-col items-center gap-6">

                                    {/* TAB 1: LEARN */}
                                    {activeTab === 'learn' && (
                                        <div className="animate-pop w-full flex flex-col items-center">
                                            <div className="relative group mb-6">
                                                <div className="absolute inset-0 bg-white rounded-full blur-xl opacity-60 scale-110"></div>
                                                <div className="relative bg-white/80 backdrop-blur-sm p-10 rounded-[2.5rem] shadow-2xl border-4 border-white flex flex-col items-center justify-center w-64 h-64">
                                                    <div className="absolute -top-4 -right-4 bg-white p-3 rounded-full shadow-lg border-2 border-purple-50 animate-bounce text-4xl">
                                                        {selectedItem.emoji}
                                                    </div>
                                                    <span className="text-[7rem] leading-none font-black text-transparent bg-clip-text bg-gradient-to-br from-qy-text-purple to-purple-400 font-rounded drop-shadow-sm select-none">
                                                        {selectedItem.id}
                                                        <span className="text-[4rem] text-purple-300 ml-1">{selectedItem.id.toLowerCase()}</span>
                                                    </span>
                                                </div>
                                            </div>
                                            <div className="flex flex-col items-center gap-2 mb-6">
                                                <h2 className="text-4xl font-bold text-gray-700 tracking-wide">{selectedItem.word}</h2>
                                                <span className="text-xl font-chinese font-bold text-white bg-qy-text-purple px-8 py-2 rounded-full shadow-md">
                                                    {selectedItem.meaning}
                                                </span>
                                            </div>
                                            <button onClick={playLetterAudio} className="bg-white hover:bg-purple-50 text-qy-text-purple border-2 border-purple-100 px-10 py-3 rounded-full font-bold shadow-lg active:scale-95 transition-all flex items-center gap-3 text-lg">
                                                <span className="text-2xl">üîä</span> <span>ÂèëÈü≥ Listen</span>
                                            </button>
                                        </div>
                                    )}

                                    {/* TAB 2: WRITE */}
                                    {activeTab === 'write' && (
                                        <div className="animate-pop w-full flex flex-col items-center">
                                            {/* Case Toggle */}
                                            <div className="flex bg-white rounded-full p-1 shadow-sm border border-purple-100 mb-6">
                                                <button onClick={()=>setWriteCase('upper')} className={`px-6 py-2 rounded-full font-bold transition-all ${writeCase==='upper' ? 'bg-qy-purple text-purple-900 shadow-sm' : 'text-gray-400'}`}>
                                                    Â§ßÂÜô {selectedItem.id}
                                                </button>
                                                <button onClick={()=>setWriteCase('lower')} className={`px-6 py-2 rounded-full font-bold transition-all ${writeCase==='lower' ? 'bg-qy-purple text-purple-900 shadow-sm' : 'text-gray-400'}`}>
                                                    Â∞èÂÜô {selectedItem.id.toLowerCase()}
                                                </button>
                                            </div>
                                            
                                            {/* Writing Canvas Component */}
                                            <EnglishWriter 
                                                key={selectedItem.id + writeCase} // Reset on change
                                                letter={selectedItem.id} 
                                                isUpper={writeCase === 'upper'} 
                                                onComplete={handleWriteComplete}
                                            />
                                            
                                            <p className="mt-4 text-purple-400 text-sm font-bold">üëÜ Follow the lines and trace carefully!</p>
                                        </div>
                                    )}

                                    {/* TAB 3: QUIZ */}
                                    {activeTab === 'quiz' && (
                                        <div className="animate-pop w-full flex flex-col items-center">
                                            <div className="w-full bg-white/60 backdrop-blur-md rounded-3xl p-6 shadow-xl border border-white/50 flex flex-col items-center">
                                                <h3 className="text-qy-text-purple font-bold mb-6 text-xl tracking-wide uppercase opacity-80">üß© Spelling Fun</h3>
                                                <div className="flex items-center gap-3 mb-8 text-5xl font-bold text-gray-700">
                                                    <div className={`w-20 h-24 rounded-2xl flex items-center justify-center border-b-[6px] transition-colors duration-300
                                                        ${gameStatus === 'success' ? 'bg-green-100 border-green-300 text-green-600' : 'bg-white border-purple-200 text-transparent'}`}>
                                                        {selectedItem.id}
                                                    </div>
                                                    <span className="tracking-widest opacity-40">{selectedItem.word.substring(1).toUpperCase()}</span>
                                                </div>
                                                <div className="flex gap-4 flex-wrap justify-center">
                                                    {selectedItem.options.sort(() => Math.random() - 0.5).map((opt, i) => (
                                                        <button
                                                            key={i}
                                                            onClick={() => checkAnswer(opt)}
                                                            className={`w-20 h-20 rounded-2xl text-3xl font-bold shadow-lg border-b-[6px] transition-all active:scale-90 flex items-center justify-center
                                                            ${gameStatus === 'success' && opt === selectedItem.id 
                                                                ? 'bg-green-400 text-white border-green-600 scale-110' 
                                                                : 'bg-white text-qy-text-purple border-purple-100 hover:bg-purple-50'}`}
                                                        >
                                                            {opt}
                                                        </button>
                                                    ))}
                                                </div>
                                                {gameStatus === 'success' && <p className="mt-8 text-green-500 font-bold animate-bounce text-2xl">Good job! üåü</p>}
                                            </div>
                                        </div>
                                    )}

                                </div>
                            </div>

                            {/* Bottom Tab Bar */}
                            <div className="w-full bg-white/90 backdrop-blur-md border-t border-purple-100 pb-[env(safe-area-inset-bottom)] z-[160]">
                                <div className="flex justify-around items-center p-2">
                                    <button onClick={() => setActiveTab('learn')} className={`flex flex-col items-center p-2 rounded-2xl w-20 transition-all ${activeTab === 'learn' ? 'text-qy-text-purple bg-purple-50' : 'text-gray-400'}`}>
                                        <span className="text-2xl mb-1">üëÄ</span>
                                        <span className="text-xs font-bold">Learn</span>
                                    </button>
                                    <button onClick={() => setActiveTab('write')} className={`flex flex-col items-center p-2 rounded-2xl w-20 transition-all ${activeTab === 'write' ? 'text-qy-text-purple bg-purple-50' : 'text-gray-400'}`}>
                                        <span className="text-2xl mb-1">‚úçÔ∏è</span>
                                        <span className="text-xs font-bold">Write</span>
                                    </button>
                                    <button onClick={() => setActiveTab('quiz')} className={`flex flex-col items-center p-2 rounded-2xl w-20 transition-all ${activeTab === 'quiz' ? 'text-qy-text-purple bg-purple-50' : 'text-gray-400'}`}>
                                        <span className="text-2xl mb-1">üß©</span>
                                        <span className="text-xs font-bold">Quiz</span>
                                    </button>
                                </div>
                            </div>

                        </div>
                    )}
                </div>
            );
        };

        // --- MAIN APP ---

        const App = () => {
            const [currentMode, setCurrentMode] = useState('hanzi'); // 'hanzi' | 'english'
            const [mascotStatus, setMascotStatus] = useState('idle');

            // Handle Theme switching on Body
            useEffect(() => {
                if (currentMode === 'hanzi') {
                    document.body.className = 'bg-pink-50 transition-colors duration-500';
                } else {
                    document.body.className = 'bg-purple-50 transition-colors duration-500';
                }
            }, [currentMode]);

            return (
                <div className="min-h-screen flex flex-col items-center relative overflow-hidden">
                    
                    {/* Top Tab Bar - Simplified with Safe Area Padding */}
                    <div className={`w-full pb-3 pt-[calc(0.75rem+env(safe-area-inset-top))] px-4 flex items-center justify-between sticky top-0 z-40 shadow-sm transition-colors duration-300
                        ${currentMode === 'hanzi' ? 'bg-qy-pink' : 'bg-qy-purple'}`}>
                        
                        {/* Title Section */}
                        <div className="flex items-center gap-2 text-white">
                            <span className="text-2xl drop-shadow-sm shrink-0">
                                {currentMode === 'hanzi' ? <ChineseKnotIcon /> : 'ü¶Ñ'}
                            </span>
                            <h1 className="text-lg font-black font-chinese tracking-widest drop-shadow-md truncate leading-tight">
                                {currentMode === 'hanzi' ? 'Áéã‰πî‰æùÁöÑÊ±âÂ≠ó‰πêÂõ≠' : 'Winnie\'s English Park'}
                            </h1>
                        </div>

                        {/* Switcher */}
                        <div className="bg-white/30 p-1 rounded-full flex scale-90 shrink-0">
                            <button 
                                onClick={() => setCurrentMode('hanzi')}
                                className={`px-3 py-1 rounded-full text-xs font-bold transition-all whitespace-nowrap ${currentMode === 'hanzi' ? 'bg-white text-qy-text-pink shadow-sm' : 'text-white hover:bg-white/20'}`}
                            >
                                Ê±âÂ≠ó
                            </button>
                            <button 
                                onClick={() => setCurrentMode('english')}
                                className={`px-3 py-1 rounded-full text-xs font-bold transition-all whitespace-nowrap ${currentMode === 'english' ? 'bg-white text-qy-text-purple shadow-sm' : 'text-white hover:bg-white/20'}`}
                            >
                                Eng
                            </button>
                        </div>
                    </div>

                    {/* Main Content Area */}
                    <div className="w-full flex justify-center relative">
                        {currentMode === 'hanzi' ? (
                            <HanziView setMascotStatus={setMascotStatus} />
                        ) : (
                            <EnglishView setMascotStatus={setMascotStatus} />
                        )}
                    </div>

                    {/* Floating Mascot (Fixed Middle Right with High Z-Index) */}
                    <div className="fixed right-4 top-1/2 -translate-y-1/2 z-[200]">
                        <Mascot mode={currentMode} status={mascotStatus} />
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>